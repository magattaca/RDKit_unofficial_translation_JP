

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RDKitクックブック &mdash; RDKit_unofficial_translation_JP 1.00 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="RDKitデータベースカートリッジ" href="The_RDKit_database_cartridge_jp.html" />
    <link rel="prev" title="The RDKit Book" href="The_RDKit_Book_jp.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> RDKit_unofficial_translation_JP
          

          
          </a>

          
            
            
              <div class="version">
                1.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction_jp.html">このサイトの使い方（日本語版序文）</a></li>
<li class="toctree-l1"><a class="reference internal" href="An_overview_of_the_RDKit_jp.html">RDKitの概要</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation_jp.html">インストールの仕方</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting_Started_with_RDKit_in_Python_jp.html">PythonでRDKitを始めよう</a></li>
<li class="toctree-l1"><a class="reference internal" href="The_RDKit_Book_jp.html">The RDKit Book</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RDKitクックブック</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">このページについて</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">雑多な話題</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">異なる芳香族性モデルを使う方法</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">分子の操作</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">ヘテロ環のクリーンアップ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">並列化したコンフォメーション生成</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">電荷を帯びた分子の中和</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rdkit3d">RDKitの3D機能</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rdkitscikit-learn">RDKitと一緒にscikit-learnを使う方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mcs">カスタムMCSアトムタイプを使う方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">分子のクラスタリング</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nrmsd">N個の分子の間でRMSDを計算</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">イントロダクション</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">詳細</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">ライセンス</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="The_RDKit_database_cartridge_jp.html">RDKitデータベースカートリッジ</a></li>
<li class="toctree-l1"><a class="reference internal" href="Backwards_incompatible_changes_jp.html">後方互換性の無い変更</a></li>
<li class="toctree-l1"><a class="reference internal" href="Supplementary_Text_jp.html">「PythonでRDKitを始めよう」日本語版補遺</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology_jp.html">訳語対応集</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RDKit_unofficial_translation_JP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>RDKitクックブック</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/RDKit_cookbook_jp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rdkit">
<h1>RDKitクックブック<a class="headerlink" href="#rdkit" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#rdkit-cookbook">RDKit Cookbook</a>]</p>
<div class="section" id="id1">
<h2>このページについて<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#what-is-this">What is this?</a>]</p>
<p>このページはPythonからRDKitの機能を使って特定のタスクをどうやって実行すれば良いか例を示します。このコンテンツはRDKitコミュニティの協力で作られています。</p>
<p>間違いを見つけたり、より良い方法を提案する場合は、ソースドキュメント（.rstファイル）をご自身で修正していただくか、メーリングリスト:<a class="reference external" href="mailto:rdkit-discuss&#37;&#52;&#48;lists&#46;sourceforge&#46;net">rdkit-discuss<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a>に送ってください。（メーリングリストを利用する場合はまず加入する必要があります。）</p>
</div>
<div class="section" id="id2">
<h2>雑多な話題<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#miscellaneous-topics">Miscellaneous Topics</a>]</p>
<div class="section" id="id3">
<h3>異なる芳香族性モデルを使う方法<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#using-a-different-aromaticity-model">Using a differnt aromaticity model</a>]</p>
<p>デフォルトでは、RDKitは分子を読み込むときにRDKit自体の芳香族性モデル（RDKit Theory Bookで説明されています）を適用します。
ですが、このモデルを上書きし、自分の芳香族性モデルを使うのはとても簡単です。</p>
<p>最も簡単な方法は、保持してほしい芳香族性のセットと合わせてSMILESで分子を提供することです。例えばインドールの場合を考えましょう:</p>
<img alt="_images/indole1.png" src="_images/indole1.png" />
<p>デフォルトではRDKitはどちらの環構造も芳香族であると認識します:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;N1C=Cc2ccccc12&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">))</span>
<span class="go">((1,), (2,), (3,), (4,), (5,), (6,), (7,), (8,))</span>
</pre></div>
</div>
<p>５員環を脂肪族として扱いたいなら、これは入力のSMILESがどのように書かれているかという問題ですが、ケクレ化（kekulization）と芳香族性を認識する過程をスキップする、
部分的なサニタイゼーションを行う必要があるだけです:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;N1C=Cc2ccccc12&#39;</span><span class="p">,</span><span class="n">sanitize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="n">sanitizeOps</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeFlags</span><span class="o">.</span><span class="n">SANITIZE_ALL</span><span class="o">^</span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeFlags</span><span class="o">.</span><span class="n">SANITIZE_KEKULIZE</span><span class="o">^</span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeFlags</span><span class="o">.</span><span class="n">SANITIZE_SETAROMATICITY</span><span class="p">)</span>
<span class="go">  rdkit.Chem.rdmolops.SanitizeFlags.SANITIZE_NONE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">))</span>
<span class="go">((3,), (4,), (5,), (6,), (7,), (8,))</span>
</pre></div>
</div>
<p>もちろん自分の芳香族性認識関数を書くことも可能ですが、このドキュメントで扱う範囲を超えています。</p>
</div>
</div>
<div class="section" id="id4">
<h2>分子の操作<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#manipulating-molecules">Manipulating Molecules</a>]</p>
<div class="section" id="id5">
<h3>ヘテロ環のクリーンアップ<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#cleaning-up-heterocycles">Cleaning up heterocycles</a>]</p>
<p>メーリングリストの議論；</p>
<ul class="simple">
<li><a class="reference external" href="http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01185.html">http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01185.html</a></li>
<li><a class="reference external" href="http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01162.html">http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01162.html</a></li>
<li><a class="reference external" href="http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01900.html">http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01900.html</a></li>
<li><a class="reference external" href="http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01901.html">http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg01901.html</a></li>
</ul>
<p>コード: 使用例: 結果:</p>
</div>
<div class="section" id="id6">
<h3>並列化したコンフォメーション生成<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#parallel-conformation-generation">Parallel conformation generation</a>]</p>
<p>メーリングリストでのディスカッション: <a class="reference external" href="http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg02648.html">http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg02648.html</a></p>
<p>コード:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; オリジナルはAndrew Dalke氏によるものです &quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>

<span class="c1"># これは右のリンクからダウンロードできます http://pypi.python.org/pypi/futures</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="k">import</span> <span class="n">futures</span>

<span class="c1"># これは右のリンクからダウンロードできます http://pypi.python.org/pypi/progressbar</span>
<span class="kn">import</span> <span class="nn">progressbar</span>

<span class="c1">## 私のマシンではwoker１つで39秒、４つで10秒かかりました。</span>
<span class="c1">## 29.055u 0.102s 0:28.68 101.6%   0+0k 0+3io 0pf+0w</span>
<span class="c1">#max_workers=1</span>

<span class="c1">## スレッド４つでは11秒かかりました。</span>
<span class="c1">## 34.933u 0.188s 0:10.89 322.4%   0+0k 125+1io 0pf+0w</span>
<span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span>

<span class="c1"># （ユーザータイム(u)は子プロセスに使われた時間も含みます</span>
<span class="c1">#  実時間はそれぞれ28.68秒と10.89でした。）</span>

<span class="c1"># この関数はサブプロセスで呼び出されます。</span>
<span class="c1"># パラメータ（分子とコンフォマーの数）はPythonを介して渡されます。</span>
<span class="k">def</span> <span class="nf">generateconformations</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">ids</span><span class="o">=</span><span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMultipleConfs</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">numConfs</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">AllChem</span><span class="o">.</span><span class="n">ETKDG</span><span class="p">())</span>
    <span class="c1"># EmbedMultipleConfsはBoost-wrappedタイプを返しますが、これはピッケル化できません。</span>
    <span class="c1"># Pythonのリストに変換することはできます。</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>

<span class="n">smi_input_file</span><span class="p">,</span> <span class="n">sdf_output_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDWriter</span><span class="p">(</span><span class="n">sdf_output_file</span><span class="p">)</span>

<span class="n">suppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SmilesMolSupplier</span><span class="p">(</span><span class="n">smi_input_file</span><span class="p">,</span> <span class="n">titleLine</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="c1"># 非同期性のジョブのセットを投げます。</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">suppl</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mol</span><span class="p">:</span>
            <span class="n">job</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">generateconformations</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

    <span class="n">widgets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Generating conformations; &quot;</span><span class="p">,</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">Percentage</span><span class="p">(),</span> <span class="s2">&quot; &quot;</span><span class="p">,</span>
               <span class="n">progressbar</span><span class="o">.</span><span class="n">ETA</span><span class="p">(),</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">Bar</span><span class="p">()]</span>
    <span class="n">pbar</span> <span class="o">=</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">(</span><span class="n">widgets</span><span class="o">=</span><span class="n">widgets</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">(</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">jobs</span><span class="p">)):</span>
        <span class="n">mol</span><span class="p">,</span><span class="n">ids</span><span class="o">=</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>電荷を帯びた分子の中和<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#neutralizing-charged-molecules">Neutralizing Charged Molecules</a>]</p>
<p>メーリングリストでのディスカッション: <a class="reference external" href="http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg02669.html">http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg02669.html</a></p>
<p>コード:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; Hans de Winter氏によるものです &quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>

<span class="k">def</span> <span class="nf">_InitialiseNeutralisationReactions</span><span class="p">():</span>
    <span class="n">patts</span><span class="o">=</span> <span class="p">(</span>
        <span class="c1"># Imidazoles</span>
        <span class="p">(</span><span class="s1">&#39;[n+;H]&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">),</span>
        <span class="c1"># Amines</span>
        <span class="p">(</span><span class="s1">&#39;[N+;!H0]&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">),</span>
        <span class="c1"># Carboxylic acids and alcohols</span>
        <span class="p">(</span><span class="s1">&#39;[$([O-]);!$([O-][#7])]&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
        <span class="c1"># Thiols</span>
        <span class="p">(</span><span class="s1">&#39;[S-;X1]&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">),</span>
        <span class="c1"># Sulfonamides</span>
        <span class="p">(</span><span class="s1">&#39;[$([N-;X2]S(=O)=O)]&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">),</span>
        <span class="c1"># Enamines</span>
        <span class="p">(</span><span class="s1">&#39;[$([N-;X2][C,N]=C)]&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">),</span>
        <span class="c1"># Tetrazoles</span>
        <span class="p">(</span><span class="s1">&#39;[n-]&#39;</span><span class="p">,</span><span class="s1">&#39;[nH]&#39;</span><span class="p">),</span>
        <span class="c1"># Sulfoxides</span>
        <span class="p">(</span><span class="s1">&#39;[$([S-]=O)]&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">),</span>
        <span class="c1"># Amides</span>
        <span class="p">(</span><span class="s1">&#39;[$([N-]C=O)]&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="kc">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">patts</span><span class="p">]</span>

<span class="n">_reactions</span><span class="o">=</span><span class="kc">None</span>
<span class="k">def</span> <span class="nf">NeutraliseCharges</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="n">reactions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">_reactions</span>
    <span class="k">if</span> <span class="n">reactions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_reactions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_reactions</span><span class="o">=</span><span class="n">_InitialiseNeutralisationReactions</span><span class="p">()</span>
        <span class="n">reactions</span><span class="o">=</span><span class="n">_reactions</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">)</span>
    <span class="n">replaced</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">reactant</span><span class="p">,</span> <span class="n">product</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reactions</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">mol</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">reactant</span><span class="p">):</span>
            <span class="n">replaced</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">rms</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReplaceSubstructs</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">reactant</span><span class="p">,</span> <span class="n">product</span><span class="p">)</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">rms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">replaced</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">smis</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;c1cccc[nH+]1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;C[N+](C)(C)C&quot;</span><span class="p">,</span><span class="s2">&quot;c1ccccc1[NH3+]&quot;</span><span class="p">,</span>
      <span class="s2">&quot;CC(=O)[O-]&quot;</span><span class="p">,</span><span class="s2">&quot;c1ccccc1[O-]&quot;</span><span class="p">,</span>
      <span class="s2">&quot;CCS&quot;</span><span class="p">,</span>
      <span class="s2">&quot;C[N-]S(=O)(=O)C&quot;</span><span class="p">,</span>
      <span class="s2">&quot;C[N-]C=C&quot;</span><span class="p">,</span><span class="s2">&quot;C[N-]N=C&quot;</span><span class="p">,</span>
      <span class="s2">&quot;c1ccc[n-]1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;CC[N-]C(=O)CC&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">smi</span> <span class="ow">in</span> <span class="n">smis</span><span class="p">:</span>
    <span class="p">(</span><span class="n">molSmiles</span><span class="p">,</span> <span class="n">neutralised</span><span class="p">)</span> <span class="o">=</span> <span class="n">NeutraliseCharges</span><span class="p">(</span><span class="n">smi</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">smi</span> <span class="o">+</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="n">molSmiles</span><span class="p">)</span>
</pre></div>
</div>
<p>結果:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">c1cccc</span><span class="p">[</span><span class="n">nH</span><span class="o">+</span><span class="p">]</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="n">c1ccncc1</span>
<span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="p">](</span><span class="n">C</span><span class="p">)(</span><span class="n">C</span><span class="p">)</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="p">](</span><span class="n">C</span><span class="p">)(</span><span class="n">C</span><span class="p">)</span><span class="n">C</span>
<span class="n">c1ccccc1</span><span class="p">[</span><span class="n">NH3</span><span class="o">+</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">Nc1ccccc1</span>
<span class="n">CC</span><span class="p">(</span><span class="o">=</span><span class="n">O</span><span class="p">)[</span><span class="n">O</span><span class="o">-</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">CC</span><span class="p">(</span><span class="o">=</span><span class="n">O</span><span class="p">)</span><span class="n">O</span>
<span class="n">c1ccccc1</span><span class="p">[</span><span class="n">O</span><span class="o">-</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">Oc1ccccc1</span>
<span class="n">CCS</span> <span class="o">-&gt;</span> <span class="n">CCS</span>
<span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="p">]</span><span class="n">S</span><span class="p">(</span><span class="o">=</span><span class="n">O</span><span class="p">)(</span><span class="o">=</span><span class="n">O</span><span class="p">)</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">CNS</span><span class="p">(</span><span class="n">C</span><span class="p">)(</span><span class="o">=</span><span class="n">O</span><span class="p">)</span><span class="o">=</span><span class="n">O</span>
<span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="p">]</span><span class="n">C</span><span class="o">=</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="o">=</span><span class="n">CNC</span>
<span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="p">]</span><span class="n">N</span><span class="o">=</span><span class="n">C</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="o">=</span><span class="n">NNC</span>
<span class="n">c1ccc</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="p">]</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="n">c1cc</span><span class="p">[</span><span class="n">nH</span><span class="p">]</span><span class="n">c1</span>
<span class="n">CC</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="p">]</span><span class="n">C</span><span class="p">(</span><span class="o">=</span><span class="n">O</span><span class="p">)</span><span class="n">CC</span> <span class="o">-&gt;</span> <span class="n">CCNC</span><span class="p">(</span><span class="o">=</span><span class="n">O</span><span class="p">)</span><span class="n">CC</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rdkit3d">
<h2>RDKitの3D機能<a class="headerlink" href="#rdkit3d" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#d-functionality-in-the-rdkit">3D functionality in the RDKit</a>]</p>
<p>RDKitには3Dを取り扱う広範囲な機能があります。たとえば:</p>
<ul class="simple">
<li>Shape alignment</li>
<li>RMS Calculation</li>
<li>Shape Tanimoto Distance</li>
<li>Shape Protrude Distance</li>
<li>3D pharmacophore fingerprint</li>
<li>Torsion fingerprint (deviation)</li>
</ul>
<p>現在、RDKitでは利用可能なアラインメントのメソッドが２つあります。例として、PDBの同じ分子から２つの結晶構造を使います。</p>
<p>コード:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">RDConfig</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span><span class="p">,</span> <span class="n">rdMolAlign</span>
<span class="c1"># 参照となる分子(reference molecule)</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC(=[NH2+])c1ccc(C[C@@H](NC(=O)CNS(=O)(=O)c2ccc3ccccc3c2)C(=O)N2CCCCC2)cc1&#39;</span><span class="p">)</span>
<span class="c1"># PDBのコンフォメーション</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1DWD_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol1</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1PPC_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="c1"># アラインメントを取ります</span>
<span class="n">rms</span> <span class="o">=</span> <span class="n">rdMolAlign</span><span class="o">.</span><span class="n">AlignMol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rms</span><span class="p">)</span>
<span class="c1"># OPEN3DAlignを使ってアラインメントを取ります</span>
<span class="n">pyO3A</span> <span class="o">=</span> <span class="n">rdMolAlign</span><span class="o">.</span><span class="n">GetO3A</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">pyO3A</span><span class="o">.</span><span class="n">Align</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</pre></div>
</div>
<p>結果：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="mf">1.55001955728</span>
<span class="mf">0.376459885045</span>
</pre></div>
</div>
<p>分子に一つ以上のコンフォマーが含まれている場合、最初のコンフォマーに関してアラインメントを取ります。
リストがオプションのRMSlistに渡された場合、アラインメントによるRMS値が格納されます。
一つの分子の二つのコンフォマーのRMS値は別々に計算することもでき、（prealignedフラグを使うことで）アライメント有り、無しのどちらでも計算可能です。</p>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC(=[NH2+])c1ccc(C[C@@H](NC(=O)CNS(=O)(=O)c2ccc3ccccc3c2)C(=O)N2CCCCC2)cc1&#39;</span><span class="p">)</span>
<span class="n">cids</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMultipleConfs</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">numConfs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">maxAttempts</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">pruneRmsThresh</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">))</span>
<span class="c1"># コンフォマーのアラインメントを取ります</span>
<span class="n">rmslist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">AllChem</span><span class="o">.</span><span class="n">AlignMolConformers</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">RMSlist</span><span class="o">=</span><span class="n">rmslist</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslist</span><span class="p">))</span>
<span class="c1"># コンフォマー1から9のRMSを別々に計算します</span>
<span class="n">rms</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetConformerRMS</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">prealigned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>結果:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="mi">50</span>
<span class="mi">49</span>
</pre></div>
</div>
<p>形状比較のため、RDKitはあらかじめアラインメントされた分子あるいはコンフォマーに対して、
形状に基づく距離（Shape-based distances）を２つ用意しています。
形状はみ出し距離（Shape protrude distance）は体積のミスマッチに焦点をあてていて、
形状タニモト距離（Shape Tanimoto distance）は重ね合わせた体積全体を考慮に入れます。</p>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">RDConfig</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span><span class="p">,</span> <span class="n">rdMolAlign</span><span class="p">,</span> <span class="n">rdShapeHelpers</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC(=[NH2+])c1ccc(C[C@@H](NC(=O)CNS(=O)(=O)c2ccc3ccccc3c2)C(=O)N2CCCCC2)cc1&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1DWD_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol1</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1PPC_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="n">rms</span> <span class="o">=</span> <span class="n">rdMolAlign</span><span class="o">.</span><span class="n">AlignMol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="n">tani</span> <span class="o">=</span> <span class="n">rdShapeHelpers</span><span class="o">.</span><span class="n">ShapeTanimotoDist</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="n">prtr</span> <span class="o">=</span> <span class="n">rdShapeHelpers</span><span class="o">.</span><span class="n">ShapeProtrudeDist</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rms</span><span class="p">,</span> <span class="n">tani</span><span class="p">,</span> <span class="n">prtr</span><span class="p">)</span>
</pre></div>
</div>
<p>結果:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="mf">1.55001955728</span> <span class="mf">0.18069102331</span> <span class="mf">0.0962800875274</span>
</pre></div>
</div>
<p>3Dファーマコフォアフィンガープリントは、3D距離行列を2Dファーマコフォア機能に与えることで、RDKitを使って計算することができます。</p>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">DataStructs</span><span class="p">,</span> <span class="n">RDConfig</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem.Pharm2D</span> <span class="k">import</span> <span class="n">Gobbi_Pharm2D</span><span class="p">,</span> <span class="n">Generate</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC(=[NH2+])c1ccc(C[C@@H](NC(=O)CNS(=O)(=O)c2ccc3ccccc3c2)C(=O)N2CCCCC2)cc1&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1DWD_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol1</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1PPC_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="c1"># ファーマコフォアフィンガープリント</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">Gobbi_Pharm2D</span><span class="o">.</span><span class="n">factory</span>
<span class="n">fp1</span> <span class="o">=</span> <span class="n">Generate</span><span class="o">.</span><span class="n">Gen2DFingerprint</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">dMat</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">Get3DDistanceMatrix</span><span class="p">(</span><span class="n">mol1</span><span class="p">))</span>
<span class="n">fp2</span> <span class="o">=</span> <span class="n">Generate</span><span class="o">.</span><span class="n">Gen2DFingerprint</span><span class="p">(</span><span class="n">mol2</span><span class="p">,</span> <span class="n">factory</span><span class="p">,</span> <span class="n">dMat</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">Get3DDistanceMatrix</span><span class="p">(</span><span class="n">mol2</span><span class="p">))</span>
<span class="c1"># Tanimoto類似度</span>
<span class="n">tani</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">TanimotoSimilarity</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span> <span class="n">fp2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tani</span><span class="p">)</span>
</pre></div>
</div>
<p>結果:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="mf">0.451665312754</span>
</pre></div>
</div>
<p>RDKitはSchulz-Gaschら（J. Chem. Inf. Model, 52, 1499, 2012）により開発された手法、
トーションフィンガープリントデビエーション（torsion fingerprint deviation:TFD)も実装しています。
一つの分子のコンフォマーのペアについて、回転可能な結合と環系の二面角をトーションフィンガープリント（torsion fingerprint: TF）に記録し、
そしてTF間の偏差を計算、規格化、そして合計を取ります。各二面角について。a-b-c-dの4つの原子のセットが選ばれます。</p>
<p>RDKitの実装では、次に示すようにトーションフィンガープリントをカスタマイズすることが可能です。</p>
<ul class="simple">
<li>元々の手法では、二面角は分子の中心に対する距離に基づいて重みづけられていました。デフォルトでは、この重みづけが実行されますが、useWeights=Falseフラグを使うことで、実行しないようにできます。</li>
<li>対称的な原子aとd（あるいは、aかd）が存在しているとき、全てのとりうる二面角が計算されます。２つの原子が対称的かどうか決定するため、与えられた半径（デフォルトは半径=2）のMorganアルゴリズムに基づくハッシュ・コードが使われます。</li>
<li>元々の方法では規格化に使われる最大の偏差は、全ての二面角に対して180.0度です（デフォルト）。maxDev=’spec’とすることで、最大偏差に依存する二面角のタイプが規格化に使われます。</li>
<li>元々の方法では、三重結合とアレンに隣接する単結合は無視されます（デフォルト）。ignoreColinearBonds=’False’とすることで、“連結された(combined)”二面角が使われます。</li>
</ul>
<p>以上に加えて、Schulz-Gaschらによる方法と異なる点が2、3あります:</p>
<ul class="simple">
<li>水素原子は決して考慮されません。</li>
<li>元々の方法では、原子bとc（あるいはbかc）に複数の非対称な隣接原子がある場合、原子aとd（あるいはaかd）はランダムに選ばれていました。RDKitの実装では最小のMorgan不変量をもつ原子を選びます。この方法では分子の原子の順番に選択する原子が依存しません。</li>
<li>原子aとd（あるいはaかd）が対称的な場合、元々の手法では最も小さい二面角のみを保存しますが、RDKitの実装では全ての取りうる二面角をTFに保存します。続いて、全ての取りうる偏差が決定され、そして最も小さいものがTFDの計算に使われます。この手順により最も小さい偏差がTFDに入ることを保証します。</li>
</ul>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">RDConfig</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span><span class="p">,</span> <span class="n">TorsionFingerprints</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC(=[NH2+])c1ccc(C[C@@H](NC(=O)CNS(=O)(=O)c2ccc3ccccc3c2)C(=O)N2CCCCC2)cc1&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1DWD_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol1</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1PPC_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="n">tfd1</span> <span class="o">=</span> <span class="n">TorsionFingerprints</span><span class="o">.</span><span class="n">GetTFDBetweenMolecules</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">)</span>
<span class="n">tfd2</span> <span class="o">=</span> <span class="n">TorsionFingerprints</span><span class="o">.</span><span class="n">GetTFDBetweenMolecules</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">,</span> <span class="n">useWeights</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tfd3</span> <span class="o">=</span> <span class="n">TorsionFingerprints</span><span class="o">.</span><span class="n">GetTFDBetweenMolecules</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">,</span> <span class="n">maxDev</span><span class="o">=</span><span class="s1">&#39;spec&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tfd1</span><span class="p">,</span> <span class="n">tfd2</span><span class="p">,</span> <span class="n">tfd3</span><span class="p">)</span>
</pre></div>
</div>
<p>結果:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="mf">0.0691236990428</span> <span class="mf">0.111475253992</span> <span class="mf">0.0716255058804</span>
</pre></div>
</div>
<p>同じ分子のコンフォマー間のTFDを計算する場合、性能上の理由で<code class="docutils literal"><span class="pre">GetTFDBetweenConformers()</span></code>関数を使うべきです。</p>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">RDConfig</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span><span class="p">,</span> <span class="n">TorsionFingerprints</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC(=[NH2+])c1ccc(C[C@@H](NC(=O)CNS(=O)(=O)c2ccc3ccccc3c2)C(=O)N2CCCCC2)cc1&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1DWD_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">AssignBondOrdersFromTemplate</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">mol1</span><span class="p">)</span>
<span class="n">mol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromPDBFile</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDBaseDir</span><span class="o">+</span><span class="s1">&#39;/rdkit/Chem/test_data/1PPC_ligand.pdb&#39;</span><span class="p">)</span>
<span class="n">mol1</span><span class="o">.</span><span class="n">AddConformer</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">(),</span> <span class="n">assignId</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tfd</span> <span class="o">=</span> <span class="n">TorsionFingerprints</span><span class="o">.</span><span class="n">GetTFDBetweenConformers</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">confIds1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">confIds2</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tfd</span><span class="p">)</span>
</pre></div>
</div>
<p>結果:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.0691</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>コンフォマーRMSとTFDの値のため、RDKitでは、Butinaクラスタリングといったクラスタリングアルゴリズムに与えることができる対称行列を直接計算する簡易関数を用意しています。
フラグの並べ替えにより、クラスターが作られるたびに毎回、クラスタリングされていない分子について近接するものの数が更新されることを保証します。</p>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span><span class="p">,</span> <span class="n">TorsionFingerprints</span>
<span class="kn">from</span> <span class="nn">rdkit.ML.Cluster</span> <span class="k">import</span> <span class="n">Butina</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC(=[NH2+])c1ccc(C[C@@H](NC(=O)CNS(=O)(=O)c2ccc3ccccc3c2)C(=O)N2CCCCC2)cc1&#39;</span><span class="p">)</span>
<span class="n">cids</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMultipleConfs</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">numConfs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">maxAttempts</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">pruneRmsThresh</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># RMS行列（RMS matrix）</span>
<span class="n">rmsmat</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetConformerRMSMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">prealigned</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># TFD行列（TFD matrix）</span>
<span class="n">tfdmat</span> <span class="o">=</span> <span class="n">TorsionFingerprints</span><span class="o">.</span><span class="n">GetTFDMatrix</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="c1"># クラスタリング</span>
<span class="n">num</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span>
<span class="n">rms_clusters</span> <span class="o">=</span> <span class="n">Butina</span><span class="o">.</span><span class="n">ClusterData</span><span class="p">(</span><span class="n">rmsmat</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">isDistData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tfd_clusters</span> <span class="o">=</span> <span class="n">Butina</span><span class="o">.</span><span class="n">ClusterData</span><span class="p">(</span><span class="n">tfdmat</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">isDistData</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reordering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="rdkitscikit-learn">
<h2>RDKitと一緒にscikit-learnを使う方法<a class="headerlink" href="#rdkitscikit-learn" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#using-scikit-learn-with-rdkit">Using scikit-learn with RDKit</a>]</p>
<p>scikit-learnはPythoのための機械学習のライブラリで、様々な教師あり、教師無しの手法を含みます。siki-learnに関するドキュメンテーションはこちらにあります: <a class="reference external" href="http://scikit-learn.org/stable/user_guide.html">http://scikit-learn.org/stable/user_guide.html</a></p>
<p>RDKitのフィンガープリントはscikit-learnの機械学習モデルを訓練するのに使うことができます。これはランダムフォレストの例です。</p>
<p>コード:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span><span class="p">,</span> <span class="n">DataStructs</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="k">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># ４つの分子を生成</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1&#39;</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1CC&#39;</span><span class="p">)</span>
<span class="n">m3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccncc1&#39;</span><span class="p">)</span>
<span class="n">m4</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccncc1CC&#39;</span><span class="p">)</span>
<span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">,</span> <span class="n">m4</span><span class="p">]</span>

<span class="c1"># フィンガープリントを生成: 半径２のMorganフィンガープリント</span>
<span class="n">fps</span> <span class="o">=</span> <span class="p">[</span><span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">]</span>

<span class="c1"># RDKitの明示的なベクトルをNumpyのアレイに変換</span>
<span class="n">np_fps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">fps</span><span class="p">:</span>
  <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
  <span class="n">DataStructs</span><span class="o">.</span><span class="n">ConvertToNumpyArray</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
  <span class="n">np_fps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

<span class="c1"># 100個のツリーをもつランダムフォレスト分類器を手に入れます</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1123</span><span class="p">)</span>

<span class="c1"># 最初の２つの分子を活性あり（active, class 1）、</span>
<span class="c1"># 残りの２つを活性無し（inactive, class 0）として、</span>
<span class="c1"># ランダムフォレストを訓練します</span>
<span class="n">ys_fit</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np_fps</span><span class="p">,</span> <span class="n">ys_fit</span><span class="p">)</span>

<span class="c1"># 新しい分子を予測するためにランダムフォレストを使います</span>
<span class="n">m5</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1O&#39;</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
<span class="n">DataStructs</span><span class="o">.</span><span class="n">ConvertToNumpyArray</span><span class="p">(</span><span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">m5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fp</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">((</span><span class="n">fp</span><span class="p">,)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">((</span><span class="n">fp</span><span class="p">,)))</span>
</pre></div>
</div>
<p>scikit-learn バージョン0.13での出力結果は:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[[</span> <span class="mf">0.14</span> <span class="mf">0.86</span><span class="p">]]</span>
</pre></div>
</div>
<p>このモデルに対して類似度マップを作成しましょう。 コードは:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit.Chem.Draw</span> <span class="k">import</span> <span class="n">SimilarityMaps</span>

<span class="c1"># ヘルパー関数</span>
<span class="k">def</span> <span class="nf">getProba</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">predictionFunction</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">predictionFunction</span><span class="p">((</span><span class="n">fp</span><span class="p">,))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

<span class="n">m5</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1O&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForModel</span><span class="p">(</span><span class="n">m5</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">getProba</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">))</span>
</pre></div>
</div>
<p>これで、次の結果が返ってきます:</p>
<img alt="_images/similarity_map_rf.png" src="_images/similarity_map_rf.png" />
</div>
<div class="section" id="mcs">
<h2>カスタムMCSアトムタイプを使う方法<a class="headerlink" href="#mcs" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#using-custom-mcs-atom-types">Using custom MCS atom types</a>]</p>
<p>メーリングリストの議論: <a class="reference external" href="http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg03676.html">http://www.mail-archive.com/rdkit-discuss&#64;lists.sourceforge.net/msg03676.html</a></p>
<p>IPython notebook: <a class="reference external" href="http://nbviewer.ipython.org/gist/greglandrum/8351725">http://nbviewer.ipython.org/gist/greglandrum/8351725</a>
<a class="reference external" href="https://gist.github.com/greglandrum/8351725">https://gist.github.com/greglandrum/8351725</a></p>
<p>MCSについては可読性のあるSMILESを手に入れることができますが、このセクションの目標はMCSコードでカスタムアトムタイプを使えるようになることです。
マッチングに同位体の情報を使うために、MCSコードのオプションを使います。そして、我々の同位体の情報を含む偽の同位体の値をセットします。</p>
<p>コード:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">rdFMCS</span>

<span class="c1"># テストに用いる分子:</span>
<span class="n">smis</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;COc1ccc(C(Nc2nc3c(ncn3COCC=O)c(=O)[nH]2)(c2ccccc2)c2ccccc2)cc1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;COc1ccc(C(Nc2nc3c(ncn3COC(CO)(CO)CO)c(=O)[nH]2)(c2ccccc2)c2ccccc2)cc1&quot;</span><span class="p">]</span>
<span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">smis</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
  <span class="s2">&quot; a simple hash combining atom number and hybridization &quot;</span>
  <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">GetHybridization</span><span class="p">())</span><span class="o">+</span><span class="n">a</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span>

<span class="c1"># あとで分子を変えるので、コピーしておきます:</span>
<span class="n">nms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">]</span>
<span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="n">nms</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">nm</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
      <span class="n">at</span><span class="o">.</span><span class="n">SetIsotope</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">at</span><span class="p">))</span>

<span class="n">mcs</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">nms</span><span class="p">,</span><span class="n">atomCompare</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">AtomCompare</span><span class="o">.</span><span class="n">CompareIsotopes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mcs</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
</pre></div>
</div>
<p>これで次の出力が得られます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">406</span><span class="o">*</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">308</span><span class="o">*</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">306</span><span class="o">*</span><span class="p">]</span><span class="mi">1</span><span class="p">:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">](:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="mi">406</span><span class="o">*</span><span class="p">](</span><span class="o">-</span><span class="p">[</span><span class="mi">307</span><span class="o">*</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">306</span><span class="o">*</span><span class="p">]</span><span class="mi">1</span><span class="p">:[</span><span class="mi">307</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]</span><span class="mi">2</span><span class="p">:[</span><span class="mi">306</span><span class="o">*</span><span class="p">](:[</span><span class="mi">306</span><span class="o">*</span><span class="p">](:[</span><span class="mi">307</span><span class="o">*</span><span class="p">]:</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="mi">308</span><span class="o">*</span><span class="p">]):[</span><span class="mi">307</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">307</span><span class="o">*</span><span class="p">]:</span><span class="mi">2</span><span class="o">-</span><span class="p">[</span><span class="mi">406</span><span class="o">*</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">408</span><span class="o">*</span><span class="p">]</span><span class="o">-</span><span class="p">[</span><span class="mi">406</span><span class="o">*</span><span class="p">])(</span><span class="o">-</span><span class="p">[</span><span class="mi">306</span><span class="o">*</span><span class="p">]</span><span class="mi">1</span><span class="p">:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="mi">306</span><span class="o">*</span><span class="p">]</span><span class="mi">1</span><span class="p">:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:[</span><span class="mi">306</span><span class="o">*</span><span class="p">]:</span><span class="mi">1</span>
</pre></div>
</div>
<p>これが我々が求めたものではありますが、必ずしも可読性の高いものではありません。２ステップのプロセスで、より読みやすい形式とすることができます:</p>
<ol class="arabic simple">
<li>MCSの部分構造マッチングをコピーした分子に対して行う</li>
<li>コピーとマッチした原子だけを使って、元々の分子のSMILESを生成する</li>
</ol>
<p>我々はコピーと元々の分子のアトムインデックスが同じであると知っているので、これで上手くいきます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getMCSSmiles</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="n">labelledMol</span><span class="p">,</span><span class="n">mcs</span><span class="p">):</span>
    <span class="n">mcsp</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="n">mcs</span><span class="o">.</span><span class="n">smartsString</span><span class="p">)</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">labelledMol</span><span class="o">.</span><span class="n">GetSubstructMatch</span><span class="p">(</span><span class="n">mcsp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFragmentToSmiles</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="n">atomsToUse</span><span class="o">=</span><span class="n">match</span><span class="p">,</span>
                                    <span class="n">isomericSmiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">canonical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">getMCSSmiles</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">nms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mcs</span><span class="p">))</span>

<span class="n">COc1ccc</span><span class="p">(</span><span class="n">C</span><span class="p">(</span><span class="n">Nc2nc3c</span><span class="p">(</span><span class="n">ncn3COC</span><span class="p">)</span><span class="n">c</span><span class="p">(</span><span class="o">=</span><span class="n">O</span><span class="p">)[</span><span class="n">nH</span><span class="p">]</span><span class="mi">2</span><span class="p">)(</span><span class="n">c2ccccc2</span><span class="p">)</span><span class="n">c2ccccc2</span><span class="p">)</span><span class="n">cc1</span>
</pre></div>
</div>
<p>これが我々が探し求めていたものです。</p>
</div>
<div class="section" id="id8">
<h2>分子のクラスタリング<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#clustering-molecules">Clustering molecules</a>]</p>
<p>大きな分子のセット（1000から2000以上）には、Butinaクラスタリングアルゴリズムを使うのが最も効率が良いです。</p>
<p>これが、フィンガープリントのセットに対してクラスタリングを行うためのコードです:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ClusterFps</span><span class="p">(</span><span class="n">fps</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">DataStructs</span>
    <span class="kn">from</span> <span class="nn">rdkit.ML.Cluster</span> <span class="k">import</span> <span class="n">Butina</span>

    <span class="c1"># まず距離行列を生成します:</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nfps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nfps</span><span class="p">):</span>
        <span class="n">sims</span> <span class="o">=</span> <span class="n">DataStructs</span><span class="o">.</span><span class="n">BulkTanimotoSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fps</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
        <span class="n">dists</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sims</span><span class="p">])</span>

    <span class="c1"># データをクラスタリングします:</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">Butina</span><span class="o">.</span><span class="n">ClusterData</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span><span class="n">nfps</span><span class="p">,</span><span class="n">cutoff</span><span class="p">,</span><span class="n">isDistData</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cs</span>
</pre></div>
</div>
<p>戻り値はクラスターのタプルで、各クラスターはidのタプルとなっています。</p>
<p>使用例:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Chem</span><span class="o">.</span><span class="n">ForwardSDMolSupplier</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;zdd.sdf.gz&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">fps</span> <span class="o">=</span> <span class="p">[</span><span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1024</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">]</span>
<span class="n">clusters</span><span class="o">=</span><span class="n">ClusterFps</span><span class="p">(</span><span class="n">fps</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
<p>変数のクラスターが結果を含んでいます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">clusters</span><span class="p">[</span><span class="mi">200</span><span class="p">])</span>
<span class="go">(6164, 1400, 1403, 1537, 1543, 6575, 6759)</span>
</pre></div>
</div>
<p>このクラスタには7点含まれており、クラスターの重心は6164です。</p>
</div>
<div class="section" id="nrmsd">
<h2>N個の分子の間でRMSDを計算<a class="headerlink" href="#nrmsd" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#rmsd-calculation-between-n-molecules">RMSD Calculation between N molecules</a>]</p>
<div class="section" id="id9">
<h3>イントロダクション<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#introduction">Introduction</a>]</p>
<p>時々、２つ（あるいはそれ以上の）分子間のRMSD距離を計算する必要が生じます。これは２つのコンフォマーのがどれだけ近いかを計算するのに使われます。ほとんどのRMSD計算は類似の化合物、あるいは、少なくとも共通の部分をもつ異なる化合物についてのみ、意味をなします。</p>
</div>
<div class="section" id="id10">
<h3>詳細<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#details">Details</a>]</p>
<p>（Python 2.7で書かれた）次のプログラムはSDFファイルを入力とし、ファイルに含まれる分子間の全てのRMSD距離を生成します。これらの距離は（ユーザーが定義した）出力ファイルに書き込まれます。</p>
<p>５つのコンフォマーを持つSDFにたいしては、10個のRMSDスコアが得られます。典型的な、n個から反復無しにk個を選び出す問題です。すなわち、5!/2!(5-2)!。</p>
<p>コード：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">ファイルの中の全ての構造間のRMSDの差を計算</span>

<span class="sd">@author: JP &lt;jp@javaclass.co.uk&gt;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">getopt</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># rdkitをインポート</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">文字列のコンテンツをファイルに書き込む</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">def</span> <span class="nf">write_contents</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
  <span class="c1"># 基本的なチェックをいくつか行います。厳密に言えばassertを使うことができます。</span>
  <span class="k">assert</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;filename cannot be None&quot;</span>
  <span class="k">assert</span> <span class="n">contents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;contents cannot be None&quot;</span>
  <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># ファイルをクローズします</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">リストをファイルに書き込みます</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">def</span> <span class="nf">write_list_to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">line_sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">):</span>
  <span class="c1"># 基本的なチェックをいくつか行います。厳密に言えばassertを使うことができます。</span>
  <span class="k">assert</span> <span class="nb">list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;list cannot be None or empty&quot;</span>
  <span class="n">write_contents</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">line_sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">RMSDのスプレッドを計算</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">def</span> <span class="nf">calculate_spread</span><span class="p">(</span><span class="n">molecules_file</span><span class="p">):</span>

  <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">molecules_file</span><span class="p">),</span> <span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> does not exist!&quot;</span> <span class="o">%</span> <span class="n">molecules</span>

  <span class="c1"># イテレータの取得</span>
  <span class="n">mols</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="n">molecules_file</span><span class="p">)</span>

  <span class="n">spread_values</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1"># いくつの分子がファイルの中に含まれているか？</span>
  <span class="n">mol_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
  <span class="c1"># それぞれの分子を他の全ての分子と比較します。</span>
  <span class="c1"># 典型的なn個からk個を選択する話です（nから2個選択）</span>
  <span class="c1"># 組み合わせの数は(n!) / k!(n-k)! で与えら得れます（私の数学能力が錆ついていなければ）</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">mol_count</span><span class="p">):</span>
          <span class="c1"># 何かの処理が行われていることを表示するようにしましょう・・・mol_countの値が大きい場合、ある程度の時間がかかるので</span>
          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aligning molecule #</span><span class="si">%d</span><span class="s2"> with molecule #</span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> molecules in all)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">mol_count</span><span class="p">))</span>
          <span class="c1"># RMSDを計算し、アレイに格納します</span>
          <span class="c1"># AlignMolと異なって、これは対称性の処理も行います</span>
          <span class="n">spread_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">AllChem</span><span class="o">.</span><span class="n">GetBestRMS</span><span class="p">(</span><span class="n">mols</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mols</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
  <span class="c1"># アレイを返します</span>
  <span class="k">return</span> <span class="n">spread_values</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="k">try</span><span class="p">:</span>
      <span class="c1"># オプションは次の通りです:</span>
      <span class="c1"># f - 実際の構造のファイル</span>
      <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s2">&quot;vf:o:&quot;</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">getopt</span><span class="o">.</span><span class="n">GetoptError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
      <span class="c1"># ヘルプの情報をprint関数で出力し、終了します:</span>
      <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span> <span class="c1"># これは &quot;option -a not recognized&quot; といったようなものを出力します</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>

  <span class="c1"># デフォルト</span>
  <span class="n">molecules_file</span>  <span class="o">=</span> <span class="kc">None</span>
  <span class="n">output_file</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="s2">&quot;-v&quot;</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSD Spread 1.1&quot;</span><span class="p">)</span>
          <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
      <span class="k">elif</span> <span class="n">opt</span> <span class="o">==</span> <span class="s2">&quot;-f&quot;</span><span class="p">:</span>
          <span class="n">molecules_file</span> <span class="o">=</span> <span class="n">arg</span>
      <span class="k">elif</span> <span class="n">opt</span> <span class="o">==</span> <span class="s2">&quot;-o&quot;</span><span class="p">:</span>
          <span class="n">output_file</span> <span class="o">=</span> <span class="n">arg</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Unhandled option: &quot;</span> <span class="o">+</span> <span class="n">opt</span>

  <span class="c1"># 次をassertしてください - 最も綺麗な方法ではありませんが、上手くいきます</span>
  <span class="k">assert</span> <span class="n">molecules_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;file containing molecules must be specified, add -f to command line arguments&quot;</span>
  <span class="k">assert</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;output file must be specified, add -o to command line arguments&quot;</span>
  <span class="c1"># RMSDスプレッドの値を得ます</span>
  <span class="n">spread_values</span> <span class="o">=</span> <span class="n">calculate_spread</span><span class="p">(</span><span class="n">molecules_file</span><span class="p">)</span>
  <span class="c1"># ファイルに書き込みます</span>
  <span class="n">write_list_to_file</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">spread_values</span><span class="p">)</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>このプログラムは次のような方法でコマンドラインから実行されるかもしれません（Pythonのインタプリタが<code class="docutils literal"><span class="pre">/usr/bin/python</span></code>にある場合です。
その他の場合は最初の行（滑稽な名前がつけられたシバン）を編集してください:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">calculate_spread</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="n">my_conformers</span><span class="o">.</span><span class="n">sdf</span> <span class="o">-</span><span class="n">o</span> <span class="n">my_conformers</span><span class="o">.</span><span class="n">rmsd_spread</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>要約:
<code class="docutils literal"><span class="pre">AllChem.GetBestRMS(mol1,</span> <span class="pre">mol2)</span></code>の行はRMSDを不動小数点型として返し、このプログラムの要点となっています。
<code class="docutils literal"><span class="pre">GetBestRMS()</span></code>は<code class="docutils literal"><span class="pre">AlignMol()</span></code>と異なり対称性を考慮に入れた処理を行います。</p>
</div>
</div>
<div class="section" id="id11">
<h2>ライセンス<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Cookbook.html#license">License</a>]</p>
<p>この文書の著作権は copyright (C) 2013-2018 by Greg Landrumに所属しています。</p>
<p>この文書はCreative Commons Attribution-ShareAlike 4.0 Licenseのもとでライセンスされています。
このライセンスを見るためには <a class="reference external" href="http://creativecommons.org/licenses/by-sa/4.0/">http://creativecommons.org/licenses/by-sa/4.0/</a> にアクセスするか、
Creative Commons, 543 Howard Street, 5th Floor, San Francisco, California, 94105, USA.　に手紙を送ってください。</p>
<p>このライセンスの意図はRDKitそのものの意図と似ています。
簡単に言えば“これを使ってなんでもやりたいことをやっていいですが、私たちの功績についても言及してください”</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="The_RDKit_database_cartridge_jp.html" class="btn btn-neutral float-right" title="RDKitデータベースカートリッジ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="The_RDKit_Book_jp.html" class="btn btn-neutral" title="The RDKit Book" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, anonymous

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.00',
              LANGUAGE:'ja',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The RDKit Book &mdash; RDKit_unofficial_translation_JP 1.00 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="RDKitクックブック" href="RDKit_cookbook_jp.html" />
    <link rel="prev" title="PythonでRDKitを始めよう" href="Getting_Started_with_RDKit_in_Python_jp.html" />
 
<script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131515238-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 gtag('config', 'UA-131515238-1');
</script>


</script>


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> RDKit_unofficial_translation_JP
          

          
          </a>

          
            
            
              <div class="version">
                1.00
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction_jp.html">このサイトの使い方（日本語版序文）</a></li>
<li class="toctree-l1"><a class="reference internal" href="An_overview_of_the_RDKit_jp.html">RDKitの概要</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation_jp.html">インストールの仕方</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting_Started_with_RDKit_in_Python_jp.html">PythonでRDKitを始めよう</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The RDKit Book</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">その他ケモインフォマティクスの話題</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">芳香族性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rdkit">RDKit芳香族性モデル</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">単純芳香族性モデル</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mdl">MDL芳香属性モデル</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#smiles">SMILESのサポートと拡張</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smarts">SMARTSのサポートと拡張</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sssr">環の同定とSSSR</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">化学反応の取り扱い</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reaction-smarts">Reaction SMARTS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">いくつかの特徴</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">キラリティー</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">ルールと警告</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fdef">特徴定義ファイル形式（FDefファイル）</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">化学的特徴</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">FDefファイルの文法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#atomtype">AtomTypeの定義</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">フィーチャーの定義</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">その他の文法上の注意点:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">原子の重みとフィーチャーの場所</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id21">ファーマコフォアフィンガープリントの表現</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id22">部分構造クエリにおける原子同士のマッチング</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">分子のサニタイゼーション</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id25">実装の詳細</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id26">“マジック”プロパティの値</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#romol-mol-in-python">ROMol(Mol in Python)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#atom">Atom</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id27">スレッドの安全性とRDKit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id28">テスト済みのもの</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id29">把握済みの問題</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tpsa">TPSA記述子の実装</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id30">脚注</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id33">ライセンス</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="RDKit_cookbook_jp.html">RDKitクックブック</a></li>
<li class="toctree-l1"><a class="reference internal" href="The_RDKit_database_cartridge_jp.html">RDKitデータベースカートリッジ</a></li>
<li class="toctree-l1"><a class="reference internal" href="Backwards_incompatible_changes_jp.html">後方互換性の無い変更</a></li>
<li class="toctree-l1"><a class="reference internal" href="Supplementary_Text_jp.html">「PythonでRDKitを始めよう」日本語版補遺</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology_jp.html">訳語対応集</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RDKit_unofficial_translation_JP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>The RDKit Book</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/The_RDKit_Book_jp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-rdkit-book">
<h1>The RDKit Book<a class="headerlink" href="#the-rdkit-book" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#the-rdkit-book">The RDKit Book</a>]</p>
<div class="section" id="id1">
<h2>その他ケモインフォマティクスの話題<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#misc-cheminformatics-topics">Misc Chemoinformatics Topics</a>]</p>
<div class="section" id="id2">
<h3>芳香族性<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#aromaticity">Aromaticity</a>]</p>
<p>芳香族性は単純であると同時にどうしようもなく複雑な不愉快な話題の一つです。
実験化学者も理論化学者もその定義についてお互いに同意に達することができないので、どれかひとつを恣意的に選びとり、そしてそれを貫き通す必要があります。
RDKitがとっている方法は次のようなものです。</p>
<p>知られている芳香族系に合うようなパターンを使用する代わりに、RDKitの芳香族を認識するコードは一連のルールを使います。そのルールは比較的直接的なものです。</p>
<p>芳香族性とは環構造に含まれる原子と結合の特性です。芳香族結合は芳香族原子の間でなければなりませんが、芳香族原子間の結合が芳香族結合である必要はありません。</p>
<p>例えば、ここで二つの6員環の連結に使われている結合はRDKitでは芳香族であるとは見なされません。</p>
<img alt="_images/picture_9.png" src="_images/picture_9.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=CC2=C(C=C1)C1=CC=CC=C21&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondBetweenAtoms</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
<p>RDKitは多数の異なる芳香族モデルをサポートしており、芳香族性を割り当てる関数を提供することでユーザーが独自の定義をできるようにしています。</p>
<div class="section" id="rdkit">
<h4>RDKit芳香族性モデル<a class="headerlink" href="#rdkit" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#the-rdkit-aromaticity-model">The RDKit Aromaticity Model</a>]</p>
<p>一つの環、あるいは縮合多環系は、4N+2ルールに従う場合、芳香族であるとみなされます。数え上げられる電子への寄与は、アトムタイプと周囲の環境によって定義されます。いくつか例をあげます：</p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">フラグメント</th>
<th class="head">π電子の数</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>c(a)a</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>n(a)a</td>
<td>1</td>
</tr>
<tr class="row-even"><td>An(a)a</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>o(a)a</td>
<td>2</td>
</tr>
<tr class="row-even"><td>s(a)a</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>se(a)a</td>
<td>2</td>
</tr>
<tr class="row-even"><td>te(a)a</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>O=c(a)a</td>
<td>0</td>
</tr>
<tr class="row-even"><td>N=c(a)a</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>*(a)a</td>
<td>0, 1, or 2</td>
</tr>
</tbody>
</table>
<p><strong>表記法</strong> a: any aromatic atom; A: any atom, include H; *:a dummy atom</p>
<p>電気陰性原子に結合する環外の結合は、環上の原子から価電子を“盗み”、ダミー原子は環を芳香族とするのに必要な数だけ無制限に寄与することに注意してください。</p>
<p>芳香族性に縮合多環系を使う場合、個々の環は非芳香族性なのに、環全体としては芳香族といった状況となることがあります。例を挙げるとアズレンです：</p>
<img alt="_images/picture_8.png" src="_images/picture_8.png" />
<p>縮合多環系と環外二重結合の影響を示す極端な例をあげます：</p>
<img alt="_images/picture_7.png" src="_images/picture_7.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;O=C1C=CC(=O)C2=C1OC=CO2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondBetweenAtoms</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
<p>特別な場合をあげると、ラジカルのヘテロ原子は芳香族性の候補と見なされません。</p>
<img alt="_images/picture_10.png" src="_images/picture_10.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=C[N]C=C1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">GetNumRadicalElectrons</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
<p>ラジカルをもつ電荷を帯びた炭素も芳香族とは見なされません:</p>
<img alt="_images/picture_12.png" src="_images/picture_12.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=CC=CC=C[C+]1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">GetFormalCharge</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">GetNumRadicalElectrons</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
<p>ですが、ラジカルをもつ電気的に中性な炭素は、芳香族と見なされます:</p>
<img alt="_images/picture_11.png" src="_images/picture_11.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=[C]NC=C1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetNumRadicalElectrons</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>単純芳香族性モデル<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#the-simple-aromaticity-model">The Simple Aromaticity Model</a>]</p>
<p>このモデルとても単純です。５員環と６員環の単純な環構造だけが芳香族性の候補として考慮されます。上述のリストと同じ、電子の寄与のカウント方法が使われます。</p>
</div>
<div class="section" id="mdl">
<h4>MDL芳香属性モデル<a class="headerlink" href="#mdl" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#the-mdl-aromaticity-model">The MDL Aromaticity Model</a>]</p>
<p>このモデルはあまり詳細な説明が手に入りません（少なくとも公的にはドキュメント化されていません）。
そこで我々はoechemのドキュメント（ <a class="reference external" href="https://docs.eyesopen.com/toolkits/python/oechemtk/aromaticity.html">https://docs.eyesopen.com/toolkits/python/oechemtk/aromaticity.html</a> )で提供されているものを再現しようとしました。</p>
<ul class="simple">
<li>縮合環（すなわち、アズレン）は芳香族になりうる</li>
<li>5員環は芳香族では無い（縮合環系の一部にはなりうる）</li>
<li>CとNだけが芳香族になりうる</li>
<li>電子のドナーは一つだけ許容される</li>
<li>環外に飛び出す二重結合を持つ原子は芳香族では無い</li>
</ul>
<p><strong>注:</strong> 計算の都合上の理由で、構成原子の総数が多くても24原子の縮合環系にだけ、芳香属性の判断が適用されます。</p>
</div>
</div>
<div class="section" id="smiles">
<h3>SMILESのサポートと拡張<a class="headerlink" href="#smiles" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#smiles-support-and-extensions">[SMILES Support and Extensions]</a>]</p>
<p>RDKitはDaylight SMILES [<a class="footnote-reference" href="#id31" id="id4">[2]</a> の全ての標準的な特徴と、有用な拡張をカバーしています。</p>
<p>これが、拡張のリスト（のおそらく一部分）です:</p>
<ul class="simple">
<li>芳香属性: <code class="docutils literal"><span class="pre">te</span></code> (芳香属性 Te)は許容されます</li>
<li>配位結合: <code class="docutils literal"><span class="pre">&lt;-</span></code>と<code class="docutils literal"><span class="pre">-&gt;</span></code>が原子間の配位結合を作ります。方向が重要です。</li>
<li>原子の番号による原子の特定: SMARTSの要素<code class="docutils literal"><span class="pre">[#6]</span></code>もSMILESでサポートされています。</li>
</ul>
</div>
<div class="section" id="smarts">
<h3>SMARTSのサポートと拡張<a class="headerlink" href="#smarts" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#smarts-support-and-extensions">SMARTS Support and Extensions</a>]</p>
<p>RDKitはDaylight SMARTS <a class="footnote-reference" href="#id32" id="id5">[3]</a> の標準的な特徴のほとんどと、いくつかの有用な拡張をカバーしています。</p>
<p>これが、RDKitでサポートされて*いない*SMARTSの特徴のリスト（網羅できていると良いのですが）です:</p>
<ul class="simple">
<li>非-四面体のキラルクラス</li>
<li><code class="docutils literal"><span class="pre">&#64;?</span></code> オペレーター</li>
<li>明示的な原子量（同位体クエリーはサポートされています）</li>
<li>異なる構成要素への適合を要請する構成要素レベルのグループ化、すなわち``(C).(C)``</li>
</ul>
<p>これが、拡張のリスト（のおそらく一部分）です:</p>
<ul class="simple">
<li><strong>混成クエリ</strong> :<ul>
<li><code class="docutils literal"><span class="pre">^0</span></code> はS混成原子にマッチ</li>
<li><code class="docutils literal"><span class="pre">^1</span></code> はSP混成原子にマッチ</li>
<li><code class="docutils literal"><span class="pre">^2</span></code> はSP2混成原子にマッチ</li>
<li><code class="docutils literal"><span class="pre">^3</span></code> はSP3混成原子にマッチ</li>
<li><code class="docutils literal"><span class="pre">^4</span></code> はSP3D混成原子にマッチ</li>
<li><code class="docutils literal"><span class="pre">^5</span></code> はSP3D2混成原子にマッチ</li>
</ul>
</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC=CF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[^2]&#39;</span><span class="p">))</span>
<span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</pre></div>
</div>
<ul class="simple">
<li>配位結合: <code class="docutils literal"><span class="pre">&lt;-</span></code> と``-&gt;`` は相当する配位結合に対応し、方向が重要です</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=CC=CC=N1-&gt;[Fe]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[#7]-&gt;*&#39;</span><span class="p">))</span>
<span class="go">((5, 6),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=CC=CC=N1-&gt;[Fe]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;*&lt;-[#7]&#39;</span><span class="p">))</span>
<span class="go">((6, 5),)</span>
</pre></div>
</div>
<ul class="simple">
<li>ヘテロ原子隣接クエリ:<ul>
<li>アトムクエリ``z`` は指定した数のヘテロ原子（すなわちCやHでは無い）を隣接してもつ原子にマッチします。例えば、z2は``CC(=O)O`` の２番目のCにマッチします。</li>
<li>アトムクエリ``z`` は指定した数の脂肪族ヘテロ原子（すなわちCやHでは無い）を隣接してもつ原子にマッチします。</li>
</ul>
</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;O=C(O)c1nc(O)ccn1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[z2]&#39;</span><span class="p">))</span>
<span class="go">((1,), (3,), (5,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;O=C(O)c1nc(O)ccn1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[Z2]&#39;</span><span class="p">))</span>
<span class="go">((1,),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;O=C(O)c1nc(O)ccn1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[Z1]&#39;</span><span class="p">))</span>
<span class="go">((5,),)</span>
</pre></div>
</div>
<ul class="simple">
<li>レンジクエリ: 数値を要求する多くのタイプのクエリのため、値の範囲を提供することができます:<ul>
<li><code class="docutils literal"><span class="pre">D{2-4}</span></code> は2から4の間（両端の値を含む）の明示的な結合をもつ原子にマッチします。</li>
<li><code class="docutils literal"><span class="pre">D{-3}</span></code> は3とそれより少ない数の明示的な結合を持つ原子にマッチします。</li>
<li><code class="docutils literal"><span class="pre">D{2-}</span></code> は少なくとも2つの明示的な結合を持つ原子にマッチします。</li>
</ul>
</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)OC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[z{1-}]&#39;</span><span class="p">))</span>
<span class="go">((1,), (4,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)OC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[D{2-3}]&#39;</span><span class="p">))</span>
<span class="go">((1,), (3,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)OC.C&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[D{-2}]&#39;</span><span class="p">))</span>
<span class="go">((0,), (2,), (3,), (4,), (5,))</span>
</pre></div>
</div>
</div>
<div class="section" id="sssr">
<h3>環の同定とSSSR<a class="headerlink" href="#sssr" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#ring-finding-and-sssr">Ring Finding and SSSR</a>]</p>
<p>他の人たちが、私が意図していたよりも大きなエネルギーと雄弁さでわめき出したように、
分子の「最小の環構造の最小のセット(smallest set of smallest rings:SSSR)」の定義は一つではありません。
対称性の高い分子では“本当の”SSSRで得られる結果は魅力的ではありません。例えばキュバンのSSSRは環構造を5つとしますが、“明らかに”6つあります。
この問題は、対称的な結果を返す、「最小の環構造の（<em>最小</em> ではなく）*小さい* セット」のアルゴリズムを実装することで修正することができます。これがRDKitで用いている手法です。</p>
<p>分子に含まれるSSSR環構造の数を数えることができると役に立つこともあるので、
<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.GetSSSR">rdkit.Chem.rdmolops.GetSSSR()</a>関数が提供されていますが、
これはSSSRの数を返すだけで、潜在的に一意ではない環構造のセットを返すわけではありません。</p>
</div>
</div>
<div class="section" id="id6">
<h2>化学反応の取り扱い<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#chemical-reaction-handling">Chemical Reaction Handling</a>]</p>
<div class="section" id="reaction-smarts">
<h3>Reaction SMARTS<a class="headerlink" href="#reaction-smarts" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#reaction-smarts">Reaction SMARTS</a>]</p>
<p>SMIRKS <a class="footnote-reference" href="#smirks" id="id7">[1]</a> でもなく、SMILES <a class="footnote-reference" href="#id31" id="id8">[2]</a> でもなく、SMARTS <a class="footnote-reference" href="#id32" id="id9">[3]</a> から派生したものです。</p>
<p>reaction SMARTSの一般的な文法は以下の様なものです：</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">reaction</span>  <span class="p">::</span><span class="o">=</span>   <span class="n">reactants</span> <span class="s2">&quot;&gt;&gt;&quot;</span> <span class="n">products</span>
<span class="n">reactants</span> <span class="p">::</span><span class="o">=</span>  <span class="n">molecules</span>
<span class="n">products</span>  <span class="p">::</span><span class="o">=</span>   <span class="n">molecules</span>
<span class="n">molecules</span> <span class="p">::</span><span class="o">=</span>  <span class="n">molecule</span>
               <span class="n">molecules</span> <span class="s2">&quot;.&quot;</span> <span class="n">molecule</span>
<span class="n">molecule</span>  <span class="p">::</span><span class="o">=</span>   <span class="n">a</span> <span class="n">valid</span> <span class="n">SMARTS</span> <span class="n">string</span> <span class="n">without</span> <span class="s2">&quot;.&quot;</span> <span class="n">characters</span>
                <span class="s2">&quot;(&quot;</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">SMARTS</span> <span class="n">string</span> <span class="n">without</span> <span class="s2">&quot;.&quot;</span> <span class="n">characters</span> <span class="s2">&quot;)&quot;</span>
</pre></div>
</div>
<div class="section" id="id10">
<h4>いくつかの特徴<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#some-features">Some features</a>]</p>
<p>生成物のテンプレート上にマッピングされたダミー原子は、反応物質の対応する原子によって置き換えられます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1]=[O,N:2]&gt;&gt;[C:1][*:2]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC=O&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;CCO&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC=N&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;CCN&#39;]</span>
</pre></div>
</div>
<p>ですが、マッピングされなかったダミー原子はダミーのままです：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1]=[O,N:2]&gt;&gt;*[C:1][*:2]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC=O&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;*C(C)O&#39;]</span>
</pre></div>
</div>
<p>生成物の“Any”結合は、反応物質の対応する結合によって置き換えられます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1]~[O,N:2]&gt;&gt;*[C:1]~[*:2]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C=O&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;*C=O&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CO&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;*CO&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C#N&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;*C#N&#39;]</span>
</pre></div>
</div>
<p>分子内の反応は、反応物質を丸括弧に囲むことで、柔軟に表現することができます。閉環メタセシス <a class="footnote-reference" href="#intramolrxn" id="id11">[4]</a> 例に、実際にやってみます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s2">&quot;([C:1]=[C;H2].[C:2]=[C;H2])&gt;&gt;[*:1]=[*:2]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C=CCOCC=C&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">m1</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;C1=CCOC1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4>キラリティー<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#chirality">Chirality</a>]</p>
<p>このセクションは、反応の定義においてキラリティーの情報がどうやって扱われるかについて説明します。セクションを通して、2級アルコールのエステル化を例として扱います。 <a class="footnote-reference" href="#chiralrxn" id="id13">[5]</a></p>
<p>もし反応の定義にキラリティーの情報がないなら、反応物質の立体化学は保持されます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">alcohol1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(CCN)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alcohol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@H](CCN)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alcohol3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@@H](CCN)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acid</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[CH1:1][OH:2].[OH][C:3]=[O:4]&gt;&gt;[C:1][O:2][C:3]=[O:4]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol1</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)OC(C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol2</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol3</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@@H](C)CCN&#39;</span>
</pre></div>
</div>
<p>マッピングされた原子が反応物質と生成物両方で同じキラリティーを持つ場合、同じ結果（立体化学の保持）が得られます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C@H1:1][OH:2].[OH][C:3]=[O:4]&gt;&gt;[C@:1][O:2][C:3]=[O:4]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol1</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)OC(C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol2</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol3</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@@H](C)CCN&#39;</span>
</pre></div>
</div>
<p>反応物質と生成物で異なるキラリティーを持つマッピングされた原子は、立体が反転します。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C@H1:1][OH:2].[OH][C:3]=[O:4]&gt;&gt;[C@@:1][O:2][C:3]=[O:4]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol1</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)OC(C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol2</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@@H](C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol3</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
</pre></div>
</div>
<p>反応物質のマッピングされた原子のキラリティーが指定されていて、生成物では指定されていない場合、反応によって不斉中心のキラリティーの情報は失われます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C@H1:1][OH:2].[OH][C:3]=[O:4]&gt;&gt;[C:1][O:2][C:3]=[O:4]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol1</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)OC(C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol2</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)OC(C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol3</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)OC(C)CCN&#39;</span>
</pre></div>
</div>
<p>そして、最後に、キラリティーが生成物で指定されていて、反応物質では指定されていない場合、反応によって指定したキラリティーが作られます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[CH1:1][OH:2].[OH][C:3]=[O:4]&gt;&gt;[C@:1][O:2][C:3]=[O:4]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol1</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol2</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol3</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
</pre></div>
</div>
<p>反応の定義で立体の中心の周りの環境について、もう少し情報を含めないと、これはあまり意味をなさないことに注意してください:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[CH3:5][CH1:1]([C:6])[OH:2].[OH][C:3]=[O:4]&gt;&gt;[C:5][C@:1]([C:6])[O:2][C:3]=[O:4]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol1</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol2</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol3</span><span class="p">,</span><span class="n">acid</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(=O)O[C@H](C)CCN&#39;</span>
</pre></div>
</div>
<p>キラリティーの指定がクエリの一部としては使われないことに気をつけてください。キラリティーの指定されていない分子は、キラリティーが指定されている反応物質とマッチします。</p>
<p>一般的に、反応機能ではできる限り立体化学に関する情報を保とうとします。これは不斉中心で新しい結合が一つ形成される場合はうまくいきます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1][C:2]-O&gt;&gt;[C:1][C:2]-S&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alcohol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@@H](O)CCN&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol2</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;C[C@@H](S)CCN&#39;</span>
</pre></div>
</div>
<p>ですが、2つあるいはそれ以上の結合が形成される場合はうまくいきません。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1][C:2](-O)-F&gt;&gt;[C:1][C:2](-S)-Cl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">alcohol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@@H](O)F&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">=</span><span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">alcohol</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;CC(S)Cl&#39;</span>
</pre></div>
</div>
<p>この場合、情報が保存されるために十分な情報がないだけです。マッピングに関する情報を加えるだけで解決することができます。</p>
</div>
<div class="section" id="id14">
<h4>ルールと警告<a class="headerlink" href="#id14" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#rules-and-caveats">Rules and caveats</a>]</p>
<ol class="arabic simple">
<li>アトムクエリの最後にアトムマップの情報を含めてください。つまり[C,N,O:1]や[C;R:1]の様にしてください。</li>
<li>SMARTSで指定されていない結合は、単結合かあるいは芳香族性の結合であることを忘れない様にしてください。生成物のテンプレートの結合次数は、生成物のテンプレート自体が生成された時に割り当てられるので、その結合が単結合であるべきか、芳香族性であるべきかをいつでも指示できるわけではありません:</li>
</ol>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[#6:1][#7,#8:2]&gt;&gt;[#6:1][#6:2]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1NCCCC1&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;C1CCCCC1&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ncccc1&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;c1ccccc-1&#39;]</span>
</pre></div>
</div>
<p>なので、反応物質から結合次数をコピーしたい場合は、“Any”結合を使ってください。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[#6:1][#7,#8:2]&gt;&gt;[#6:1]~[#6:2]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ncccc1&#39;</span><span class="p">),))[</span><span class="mi">0</span><span class="p">]]</span>
<span class="go">[&#39;c1ccccc1&#39;]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fdef">
<h2>特徴定義ファイル形式（FDefファイル）<a class="headerlink" href="#fdef" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#the-feature-definition-file-format">The Feature Definition File Format</a>]</p>
<p>FDefファイルは化学的特徴（フィーチャー）のセットを定義するのに必要な情報を全て含みます。DaylightのSMARTS言語を使って構築されたクエリーから定義された特徴のタイプの定義を含みます。 <a class="footnote-reference" href="#id32" id="id15">[3]</a>
FDefファイルはオプションで、特徴の定義をもっと読みやすくするために使われるアトムタイプの定義を含むこともできます。</p>
<div class="section" id="id16">
<h3>化学的特徴<a class="headerlink" href="#id16" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#chemical-features">Chemical Features</a>]</p>
<p>化学的特徴はフィーチャータイプ（Feature Type）とフィーチャーファミリー（Feature Family）で定義されています。
フィーチャーファミリーは（“水素結合ドナー”や“芳香族”といった）一般的な特徴の分類で、フィーチャータイプは特徴に関する追加の、より詳細な情報を提供します。
ファーマコフォアマッチングはフィーチャーファミリーを使って行われます。各フィーチャータイプには次の情報を含みます:</p>
<ul class="simple">
<li>（一つ、またはそれ以上の）フィーチャータイプにマッチする原子を表現するSMARTSパターン</li>
<li>フィーチャーを定義する原子の位置に基づき特徴の位置を決定するのに使われる重み</li>
</ul>
</div>
<div class="section" id="id17">
<h3>FDefファイルの文法<a class="headerlink" href="#id17" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#syntax-of-the-fdef-file">Syntax of the FDef file</a>]</p>
<div class="section" id="atomtype">
<h4>AtomTypeの定義<a class="headerlink" href="#atomtype" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#atomtype-definitions">AtomType definitions</a>]</p>
<p>アトムクエリを定義するSMARTS文字列の代わりに、アトムタイプ[AtomType]の定義を使って簡略表記法を割り当てることができます。これによりFDefファイルをもっとずっと読みやすくすることができます。
例えば、非極性炭素原子を次の様に定義することで、FDefファイルの他のどこでも使うことができる新しい名前を作成することができ、このSMARTSを使うのに役立ちます。:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType Carbon_NonPolar [C&amp;!$(C=[O,N,P,S])&amp;!$(C#N)]
</pre></div>
</div>
<p>アトムタイプを参照するには、中括弧にその名前を含めるだけです。例えば、FDefファイルからのこの抜粋は、Carbon_NonPolarの定義を参照する他のアトムタイプ（Hphobe）を定義します。:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType Carbon_NonPolar [C&amp;!$(C=[O,N,P,S])&amp;!$(C#N)]
AtomType Hphobe [{Carbon_NonPolar},c,s,S&amp;H0&amp;v2,F,Cl,Br,I]
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">{Carbon_Nonpolar}</span></code> が、追加の修飾無しに、新しいアトムタイプを定義するのに使われていることに注目してください（角括弧やrecursive SMARTSのマーカーは必要とされていません）。</p>
<p>アトムタイプを繰り返すことで、SMARTSの“,”(or)オペレーターを使って二つの定義を結合したものが得られます。これが例です:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType d1 [N&amp;!H0]
AtomType d1 [O&amp;!H0]
</pre></div>
</div>
<p>これは次と等価です:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType d1 [N&amp;!H0,O&amp;!H0]
</pre></div>
</div>
<p>次のもっと効率的な定義と等価です:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType d1 [N,O;!H0]
</pre></div>
</div>
<p>これらの例ではSMARTSの優先度が高いアンドオペレーター“&amp;”を使う傾向があり、優先度が低い”;”ではないことに注意してください。
アトムタイプが連結される場合や繰り返される場合に重要となります。SMARTSの“,”オペレーターは“;”よりも優先度が高く、従って“;”を使う定義は予期せぬ結果に繋がる可能性があります。</p>
<p>否定するネガティブアトムタイプクエリを定義することもできます。:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType d1 [N,O,S]
AtomType !d1 [H0]
</pre></div>
</div>
<p>ネガティブクエリは最初のものと組み合わされ、次の様なものと同一の定義を生成します:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType d1 [!H0;N,O,S]
</pre></div>
</div>
<p>ネガティブアトムタイプがクエリの最初に付け足されることに注意してください。</p>
</div>
<div class="section" id="id18">
<h4>フィーチャーの定義<a class="headerlink" href="#id18" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#feature-definitions">Feature definitions</a>]</p>
<p>フィーチャーの定義はアトムタイプの定義よりも複雑で、複数の行に渡ります:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DefineFeature HDonor1 [N,O;!H0]
Family HBondDonor
Weights 1.0
EndFeature
</pre></div>
</div>
<p>フィーチャーの定義の最初の行はフィーチャータイプとフィーチャーを定義するSMARTS文字列を含みます。
次の２行（順番は重要ではありません）はフィーチャーのファミリーと原子の重み（フィーチャーを定義する原子の数と同じ長さの、カンマで区切られたリスト）を定義します。
原子の重みは、フィーチャーを定義する原子の位置の平均の重みに基づき、フィーチャーの場所を計算するのに使われます。
これに関してさらに詳細は下を参照してください。フィーチャーの定義の最後の行はEndFeatureである必要があります。
FDefファイルでアトムタイプの定義とフィーチャーの定義とを混ぜ合わせることは完全にルールに則った方法です。
たった一つのルールはアトムタイプは参照される前に定義されなければならないということです。</p>
</div>
<div class="section" id="id19">
<h4>その他の文法上の注意点:<a class="headerlink" href="#id19" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#additional-syntax-notes">Additional syntax notes</a>]</p>
<ul>
<li><p class="first"># シンボルで始まるどの行もコメントとして認識され、無視されます。</p>
</li>
<li><p class="first">行の終わりのバックスラッシュ記号は継続記号です。そのラインのデータが次の行に続いていることを示します。
これらの追加行の最初の余白は無視されます。例えば、このアトムタイプの定義は:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType tButylAtom [$([C;!R](-[CH3])(-[CH3])(-[CH3])),\
$([CH3](-[C;!R](-[CH3])(-[CH3])))]
</pre></div>
</div>
<p>これと完全に等価です:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>AtomType tButylAtom [$([C;!R](-[CH3])(-[CH3])(-[CH3])),$([CH3](-[C;!R](-[CH3])(-[CH3])))]
</pre></div>
</div>
</li>
</ul>
<p>（最初の形式の方がとても読みやすいですが！）</p>
</div>
<div class="section" id="id20">
<h4>原子の重みとフィーチャーの場所<a class="headerlink" href="#id20" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#atom-weights-and-feature-locations">Atom weights and feature locations</a>]</p>
</div>
</div>
<div class="section" id="faq">
<h3>FAQ<a class="headerlink" href="#faq" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#frequently-asked-question-s">Frequently Asked Question(s)</a>]</p>
<ul>
<li><p class="first">フィーチャータイプがファイルの中で繰り返された場合どんなことが起こるのか？
これが例です:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DefineFeature HDonor1 [O&amp;!H0]
Family HBondDonor
Weights 1.0
EndFeature

DefineFeature HDonor1 [N&amp;!H0]
Family HBondDonor
Weights 1.0
EndFeature
</pre></div>
</div>
<p>この場合HDonor1のフィーチャータイプの定義はどちらもアクティブです。機能的には次と同一です:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DefineFeature HDonor1 [O,N;!H0]
Family HBondDonor
Weights 1.0
EndFeature
</pre></div>
</div>
<p><strong>ですが</strong>、この複製されたフィーチャーの定義は、より単純な物を組み合わせた定義よりもかなり効率が悪く、より混乱を招きやすくなります。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="id21">
<h2>ファーマコフォアフィンガープリントの表現<a class="headerlink" href="#id21" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#representation-of-pharmacophore-fingerprints">Representation of Pharmacophore Fingerprints</a>]</p>
<p>RDKitの体系ではファーマコフォアフィンガープリントのビットIDはハッシュ化されていません：それぞれのビットはフィーチャーと距離の特定の組み合わせに相当します。
与えられたビットIDは、解釈するために、対応するフィーチャーのタイプと距離に再度変換し直すことができます。
2Dファーマコフォアのイラストによる説明を <a class="reference internal" href="#ph4-figure"><span class="std std-ref">Figure 1:   Bit numbering in pharmacophore fingerprints</span></a> に示しています。</p>
<div class="figure" id="id34">
<span id="ph4-figure"></span><a class="reference internal image-reference" href="_images/picture_10.jpg"><img alt="Alternate Text" src="_images/picture_10.jpg" style="width: 597.0px; height: 732.5px;" /></a>
<p class="caption"><span class="caption-text">Figure 1:   Bit numbering in pharmacophore fingerprints</span></p>
</div>
</div>
<div class="section" id="id22">
<h2>部分構造クエリにおける原子同士のマッチング<a class="headerlink" href="#id22" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#atom-atom-matching-in-substructure-queries">Atom-Atom Matching in Substructure Queries</a>]</p>
<p>SMARTSから導かれたクエリと部分構造のマッチングを行うときに、分子のどの原子がクエリのどの原子にマッチするべきかのルールが十分に定義されます。 <a class="footnote-reference" href="#id32" id="id23">[3]</a>
クエリの分子がmol blockあるいはSMILESから導かれたときには、必ずしも同様にルールが十分に定義されるとは限りません。</p>
<p>RDKitで使われている一般的なルールでは、もしクエリの特性を明示しなければマッチングの判断基準の一部として使われず、そして水素原子は無視されます。従って次の様な動きをします。</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="35%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Molecule</th>
<th class="head">Query</th>
<th class="head">Match</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CCO</td>
<td>CCO</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>CC[O-]</td>
<td>CCO</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>CCO</td>
<td>CC[O-]</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>CC[O-]</td>
<td>CC[O-]</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>CC[O-]</td>
<td>CC[OH]</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>CCOC</td>
<td>CC[OH]</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>CCOC</td>
<td>CCO</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>CCC</td>
<td>CCC</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>CC[14C]</td>
<td>CCC</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>CCC</td>
<td>CC[14C]</td>
<td>No</td>
</tr>
<tr class="row-even"><td>CC[14C]</td>
<td>CC[14C]</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>OCO</td>
<td>C</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>OCO</td>
<td>[CH]</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>OCO</td>
<td>[CH2]</td>
<td>No</td>
</tr>
<tr class="row-even"><td>OCO</td>
<td>[CH3]</td>
<td>No</td>
</tr>
<tr class="row-odd"><td>OCO</td>
<td>O[CH3]</td>
<td>Yes</td>
</tr>
<tr class="row-even"><td>O[CH2]O</td>
<td>C</td>
<td>Yes</td>
</tr>
<tr class="row-odd"><td>O[CH2]O</td>
<td>[CH2]</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>実際にやってみましょう:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCO&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[O-]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCO&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[O-]&#39;</span><span class="p">))</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[O-]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[O-]&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[O-]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[OH]&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCOC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[OH]&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCOC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCO&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCC&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[14C]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCC&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[14C]&#39;</span><span class="p">))</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[14C]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[14C]&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;[CH]&#39;</span><span class="p">))</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;[CH2]&#39;</span><span class="p">))</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;[CH3]&#39;</span><span class="p">))</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;O[CH3]&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;O[CH2]O&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;O[CH2]O&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;[CH2]&#39;</span><span class="p">))</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<div class="section" id="id24">
<h2>分子のサニタイゼーション<a class="headerlink" href="#id24" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#molecular-sanitization">Molecular Sanitization</a>]</p>
<p>デフォルトでは、分子を解析する関数は全て、読み込まれた分子に対して“サニタイゼーション”の処理を行います。
サニタイゼーションの考え方というのは、残りのコードのために有用な特性（混成の状態や、環構造に含まれるか否か、など）を算出することと、分子が“合理的である”ことを保証することです。
合理的とはつまり、分子をオクテット則を完全に満たす様なルイス構造式であらわすことができるということです。</p>
<p>処理の過程を順番に示します。</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">clearComputedProps</span></code>:
分子とその原子、結合に既に存在する計算による特性を全て除去します。この処理はいつも行われます。</li>
<li><code class="docutils literal"><span class="pre">cleanup</span></code>:
少数の非標準的な原子価の状態を標準化します。クリーンアップの処理は:<ul>
<li>Oと二重結合している中性の５価のNは両性イオンの形式に変換されます。
例: <code class="docutils literal"><span class="pre">N(=O)=O</span> <span class="pre">-&gt;</span> <span class="pre">[N+](=O)[O-]</span></code></li>
<li>他のNと三重結合している中性の５価のNは両性イオンの形式に変換されます。
例: <code class="docutils literal"><span class="pre">C-N=N#N</span> <span class="pre">-&gt;</span> <span class="pre">C-N=[N+]=[N-]</span></code></li>
<li>Oとの二重結合が一つと、もう一つ二重結合をCあるいはPとしている中性の５価のリン原子は両性イオンの形式に変換されます。
例: <code class="docutils literal"><span class="pre">C=P(=O)O</span> <span class="pre">-&gt;</span> <span class="pre">C=[P+]([O-])O</span></code></li>
<li>Oとだけ隣接している中性のCl、BrあるいはIで、３価、５価あるいは７価のものは両性イオンの形式に変換されます。亜塩素酸や塩素酸、過塩素酸の様なものを含みます。
例: <code class="docutils literal"><span class="pre">O=Cl(=O)O</span> <span class="pre">-&gt;</span> <span class="pre">[O-][Cl+2][O-]O</span></code></li>
</ul>
</li>
</ol>
<p>この処理では例外は生じないはずです。</p>
<ol class="arabic simple" start="3">
<li><code class="docutils literal"><span class="pre">updatePropertyCache</span></code>:
全ての原子の明示的原子価と暗に表される原子価を計算します。これは許容されるよりも高い価数の状態となっている原子には例外を生成します。この処理はいつも行われますが、もしこの過程を“スキップ”すると非標準的な原子価についてのテストは実行されません。</li>
<li><code class="docutils literal"><span class="pre">symmetrizeSSSR</span></code>:
対称化された“最小の環構造についての最小のセット”（SSSR: Smallest Set
of Smallest
Rings）のアルゴリズムを呼び出します（SSSRについてはGetting Started
ドキュメントで議論しました）。</li>
<li><code class="docutils literal"><span class="pre">Kekulize</span></code>:
芳香環をケクレ形式に変換します。環構造をケクレ化できなかった場合や芳香族性の結合が環の外部に見つかった場合に例外を返します。</li>
<li><code class="docutils literal"><span class="pre">assignRadicals</span></code>:（存在する場合）各原子のラジカル電子の数を決定します。</li>
<li><code class="docutils literal"><span class="pre">setAromaticity</span></code>: 芳香環と環の系（ring
system、上述）を同定し、原子と結合に芳香族フラグをセットし、結合次数を芳香族にセットします。</li>
<li><code class="docutils literal"><span class="pre">setConjugation</span></code>:どの結合が共役しているか同定します。</li>
<li><code class="docutils literal"><span class="pre">setHybridization</span></code>: 各原子の混成の状態を計算します。</li>
<li><code class="docutils literal"><span class="pre">cleanupChirality</span></code>:
sp3混成ではない原子から不斉のタグを取り除きます。</li>
<li><code class="docutils literal"><span class="pre">adjustHs</span></code>:
化学を保存するのに必要な場所に明に示された水素原子を付け加えます。これは典型的には芳香環のヘテロ原子に必要とされます。古典的な例はピロールの窒素原子です。</li>
</ol>
<p>個々の処理は``MolOps::sanitizeMol`` か``Chem.SanitizeMol`` を呼び出すことで、実行するか否かを切り替えることができます。</p>
</div>
<div class="section" id="id25">
<h2>実装の詳細<a class="headerlink" href="#id25" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#implementation-details">Implementation Details</a>]</p>
<div class="section" id="id26">
<h3>“マジック”プロパティの値<a class="headerlink" href="#id26" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#magic-property-values">“Magic” Property Values</a>]</p>
<p>次のプロパティの値はRDKitのコードベースで正式に使われているものですが、クライアントコードでも役にたつかもしれません。</p>
<div class="section" id="romol-mol-in-python">
<h4>ROMol(Mol in Python)<a class="headerlink" href="#romol-mol-in-python" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#romol-mol-in-python">ROMol(Mol in Python)</a>]</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">プロパティの名称</th>
<th class="head">使用用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MolFileComments</td>
<td>CTABのコメント行からの読み込みと書き込み</td>
</tr>
<tr class="row-odd"><td>MolFileInfo</td>
<td>CTABのinfo行からの読み込みと書き込み</td>
</tr>
<tr class="row-even"><td>_MolFileChiralFlag</td>
<td>CTABのキラルフラグからの読み込みと書き込み</td>
</tr>
<tr class="row-odd"><td>_Name</td>
<td>CTABのname行からの読み込みと書き込み</td>
</tr>
<tr class="row-even"><td>_smilesAtomOutputOrder</td>
<td>SMILESに書かれている原子の順番</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="atom">
<h4>Atom<a class="headerlink" href="#atom" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#atom">Atom</a>]</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">プロパティの名称</th>
<th class="head">使用用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>_CIPCode</td>
<td>原子のCIPコード（RかSか）</td>
</tr>
<tr class="row-odd"><td>_CIPRank</td>
<td>原子の整数値のCIPランク</td>
</tr>
<tr class="row-even"><td>_ChiralityPossible</td>
<td>原子が不斉中心になる可能性がある場合にセットされる</td>
</tr>
<tr class="row-odd"><td>_MolFileRLabel</td>
<td>原子に貼られる整数値のRグループラベルで、CTABからの読み込みと書き込みが行われる</td>
</tr>
<tr class="row-even"><td>_ReactionDegreeChanged</td>
<td>反応において級（degree）が変化したときに、生成物のテンプレートの原子にセットされる</td>
</tr>
<tr class="row-odd"><td>_protected</td>
<td>このプロパティがセットされた原子は反応において、マッチングする反応物質の原子の対象から外れる</td>
</tr>
<tr class="row-even"><td>dummyLabel</td>
<td>（ダミー原子のラベルで）アトムシンボルとしてCTABからの読み込みと書き込みが行われる</td>
</tr>
<tr class="row-odd"><td>molAtomMapNumber</td>
<td>原子のアトムマップナンバーで、SMILESとCTABからの読み込みと書き込みに使われる</td>
</tr>
<tr class="row-even"><td>molfileAlias</td>
<td>（Aタグに続く）原子のmolファイルのエイリアスで、CTABからの読み込みと書き込みが行われる</td>
</tr>
<tr class="row-odd"><td>molFileValue</td>
<td>（Vタグに続く）原子のmolファイルの値で、CTABからの読み込みと書き込みが行われる</td>
</tr>
<tr class="row-even"><td>molFileInversionFlag</td>
<td><div class="first last line-block">
<div class="line">反応で原子の立体化学が変化したか否かを示すのに使われるフラグで、</div>
<div class="line">CTABからの読み込みと書き込みが行われ、SMILESから自動的に決定される</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>molRxnComponent</td>
<td>反応のどの構成要素に原子が属するかを示し、CTABからの読み込みと書き込みが行われる</td>
</tr>
<tr class="row-even"><td>molRxnRole</td>
<td><div class="first last line-block">
<div class="line">反応において原子がどのような役割を担うか（1=反応物質、2=生成物、3=試薬）で、</div>
<div class="line">CTABからの読み込みと書き込みが行われる</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>smilesSymbol</td>
<td>SMILESに書き込まれる原子のシンボルを決定する</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id27">
<h3>スレッドの安全性とRDKit<a class="headerlink" href="#id27" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#thread-safety-and-the-rdkit">Thread safety and the RDKit</a>]</p>
<p>RDKitを書いている間、コードがマルチスレッド環境でも作動することを保証するために、グローバル変数の使用を避けることや、その他のことを試みました。
ですが、コードスレッドを安全にすることは全くもって些細なことではなく、いくつかギャップがあることは疑いようがありません。
このセクションでは、どのコードベースが、スレッドの安全性のために実際にテスト済みのものかついて説明します。</p>
<dl class="docutils">
<dt><strong>注</strong>:<code class="docutils literal"><span class="pre">numThreads</span></code> 引数をとる少数のメソッドと関数を例外として、このセクションはRDKitをPythonのスレッドから使う際にはあてはまりません。</dt>
<dd>Boost.Pythonはどの時点においてもスレッド一つだけがC++コードを呼び出すことを保証します。
Pythonで並列処理を行うにはmultiprocessingモジュールを使うか、他の標準的なPythonの方法を使ってください。</dd>
</dl>
<div class="section" id="id28">
<h4>テスト済みのもの<a class="headerlink" href="#id28" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#what-has-been-tested">What has been tested</a>]</p>
<ul class="simple">
<li>SMILES/SMARTS/Mol blockからの分子の読み込み</li>
<li>SMILES/SMARTS/Mol blockへの分子の書き込み</li>
<li>2D座標の生成</li>
<li>ディスタンスジオメトリー法のコードを使った3Dコンフォメーションの生成</li>
<li>UFFあるいはMMFFを使った分子の最適化</li>
<li>フィンガープリントの生成</li>
<li>$RDBASE/Code/GraphMol/Descriptors内にある記述子の計算機</li>
<li>部分構造探索（注:クエリの分子が再起的なクエリを含む場合、マルチスレッドで並行して使うのは安全ではないかもしれません。下記を参照してください）</li>
<li>Subgraphコード</li>
<li>ChemTransformsコード</li>
<li>chemical reactionsコード</li>
<li>Open3DAlignコード</li>
<li>MolDraw2D 描画コード</li>
</ul>
</div>
<div class="section" id="id29">
<h4>把握済みの問題<a class="headerlink" href="#id29" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#known-problems">Known problems</a>]</p>
<ul class="simple">
<li>InChiの生成と（おそらく）解析。これはIUPACInChiコードの限界である様に見えます。
コードをマルチスレッド環境で使える様にするため、確実に一度にスレッド一つだけがIUPACコードを使うことを保証するようミューテックスが使われます。
これはRDKitが``RDK_TEST_MULTITHREADED`` オプションを有効にしてビルドされている場合のみ利用可能です。</li>
<li>MolSuppliers(例えばSDMolSupplierやSmilesMolSupplier？)は分子が読み込まれたときに内部の状態を変えます。２つ以上のスレッドで一つのsupplierを使うのは安全ではありません。</li>
<li>再起的なクエリを含むクエリ分子を使った部分構造検索。再起的クエリは検索が実行されているとき内部の状態を修正します。
したがって同じクエリをマルチスレッドで並行して使うのは安全ではありません。
コードが``RDK_BUILD_THREADSAFE_SSS`` 引数を使って作られている場合（我々が提供しているバイナリのデフォルトです）、
一度にスレッド一つだけが与えられた再起的クエリを使っていることを確実に保証するためミューテックスが使われます。</li>
</ul>
</div>
</div>
<div class="section" id="tpsa">
<h3>TPSA記述子の実装<a class="headerlink" href="#tpsa" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#implementation-of-the-tpsa-descriptor">Implementation of the TPSA Descriptor</a>]</p>
<p>RDKitに実装されているトポロジカル極性表面積（TPSA）記述子は、Peter Ertlらによる文献（<a class="reference external" href="https://pubs.acs.org/doi/abs/10.1021/jm000942e">https://pubs.acs.org/doi/abs/10.1021/jm000942e</a>)
に説明されています。RDKitの実装はこの文献に記載されているものと異なります。このセクションでは違いと、なぜ異なるのかについて説明します。</p>
<p>RDKitのTPSAの実装ではデフォルトではNとO原子からの寄与のみ含んでいます。
ですが、TPSAの文献のTable 1はNとOに加えて極性のSとPについてのパラメータを含んでいます。何が起こっているのでしょうか？</p>
<p>Daylight Contrib dir (<a class="reference external" href="http://www.daylight.com/download/contrib/tpsa.html">http://www.daylight.com/download/contrib/tpsa.html</a>) の元々のTPSAの実装では極性のSあるいはPからの寄与を含んでおらず、
TPSAの文献に含まれている参照値もSやPの寄与を含んでいないということがわかりました。例えば、Table 3に提示されているホスカルネット（SMILES``OC(=O)P(=O)(O)O`` ）
のTPSAは94.8ですが、Oの寄与の合計-<code class="docutils literal"><span class="pre">3x20.23</span> <span class="pre">+</span> <span class="pre">2x17.07</span> <span class="pre">=</span> <span class="pre">94.8</span></code> -に一致します。
Pの寄与-<code class="docutils literal"><span class="pre">9.81</span></code> -を加えるとPSAの値は104.6となります。これはTable 3のPとSを含む他の化合物にも当てはまります。</p>
<p>RDKitの実装では、<code class="docutils literal"><span class="pre">tpsa.c</span></code> Contribプログラムの挙動と文献のTable 3で提示されているものを再現することを選択しました。
したがって極性のSとPは無視されます。RDKitユーザーの何名かからリクエストがあったので、RDKitの``2018.09`` リリースからSとPの寄与を含めるオプションを加えました。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">Descriptors</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Descriptors</span><span class="o">.</span><span class="n">TPSA</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OC(=O)P(=O)(O)O&#39;</span><span class="p">))</span> <span class="c1"># foscarnet</span>
<span class="go">94.83</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Descriptors</span><span class="o">.</span><span class="n">TPSA</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OC(=O)P(=O)(O)O&#39;</span><span class="p">),</span> <span class="n">includeSandP</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">104.64...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Descriptors</span><span class="o">.</span><span class="n">TPSA</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ccccc1N1C(=O)c2cc(S(N)(=O)=O)c(Cl)cc2NC1C&#39;</span><span class="p">))</span> <span class="c1"># metolazone</span>
<span class="go">92.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Descriptors</span><span class="o">.</span><span class="n">TPSA</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ccccc1N1C(=O)c2cc(S(N)(=O)=O)c(Cl)cc2NC1C&#39;</span><span class="p">),</span> <span class="n">includeSandP</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">100.88</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id30">
<h2>脚注<a class="headerlink" href="#id30" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="smirks" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[1]</a></td><td><a class="reference external" href="http://www.daylight.com/dayhtml/doc/theory/theory.smirks.html">http://www.daylight.com/dayhtml/doc/theory/theory.smirks.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id31" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td><em>(<a class="fn-backref" href="#id4">1</a>, <a class="fn-backref" href="#id8">2</a>)</em> <a class="reference external" href="http://www.daylight.com/dayhtml/doc/theory/theory.smiles.html">http://www.daylight.com/dayhtml/doc/theory/theory.smiles.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id32" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[3]</td><td><em>(<a class="fn-backref" href="#id5">1</a>, <a class="fn-backref" href="#id9">2</a>, <a class="fn-backref" href="#id15">3</a>, <a class="fn-backref" href="#id23">4</a>)</em> <a class="reference external" href="http://www.daylight.com/dayhtml/doc/theory/theory.smarts.html">http://www.daylight.com/dayhtml/doc/theory/theory.smarts.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="intramolrxn" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[4]</a></td><td>Thanks to James Davidson for this example.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="chiralrxn" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[5]</a></td><td>Thanks to JP Ebejer and Paul Finn for this example.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="id33">
<h2>ライセンス<a class="headerlink" href="#id33" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html#license">License</a>]</p>
<p>この文書の著作権は copyright (C) 2013-2018 by Greg Landrum に所属しています。</p>
<p>この文書はCreative Commons Attribution-ShareAlike 4.0 Licenseのもとでライセンスされています。
このライセンスを見るためには <a class="reference external" href="http://creativecommons.org/licenses/by-sa/4.0/">http://creativecommons.org/licenses/by-sa/4.0/</a> にアクセスするか、
Creative Commons, 543 Howard Street, 5th Floor, San Francisco, California, 94105, USA.　に手紙を送ってください。</p>
<p>このライセンスの意図はRDKitそのものの意図と似ています。
簡単に言えば“これを使ってなんでもやりたいことをやっていいですが、私たちの功績についても言及してください”</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="RDKit_cookbook_jp.html" class="btn btn-neutral float-right" title="RDKitクックブック" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Getting_Started_with_RDKit_in_Python_jp.html" class="btn btn-neutral" title="PythonでRDKitを始めよう" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, anonymous

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'1.00',
              LANGUAGE:'ja',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
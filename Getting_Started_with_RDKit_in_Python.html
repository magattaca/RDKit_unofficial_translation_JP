<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PythonでRDKitを始めよう &#8212; RDKit_unofficial_translation_JP 1.00 ドキュメント</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.00',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pythonrdkit">
<h1>PythonでRDKitを始めよう<a class="headerlink" href="#pythonrdkit" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#getting-started-with-the-rdkit-in-python">Getting Started with RDKit in Python</a>]</p>
<div class="section" id="id1">
<h2>このページについて<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#what-is-this">What is this?</a>]</p>
<p>このページはどうすればPythonからRDKitの機能を使うことができるか、その大まかな見取り図を提供することを目的としています。網羅的なものではありませんし、マニュアルでもありません。</p>
<p>間違いに気づいた場合や、こうした方が良いといった提案があればソースドキュメント(.rstファイル)をご自身で修正するか、もしくはメーリングリスト（<a class="reference external" href="mailto:rdkit-devel&#37;&#52;&#48;lists&#46;sourceforge&#46;net">rdkit-devel<span>&#64;</span>lists<span>&#46;</span>sourceforge<span>&#46;</span>net</a>）に送ってください。特に、ここに書かれていないことで、どうすれば良いか解決するのに時間がかかったことがあれば、ぜひ書き加えてください。このページへの貢献はRDKitコミュニティにもあなた自身の将来にとっても、とてもためになるでしょう。</p>
</div>
<div class="section" id="id2">
<h2>分子の読み込みと書き込み<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#reading-and-writing-molecules">Reading and Writing Molecules</a>]</p>
<div class="section" id="back-to-ref-1">
<span id="id3"></span><h3>1分子の読み込み<a class="headerlink" href="#back-to-ref-1" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#reading-single-molecules">Reading single molecules</a>]</p>
<p>基本的な分子を取り扱う機能の多くは<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.html#module-rdkit.Chem">rdkit.Chem</a>モジュールに含まれています。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
</pre></div>
</div>
<p>一つ一つの分子は様々な方法で構築することができます。例えば：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromMolFile</span><span class="p">(</span><span class="s1">&#39;data/input.mol&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stringWithMolData</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;datainput.mol&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromMolBlock</span><span class="p">(</span><span class="n">stringWithMolData</span><span class="p">)</span>
</pre></div>
</div>
<p>うまくいけばこれらの関数はすべて<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdchem.html#rdkit.Chem.rdchem.Mol">rdkit.Chem.rdchem.Mol</a>オブジェクトを返します。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;rdkit.Chem.rdchem.Mol object at 0x...&gt;</span>
</pre></div>
</div>
<p>失敗した場合は None を返します：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromMolFile</span><span class="p">(</span><span class="s1">&#39;data/invalid.mol&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
<p>エラーメッセージの感覚を掴むためにわざとおかしなことをしてみましょう：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CO(C)C&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>以下のようなメッセージが表示されます:<code class="docutils literal"><span class="pre">[12:18:01]</span> <span class="pre">Explicit</span> <span class="pre">valence</span> <span class="pre">for</span> <span class="pre">atom</span> <span class="pre">#</span> <span class="pre">1</span> <span class="pre">O</span> <span class="pre">greater</span> <span class="pre">than</span> <span class="pre">permitted</span></code>また、</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1cc1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>このようなメッセージが出ます：<code class="docutils literal"><span class="pre">[12:20:41]</span> <span class="pre">Can't</span> <span class="pre">kekulize</span> <span class="pre">mol</span></code>。どちらの場合も<code class="docutils literal"><span class="pre">None</span></code>値が返されます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-1"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="id4">
<h3>まとまった数の分子を読み込む<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#reading-sets-of-molecules">Reading sets of molecules</a>]</p>
<p>分子の集合はSupplierを使うことで読み込めます。 (例えば
<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolfiles.html#rdkit.Chem.rdmolfiles.SDMolSupplier">rdkit.Chem.rdmolfiles.SDMolSupplier</a>や<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolfiles.html#rdkit.Chem.rdmolfiles.SmilesMolSupplier">rdkit.Chem.rdmolfiles.SmilesMolSupplier</a>などです。)</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">suppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/5ht3ligs.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">suppl</span><span class="p">:</span>
<span class="gp">... </span>  <span class="nb">print</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">20</span>
<span class="go">24</span>
<span class="go">24</span>
<span class="go">26</span>
</pre></div>
</div>
<p>Supplierから簡単に分子のリストを作ることが可能です。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suppl</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
<span class="go">4</span>
</pre></div>
</div>
<p>あるいは単純にSupplier自体をランダムアクセスオブジェクトとして扱うことも可能です:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">suppl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
<span class="go">20</span>
</pre></div>
</div>
<p>グッドプラクティスとしては、個々の分子が正しく読み込まれているかどうか、処理を行うまえにテストすることをお勧めします：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">suppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/5ht3ligs.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">suppl</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
<span class="gp">... </span>  <span class="nb">print</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">20</span>
<span class="go">24</span>
<span class="go">24</span>
<span class="go">26</span>
</pre></div>
</div>
<p>Supplierの代わりとなるものとして、ファイルのようなオブジェクトから読みこむ際に、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolfiles.html#rdkit.Chem.rdmolfiles.ForwardSDMolSupplier">rdkit.Chem.rdmolfiles.ForwardSDMolSupplier</a>が使えます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">inf</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/5ht3ligs.sdf&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fsuppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">ForwardSDMolSupplier</span><span class="p">(</span><span class="n">inf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">fsuppl</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
<span class="gp">... </span>  <span class="nb">print</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">20</span>
<span class="go">24</span>
<span class="go">24</span>
<span class="go">26</span>
</pre></div>
</div>
<p>つまり、圧縮ファイルから読み込む際にも使えます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gzip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">inf</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/actives_5ht3.sdf.gz&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gzsuppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">ForwardSDMolSupplier</span><span class="p">(</span><span class="n">inf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gzsuppl</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
<span class="go">180</span>
</pre></div>
</div>
<p>ForwardSDMolSuppliersはランダムアクセスオブジェクトとしては使えないことに気をつけてください。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fsuppl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">&#39;ForwardSDMolSupplier&#39; object does not support indexing</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>分子の書き込み<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#writing-molecules">Writing molecules</a>]</p>
<p>分子が一つの場合、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.html#module-rdkit.Chem">rdkit.Chem</a>モジュールにある複数の関数でテキスト形式に変換することができます。</p>
<p>例えば、SMILESに変換したい場合次のようにします：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromMolFile</span><span class="p">(</span><span class="s1">&#39;data/chiral.mol&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">&#39;C[C@H](O)c1ccccc1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">isomericSmiles</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">&#39;CC(O)c1ccccc1&#39;</span>
</pre></div>
</div>
<p>生成されるSMILESはcanonical SMILESであることに注視してください。つまりインプットとしてどのように分子を読み込んだとしても、同じ分子に対しては同じSMILESがアウトプットされます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=CC=CN=C1&#39;</span><span class="p">))</span>
<span class="go">&#39;c1ccncc1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1cccnc1&#39;</span><span class="p">))</span>
<span class="go">&#39;c1ccncc1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;n1ccccc1&#39;</span><span class="p">))</span>
<span class="go">&#39;c1ccncc1&#39;</span>
</pre></div>
</div>
<p>もしケクレ形式のSMILESを作りたいなら、最初に分子をケクレ化したのち“kekuleSmiles”オプションを使ってください。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">Kekulize</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">kekuleSmiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;C[C@H](O)C1=CC=CC=C1&#39;</span>
</pre></div>
</div>
<p>この記事を記載している時点（2008年8月）で、kekuleSmilesをリクエストすると生成されるSMILESはカノニカルではありません。SMILESの生成段階ではなく、ケクレ化の段階自体に限界があります。</p>
<p>MDL Mol block も利用可能です：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1CCC1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>

<span class="go">     RDKit          2D</span>

<span class="go">  4  4  0  0  0  0  0  0  0  0999 V2000</span>
<span class="go">    1.0607    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -0.0000   -1.0607    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -1.0607    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">    0.0000    1.0607    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">  1  2  1  0</span>
<span class="go">  2  3  1  0</span>
<span class="go">  3  4  1  0</span>
<span class="go">  4  1  1  0</span>
<span class="go">M  END</span>
</pre></div>
</div>
<p>mol
blockに名前を含めるためには、分子の<code class="docutils literal"><span class="pre">&quot;_Name&quot;</span></code>プロパティをセットしてください：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="s2">&quot;_Name&quot;</span><span class="p">,</span><span class="s2">&quot;cyclobutane&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
<span class="go">cyclobutane</span>
<span class="go">     RDKit          2D</span>

<span class="go">  4  4  0  0  0  0  0  0  0  0999 V2000</span>
<span class="go">    1.0607    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -0.0000   -1.0607    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -1.0607    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">    0.0000    1.0607    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">  1  2  1  0</span>
<span class="go">  2  3  1  0</span>
<span class="go">  3  4  1  0</span>
<span class="go">  4  1  1  0</span>
<span class="go">M  END</span>
</pre></div>
</div>
<p>ほとんどのソフトウェアで原子や結合の立体化学を正しく認識させるためには、mol blockが原子座標を含むことが必須です。
また分子を描画する、といった様々な理由で原子座標は便利です。デフォルトでは座標を持たない分子のmol blockを生成させると、自動的に座標が生成されます。
ですが、これらは分子には格納されません。<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.AllChem.html#module-rdkit.Chem.AllChem">rdkit.Chem.AllChem</a>モジュールの機能を使うと、座標を生成させ、分子に格納することができます。
（より詳細な情報は<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chem-vs-allchem">Chem vs AllChem</a>セクションを参照してください。）</p>
<p>格納できる座標としてはまず2Dの座標（すなわち描画）があります:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
<span class="go">cyclobutane</span>
<span class="go">     RDKit          2D</span>

<span class="go">  4  4  0  0  0  0  0  0  0  0999 V2000</span>
<span class="go">    1.0607   -0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -0.0000   -1.0607    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -1.0607    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">    0.0000    1.0607    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">  1  2  1  0</span>
<span class="go">  2  3  1  0</span>
<span class="go">  3  4  1  0</span>
<span class="go">  4  1  1  0</span>
<span class="go">M  END</span>
</pre></div>
</div>
<p>あるいは分子に埋め込む（embedする）ことで3D座標を付け加えることもできます（この例ではETKDG法を使用しています。ETKDG法についてはより詳細に下で説明します。）</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMolecule</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
<span class="go">cyclobutane</span>
<span class="go">     RDKit          3D</span>

<span class="go">  4  4  0  0  0  0  0  0  0  0999 V2000</span>
<span class="go">   -0.8321    0.5405   -0.1981 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -0.3467   -0.8825   -0.2651 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">    0.7190   -0.5613    0.7314 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">    0.4599    0.9032    0.5020 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">  1  2  1  0</span>
<span class="go">  2  3  1  0</span>
<span class="go">  3  4  1  0</span>
<span class="go">  4  1  1  0</span>
<span class="go">M  END</span>
</pre></div>
</div>
<p>良い３Dコンフォメーションを得るには、ほとんどの場合、まず初めに水素原子を分子に付加すること上手くいきます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMolecule</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>この付加した水素原子を取り除くこともできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">RemoveHs</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="n">m3</span><span class="p">))</span>
<span class="go">cyclobutane</span>
<span class="go">     RDKit          3D</span>

<span class="go">  4  4  0  0  0  0  0  0  0  0999 V2000</span>
<span class="go">    0.3497    0.9755   -0.2202 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">    0.9814   -0.3380    0.2534 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -0.3384   -1.0009   -0.1474 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">   -0.9992    0.3532    0.1458 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">  1  2  1  0</span>
<span class="go">  2  3  1  0</span>
<span class="go">  3  4  1  0</span>
<span class="go">  4  1  1  0</span>
<span class="go">M  END</span>
</pre></div>
</div>
<p>分子をファイルに書き込みたい時にはPythonファイルオブジェクトを使ってください：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="n">m2</span><span class="p">),</span><span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/foo.mol&#39;</span><span class="p">,</span><span class="s1">&#39;w+&#39;</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>分子の集合を書き出す方法<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#writing-sets-of-molecules">Writing sets of molecules</a>]</p>
<p>分子が複数ある場合は<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolfiles.html#rdkit.Chem.rdmolfiles.SDWriter">rdkit.Chem.rdmolfiles.SDWriter</a>オブジェクトを使うことでファイルに書き出すことができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDWriter</span><span class="p">(</span><span class="s1">&#39;data/foo.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>SDWriterはfile-likeなオブジェクトを使っても初期化することができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.six</span> <span class="k">import</span> <span class="n">StringIO</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDWriter</span><span class="p">(</span><span class="n">sio</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mols</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">w</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">sio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
<span class="go">mol-295</span>
<span class="go">     RDKit          3D</span>

<span class="go"> 20 22  0  0  1  0  0  0  0  0999 V2000</span>
<span class="go">    2.3200    0.0800   -0.1000 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="go">    1.8400   -1.2200    0.1200 C   0  0  0  0  0  0  0  0  0  0  0  0</span>
<span class="gp">...</span>
<span class="go">  1  3  1  0</span>
<span class="go">  1  4  1  0</span>
<span class="go">  2  5  1  0</span>
<span class="go">M  END</span>
<span class="go">$$$$</span>
</pre></div>
</div>
<p>他に利用可能な書き込み用のモジュールとして、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolfiles.html#rdkit.Chem.rdmolfiles.SmilesWriter">rdkit.Chem.rdmolfiles.SmilesWriter</a>と<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolfiles.html#rdkit.Chem.rdmolfiles.TDTWriter">rdkit.Chem.rdmolfiles.TDTWriter</a>があります。</p>
</div>
</div>
<div class="section" id="id7">
<h2>分子の取り扱い方<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#working-with-molecules">Working with Molecules</a>]</p>
<div class="section" id="back-to-ref-2">
<span id="id8"></span><h3>原子、結合をループする<a class="headerlink" href="#back-to-ref-2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#looping-over-atoms-and-bonds">Looping over Atoms and Bonds</a>]</p>
<p>分子さえ準備できれば、原子と結合をループするのは簡単です:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1OC1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
<span class="gp">... </span>  <span class="nb">print</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">6</span>
<span class="go">8</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">())</span>
<span class="go">SINGLE</span>
</pre></div>
</div>
<p>一つ一つの結合や原子をリクエストすることも可能です:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetSymbol</span><span class="p">()</span>
<span class="go">&#39;C&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetExplicitValence</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">()</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondBetweenAtoms</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">()</span>
<span class="go">rdkit.Chem.rdchem.BondType.SINGLE</span>
</pre></div>
</div>
<p>各原子にはそれぞれの隣接する原子についての情報も含まれます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">atom</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()]</span>
<span class="go">[8, 6]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetNeighbors</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">())</span>
<span class="go">2</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-2"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="back-to-ref-3">
<span id="id9"></span><h3>環の情報<a class="headerlink" href="#back-to-ref-3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#ring-information">Ring Information</a>]</p>
<p>原子と結合はどちらも分子の環構造についての情報をもっています：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OC1C2C1CC2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRing</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRing</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRingSize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRingSize</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRingSize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRingSize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRing</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>ただし、最小の環構造についての情報だけであることに注意してください：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">IsInRingSize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>“最小の環構造についての最小のセット”（SSSR: Smallest Set of Smallest
Rings）についてのより詳細な情報も利用可能です：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ssr</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">GetSymmSSSR</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ssr</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ssr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">ssr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">[4, 5, 2, 3]</span>
</pre></div>
</div>
<p>名前が示すように、これは対称化（symmetrized）されたSSSRです。もし“本当の”SSSRの数について知りたければ、GetSSSR
関数を使ってください。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">GetSSSR</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>対称化されたSSSRと対称化されていないSSSRの違いについては<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#the-sssr-problem">The SSSR Problem</a>セクションでより詳細に議論されています。</p>
<p>分子の環構造について、より効率的なクエリー（Mol.GetAtomWithIdxを繰り返し呼び出すことを避ける方法）を使用するには、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdchem.html#rdkit.Chem.rdchem.RingInfo">rdkit.Chem.rdchem.RingInfo</a>クラスを使ってください</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OC1C2C1CC2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ri</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">GetRingInfo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ri</span><span class="o">.</span><span class="n">NumAtomRings</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ri</span><span class="o">.</span><span class="n">NumAtomRings</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ri</span><span class="o">.</span><span class="n">NumAtomRings</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ri</span><span class="o">.</span><span class="n">IsAtomInRingOfSize</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ri</span><span class="o">.</span><span class="n">IsBondInRingOfSize</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-3"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="back-to-ref-4">
<span id="id10"></span><h3>分子の修正<a class="headerlink" href="#back-to-ref-4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#modifying-molecules">Modifying molecules</a>]</p>
<p>通常、RDKitに格納された分子は水素原子が喑に扱われています（例えば、分子グラフ構造の中に水素原子は明示的にはあらわれません）。
３次元の幾何構造を生成したり、最適化するといった、水素原子を明示的に扱うことが役立つ場合には、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.AddHs">rdkit.Chem.rdmolops.AddHs()</a>関数を使うことができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCO&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
<span class="go">9</span>
</pre></div>
</div>
<p>水素原子は<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.RemoveHs">rdkit.Chem.rdmolops.RemoveHs()</a>関数を使うことで取り除くことができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">RemoveHs</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m3</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
<span class="go">3</span>
</pre></div>
</div>
<p>RDKitの分子は通常、芳香環の結合は芳香族の結合タイプの情報とともに格納されています。これは<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.Kekulize">rdkit.Chem.rdmolops.Kekulize()</a>関数を使うことで変更することが可能です。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">()</span>
<span class="go">rdkit.Chem.rdchem.BondType.AROMATIC</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">Kekulize</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">()</span>
<span class="go">rdkit.Chem.rdchem.BondType.DOUBLE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">()</span>
<span class="go">rdkit.Chem.rdchem.BondType.SINGLE</span>
</pre></div>
</div>
<p>デフォルトでは元の分子フラグが消去されていないため、結合はまだ芳香族として認識されています（clearAromaticFlagsのデフォルトはFalseです）。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>フラグを消去するか否かは、明示的に設定（フラグをつける（True）、つけない(False)）できます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">Kekulize</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">clearAromaticFlags</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetIsAromatic</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.SanitizeMol">rdkit.Chem.rdmolops.SanitizeMol()</a>関数を使えば、結合のタイプを芳香族に戻すことも可能です。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">rdkit.Chem.rdmolops.SanitizeFlags.SANITIZE_NONE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetBondType</span><span class="p">()</span>
<span class="go">rdkit.Chem.rdchem.BondType.AROMATIC</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">SanitizeMol()</span></code> の戻り値は問題なく実行できたことを示しています。</p>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-4"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="d">
<h3>2Dの分子の取り扱い：描画の生成<a class="headerlink" href="#d" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#working-with-2d-molecules-generating-depictions">Working with 2D molecules: Generating Depictions</a>]</p>
<p>RDkitには分子の描画（2次元座標のセット）を生成するためのライブラリーがあります。AllChemモジュールに含まれるこのライブラリーは<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdDepictor.html#rdkit.Chem.rdDepictor.Compute2DCoords">rdkit.Chem.rdDepictor.Compute2DCoords()</a>関数によりアクセスできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1nccc2n1ccc2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>2次元のコンフォメーションは標準化された向き（カノニカルな方向づけ）で構築されます。また、描画が最も明確になるように、分子内の重なりを最小化するように作られます。</p>
<p>共通骨格を有する複数の分子のセットがあり、その骨格に対して揃えて並べたい場合は、以下のようにしてください。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">template</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1nccc2n1ccc2&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">GenerateDepictionMatching2DStructure</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">template</span><span class="p">)</span>
</pre></div>
</div>
<p>上記のプロセスをいくつかの分子に適用すると以下のような図が得られます。</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="_images/picture_1.png"><img alt="picture_1" src="_images/picture_1.png" style="width: 225.0px; height: 225.0px;" /></a></td>
<td><a class="reference internal" href="_images/picture_0.png"><img alt="picture_0" src="_images/picture_0.png" style="width: 225.0px; height: 225.0px;" /></a></td>
<td><a class="reference internal" href="_images/picture_3.png"><img alt="picture_3" src="_images/picture_3.png" style="width: 225.0px; height: 225.0px;" /></a></td>
</tr>
</tbody>
</table>
<p>Compute2DCoordsのもう一つのオプションをつかうと、3Dコンフォメーションを近似した２次元描画を生成することができます。<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdDepictor.html?highlight=generatedepictionmatching3dstructure#rdkit.Chem.rdDepictor.GenerateDepictionMatching3DStructure">rdkit.Chem.AllChem.GenerateDepictionMatching3DStructure()</a>関数を使用すればできます。</p>
<p>PDB 1XP0構造の中のリガンドを使って生成した場合の結果は以下のようになります。</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="_images/picture_2.png"><img alt="picture_2" src="_images/picture_2.png" style="width: 320.0px; height: 240.0px;" /></a></td>
<td><a class="reference internal" href="_images/picture_4.png"><img alt="picture_4" src="_images/picture_4.png" style="width: 225.0px; height: 225.0px;" /></a></td>
</tr>
</tbody>
</table>
<p>コア関数の<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdDepictor.html#rdkit.Chem.rdDepictor.Compute2DCoordsMimicDistmat">rdkit.Chem.rdDepictor.Compute2DCoordsMimicDistmat</a>を使えばもっと高精細な調整が可能ですが、このページの範囲を超えているためここでは触れません。使用例はAllChem.py の GenerateDepictionMatching3DStructureの実装を参照してください。</p>
</div>
<div class="section" id="back-to-ref-5">
<span id="id11"></span><h3>3D分子の取り扱い<a class="headerlink" href="#back-to-ref-5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#working-with-3d-molecules">Working with 3D Molecules</a>]</p>
<p>RDKitで分子のコンフォメーションを生成するには２つの方法があります。元々はDistance Geometry法を使っていました 。<a class="footnote-reference" href="#blaney" id="id12">[1]</a></p>
<p>アルゴリズム流れは次のようになります:</p>
<ol class="arabic simple">
<li>対象の分子の原子結合表と、一連のルールに基づいて距離拘束条件の行列（distance bounds matrix）を計算</li>
<li>拘束条件行列は三角拘束スムージングアルゴリズム（triangle-bounds smoothing algorithm）を使ってスムージング</li>
<li>拘束条件行列を満たす距離行列をランダムに生成</li>
<li>生成された距離行列を3次元に埋め込み（各原子の座標を生成）</li>
<li>生成した座標を、粗い力場（crude force field）と拘束条件行列を用いてクリーンアップ</li>
</ol>
<p>この手順で生成されるコンフォメーションはかなり粗いものである傾向があることに気をつけてください。力場を用いたクリーンアップが必要となりますが、RDKitに実装されているUniversal
Force Field (UFF)を使うことができます。 <a class="footnote-reference" href="#rappe" id="id13">[2]</a></p>
<p>最近になって、RinikerとLandrumの方法が実装されました <a class="footnote-reference" href="#riniker2" id="id14">[18]</a>。
この方法では、Distance Geometry法を用いて生成したコンフォマーを、Cambridge Structural Database(CSD)から導いた、
優先される二面角の傾向を使って修正します。この方法を使うことで、構造をクリーンアップするための最小化ステップが必要なくなります。</p>
<p>RDKit 2018.09 リリース版から、ETKDGがコンフォメーション生成法のデフォルトとなりました。</p>
<p>上述の冗長な方法と比べて、分子の埋め込みの全工程がより簡単になっているので、ETKDGの有用性がわかります。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMolecule</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>RDKitではMMFF94力場の実装も使用可能です <a class="footnote-reference" href="#mmff1" id="id15">[12]</a>, <a class="footnote-reference" href="#mmff2" id="id16">[13]</a>, <a class="footnote-reference" href="#mmff3" id="id17">[14]</a>, <a class="footnote-reference" href="#mmff4" id="id18">[15]</a>, <a class="footnote-reference" href="#mmffs" id="id19">[16]</a> 。
MMFFの原子タイプを設定するコードは独自の芳香族モデルを使用するため、MMFFに関係する方法を呼び出した後で、分子の芳香族性フラグが修正されることに注意してください。</p>
<p>MMFF94を使ってRDKitで生成したコンフォマーを最小化する例です:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1CCC1OC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMolecule</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">MMFFOptimizeMolecule</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="go">0</span>
</pre></div>
</div>
<p>上記の例で<code class="docutils literal"><span class="pre">Chem.AddHs()</span></code>を呼び出していることに注意してください。デフォルトではRDKitの分子はグラフの中に水素原子を明示的に保持していませんが、
本物らしい幾何構造を得るには重要です。したがって、一般的には水素原子を付加する必要があります。必要とあらば<code class="docutils literal"><span class="pre">Chem.RemoveHs()</span></code>を呼び出すことで、いつでも後から削除できます。</p>
<p>RDKitでは複数のコンフォマーを異なる埋め込み方法を使って生成することもできます。いずれの場合も、異なるランダムな出発点からdistance geometry計算を複数回実行するだけです。
<code class="docutils literal"><span class="pre">numConfs</span></code> オプションを使うことで、生成するコンフォマーの数をセットすることができます。オプションの設定以外は上述の方法と同じです。
複数生成されたコンフォマーは互いにアラインメントを取ることができ、RMS値を計算できます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1CCC1OC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">AddHs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># run ETKDG 10 times</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cids</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMultipleConfs</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">numConfs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">))</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rmslist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">AlignMolConformers</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">RMSlist</span><span class="o">=</span><span class="n">rmslist</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslist</span><span class="p">))</span>
<span class="go">9</span>
</pre></div>
</div>
<p>rmslistは最初のコンフォマーとその他すべてのコンフォマーのそれぞれとのRMS値を含むリストです。特定の２つのコンフォマー（例えば1と9）のRMSを計算することも可能です。
コンフォマーのアラインメントがすでに取られている場合、prealignedフラグにより明示することができます（デフォルトではこの関数はコンフォマーのアラインメントを取ります）。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rms</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetConformerRMS</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">prealigned</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>（ETKDGを使った場合、大抵不要ですが）コンフォマーにMMFF94を実行したい場合、簡易関数を利用することができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">MMFFOptimizeMoleculeConfs</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
</pre></div>
</div>
<p>それぞれのコンフォマーについて二つのタプル（<em>not_converged</em>,<em>energy</em>）を含むリストが返されます。
<em>not_converged</em>が0なら、そのコンフォマーの最小化は収束しています。</p>
<p>デフォルトでは<code class="docutils literal"><span class="pre">AllChem.EmbedMultipleConfs</span></code>と<code class="docutils literal"><span class="pre">AllChem.MMFFOptimizeMoleculeConfs()</span></code>は単一スレッドで実行しますが、
<code class="docutils literal"><span class="pre">numThreads</span></code>引数をつかって驚異的並列処理（embarassingly parallel task）を実行するためにマルチスレッドを同時に使うこともできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cids</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">EmbedMultipleConfs</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">numThreads</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">MMFFOptimizeMoleculeConfs</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">numThreads</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">numThreads</span></code>を0に設定することで、あなたのコンピュータで許可されている最大数のスレッドをつかうことができます</p>
<p><em>免責/警告</em>:
コンフォメーションの生成は難しく、かつ微妙なタスクです。
RDKitで提供されている元々の2Dから3D変換は「リアル」なコンフォメーションを分析する手段の代替とすることを意図したものではありません。
単に必要な時に素早く3D構造を提供するためのものです。ですが、我々は新しいETKDG法 <a class="footnote-reference" href="#riniker2" id="id20">[18]</a> はほとんどの目的の場合に適うと信じています。</p>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-5"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="id21">
<h3>分子の保存<a class="headerlink" href="#id21" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#preserving-molecules">Preserving Molecules</a>]</p>
<p>Pythonの”pickle化&#8221;機能をつかうことで、分子をテキストへ変換することも、テキストから分子に変換することもできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccncc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pkl</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pkl</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="go">&#39;c1ccncc1&#39;</span>
</pre></div>
</div>
<p>RDKitのpickel形式はかなりコンパクトで、MolファイルやSMILES文字列から分子を構築するよりもpickelからの構築の方がとても速いです。ですので、繰り返し扱う分子はpickelとして保存しておくのが良いでしょう。</p>
<p>pickelに含まれている生のバイナリデータは分子から直接取得することもできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">binStr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">ToBinary</span><span class="p">()</span>
</pre></div>
</div>
<p>Chem.Molコンストラクタを使ってバイナリデータから分子を再構築することも可能です。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">(</span><span class="n">binStr</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<span class="go">&#39;c1ccncc1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">binStr</span><span class="p">)</span>
<span class="go">123</span>
</pre></div>
</div>
<p>これはpickleよりも小さいことに注目してください。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">binStr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkl</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>より大きなサイズの分子のセットを扱う際に、pickel化機能を使うことに伴う付帯的なコストは、通常はそれほど大きくはなりません（pickelに伴う余分なデータは分子のサイズとは独立のものですが、一方でバイナリ列は分子のサイズが大きくなるにつれて長くなります）。</p>
<p><em>Tip</em>:
SDファイルやSMILESのテーブルを再解析する代わりに、ディスク上にpickel形式で分子を保存することのパフォーマンスの違いは一概には言えません。
テストとして私のノートPCで実行した場合、SDファイルから699個のドラッグライクな分子のセットを読み込むのに10.8秒、pickelファイルからは0.7秒かかりました。
また、pickelファイルはファイルサイズも小さく、SDファイルの1/3でしたが、いつもこの様に劇的な差があるわけではありません（今回は特に余分が多いSDファイルでした）。</p>
</div>
<div class="section" id="id22">
<h3>分子を描く<a class="headerlink" href="#id22" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#drawing-molecules">Drawing Molecules</a>]</p>
<p>RDKitには分子から画像を生成するための機能がいくつか組み込まれており、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Draw.html#module-rdkit.Chem.Draw">rdkit.Chem.Draw</a>パッケージの中にあります。:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">suppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/cdk2.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suppl</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">:</span> <span class="n">tmp</span><span class="o">=</span><span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">Draw</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Draw</span><span class="o">.</span><span class="n">MolToFile</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;images/cdk2_mol1.o.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Draw</span><span class="o">.</span><span class="n">MolToFile</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;images/cdk2_mol2.o.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>このような画像を生成します。</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="_images/cdk2_mol1.png" class="first last" src="_images/cdk2_mol1.png" />
</td>
<td><img alt="_images/cdk2_mol2.png" class="first last" src="_images/cdk2_mol2.png" />
</td>
</tr>
</tbody>
</table>
<p>分子のセットからグリッドレイアウトの画像を作ることもできます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">=</span><span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span><span class="n">ms</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span><span class="n">molsPerRow</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">&quot;_Name&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">[:</span><span class="mi">8</span><span class="p">]])</span>
</pre></div>
</div>
<p>これはPILイメージを返し、ファイルに保存することができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;images/cdk2_molgrid.o.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>結果はこのようになります:</p>
<img alt="_images/cdk2_molgrid.png" src="_images/cdk2_molgrid.png" />
<p>もちろん共通骨格でアラインメントを取ればより見やすくなります。このように簡単にできます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;[nH]1cnc2cncnc21&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">subms</span><span class="p">)</span>
<span class="go">14</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">subms</span><span class="p">:</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GenerateDepictionMatching2DStructure</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">=</span><span class="n">Draw</span><span class="o">.</span><span class="n">MolsToGridImage</span><span class="p">(</span><span class="n">subms</span><span class="p">,</span><span class="n">molsPerRow</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">subImgSize</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span><span class="n">legends</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">&quot;_Name&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">subms</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;images/cdk2_molgrid.aligned.o.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>この様な結果が返ってきます。:</p>
<img alt="_images/cdk2_molgrid_aligned.png" src="_images/cdk2_molgrid_aligned.png" />
</div>
</div>
<div class="section" id="back-to-ref-6">
<span id="id23"></span><h2>部分構造探索<a class="headerlink" href="#back-to-ref-6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#substructure-searching">Substructure Searching</a>]</p>
<p>SMARTSから構築された分子のクエリを使えば、部分構造の一致検索ができます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">patt</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;ccO&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">patt</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetSubstructMatch</span><span class="p">(</span><span class="n">patt</span><span class="p">)</span>
<span class="go">(0, 5, 6)</span>
</pre></div>
</div>
<p>これらは<code class="docutils literal"><span class="pre">patt</span></code>に保存された原子で並べられた、分子<code class="docutils literal"><span class="pre">m</span></code>のアトムインデックスです。一致した組み合わせをすべて得るには次のようにします：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">patt</span><span class="p">)</span>
<span class="go">((0, 5, 6), (4, 5, 6))</span>
</pre></div>
</div>
<p>これを使って、分子のリストに簡単にフィルタをかけることができます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">suppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/actives_5ht3.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">patt</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;c[NH1]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">suppl</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">patt</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
<span class="go">22</span>
</pre></div>
</div>
<p>同じことをPythonのリスト内包表記をつかってより簡潔に書けます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suppl</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">patt</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
<span class="go">22</span>
</pre></div>
</div>
<p>SMARTSの代わりにSMILESから構築した分子を使用して部分構造の一致検索をすることもできます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1=CC=CC=C1OC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;CO&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CO&#39;</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
<p>ですが、二つの表記法の意味するもの（セマンティクス）が完全に等価であるわけではないことは忘れない様にしてください：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;COC&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;COC&#39;</span><span class="p">))</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;COc&#39;</span><span class="p">))</span> <span class="c1">#&lt;- need an aromatic C</span>
<span class="go">True</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-6"><span class="std std-ref">こちら</span></a>へ</p>
<div class="section" id="back-to-ref-7">
<span id="id24"></span><h3>部分構造一致検索における立体化学<a class="headerlink" href="#back-to-ref-7" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#stereochemistry-in-substructure-matches">Stereochemistry in substructure matches</a>]</p>
<p>デフォルトでは部分構造検索で立体化学に関する情報は使われません：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC[C@H](F)Cl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@H](F)Cl&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@@H](F)Cl&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(F)Cl&#39;</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">useChirality</span></code>引数によって変更可能です：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@H](F)Cl&#39;</span><span class="p">),</span><span class="n">useChirality</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@@H](F)Cl&#39;</span><span class="p">),</span><span class="n">useChirality</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(F)Cl&#39;</span><span class="p">),</span><span class="n">useChirality</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">useChirality</span></code>が設定されると非キラルクエリがキラルクエリに<strong>マッチする</strong>ことに注意してください。キラルクエリは非キラルクエリには一致しません：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(F)Cl&#39;</span><span class="p">))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCC(F)Cl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C[C@H](F)Cl&#39;</span><span class="p">),</span><span class="n">useChirality</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-7"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="smarts">
<span id="back-to-ref-8"></span><h3>SMARTSのアトムマップインデックス<a class="headerlink" href="#smarts" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#atom-map-indices-in-smarts">Atom Map Indices in SMARTS</a>]</p>
<p>SMARTSパターンの原子にインデックスをつけることができます。reaction
SMARTS（<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chemical-reactions">Chemical Reactions</a>参照）で最もよく使われますが、
より一般的なものです。例えば、Guba <em>et al.</em> (<code class="docutils literal"><span class="pre">DOI:</span> <span class="pre">acs.jcim.5b00522</span></code>)によるSMARTSパターンを使った二面角の解析では
インデックスが注目している二面角を成す４つの原子を定義するのに使われています。
芳香族とC=N構造とのなす二面角の場合は<code class="docutils literal"><span class="pre">[cH0:1][c:2]([cH0])!&#64;[CX3!r:3]=[NX2!r:4]</span></code>という様になります。
なぜrecursive SMARTSを使わなかったのだろうか、その方がもっと簡単になるのに、という疑問が頭をよぎるかもしれませんが、彼らがそうしているので仕方ありません。
<code class="docutils literal"><span class="pre">GetSubstructureMatches</span></code>で得られるアトムリストはSMARTSの順番になっていることが保証されていますが、この場合５つの原子を得るので、
正しい順番で注目している４つの原子を選び出す必要があります。SMARTSの解析が行われると、関係する原子にアトムマップナンバーのプロパティが割り当てられますが、
この情報は簡単に引き出すことができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qmol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span> <span class="s1">&#39;[cH0:1][c:2]([cH0])!@[CX3!r:3]=[NX2!r:4]&#39;</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ind_map</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">qmol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span> <span class="p">:</span>
<span class="gp">... </span>    <span class="n">map_num</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetAtomMapNum</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">map_num</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">ind_map</span><span class="p">[</span><span class="n">map_num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ind_map</span>
<span class="go">{0: 0, 1: 1, 2: 3, 3: 4}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">map_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ind_map</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">map_list</span>
<span class="go">[0, 1, 3, 4]</span>
</pre></div>
</div>
<p>次に、分子のクエリを使うと条件にマッチした４つの原子のインデックスを以下の様に得ることができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1cccc(C)c1C(C)=NC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span> <span class="n">qmol</span> <span class="p">)</span> <span class="p">:</span>
<span class="gp">... </span>    <span class="n">mas</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">map_list</span><span class="p">]</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">mas</span><span class="p">)</span>
<span class="go">[1, 7, 8, 10]</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-8"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="id25">
<h2>化学変換<a class="headerlink" href="#id25" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chemical-transformations">Chemical Transformations</a>]</p>
<p>RDKitには分子に修正を加える多数の関数があります。これらの変換用の関数は、分子に単純な修正を加えるのに簡単な方法を提供することを目的として作られていることに注意してください。
より複雑な変換を行うには<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chemical-reactions">Chemical Reactions</a>機能を使用してください。</p>
<div class="section" id="back-to-ref-9">
<span id="id26"></span><h3>部分構造ベースの変換<a class="headerlink" href="#back-to-ref-9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#substructure-based-transformations">Substructure-based transformations</a>]</p>
<p>RDKitの部分構造一致検索機能には分子の変換を素早く行うための様々な関数があります。利用可能な変換の例を挙げていくと、部分構造の削除：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">patt</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;C(=O)[OH]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rm</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">DeleteSubstructs</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">patt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">rm</span><span class="p">)</span>
<span class="go">&#39;C&#39;</span>
</pre></div>
</div>
<p>部分構造の置換：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">repl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">patt</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[$(NC(=O))]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)N&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rms</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReplaceSubstructs</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">patt</span><span class="p">,</span><span class="n">repl</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rms</span>
<span class="go">(&lt;rdkit.Chem.rdchem.Mol object at 0x...&gt;,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">rms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;COC(C)=O&#39;</span>
</pre></div>
</div>
<p>また、側鎖を取り除くといった簡単なSARテーブルの変換や：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;BrCCc1cncnc1C(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">core</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1cncnc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tmp</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">ReplaceSidechains</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="n">core</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<span class="go">&#39;[1*]c1cncnc1[2*]&#39;</span>
</pre></div>
</div>
<p>骨格の削除も可能です：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tmp</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">ReplaceCore</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="n">core</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<span class="go">&#39;[1*]CCBr.[2*]C(=O)O&#39;</span>
</pre></div>
</div>
<p>デフォルトでは側鎖は見つかった順番にラベルがつけられます。側鎖が結合した、骨格の原子の番号に従ってラベルをつけることも可能です。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1c(CCO)ncnc1C(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tmp</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">ReplaceCore</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="n">core</span><span class="p">,</span><span class="n">labelByIndex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<span class="go">&#39;[1*]CCO.[5*]C(=O)O&#39;</span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.ReplaceCore">rdkit.Chem.rdmolops.ReplaceCore()</a>は一つの分子の側鎖を返します。
これは<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.GetMolFrags">rdkit.Chem.rdmolops.GetMolFrags()</a>を使って別々の分子に分割することができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rs</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">GetMolFrags</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">asMols</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;[1*]CCO&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">&#39;[5*]C(=O)O&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-9"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="murcko">
<span id="back-to-ref-10"></span><h3>Murcko型分解<a class="headerlink" href="#murcko" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#murcko-decomposition">Murcko Decomposition</a>]</p>
<p>RDKitでは標準的なMrucko型分解 <a class="footnote-reference" href="#bemis1" id="id27">[7]</a> により分子を骨格に分割できます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.Scaffolds</span> <span class="k">import</span> <span class="n">MurckoScaffold</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cdk2mols</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/cdk2.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">cdk2mols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">core</span> <span class="o">=</span> <span class="n">MurckoScaffold</span><span class="o">.</span><span class="n">GetScaffoldForMol</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>
<span class="go">&#39;c1ncc2nc[nH]c2n1&#39;</span>
</pre></div>
</div>
<p>また、一般的な骨格にも分解できます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fw</span> <span class="o">=</span> <span class="n">MurckoScaffold</span><span class="o">.</span><span class="n">MakeScaffoldGeneric</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span>
<span class="go">&#39;C1CCC2CCCC2C1&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-10"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="back-to-ref-11">
<span id="id28"></span><h3>最大共通部分構造<a class="headerlink" href="#back-to-ref-11" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#maximum-common-substructure">Maximum Common Substructure</a>]</p>
<p>FindMCS関数は２つ以上の分子から最大共通部分構造（MCS）を見つけ出します:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">rdFMCS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;O=C(NCc1cc(OC)c(O)cc1)CCCC/C=C/C(C)C&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;CC(C)CCCCCC(=O)NCC1=CC(=C(C=C1)O)OC&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;c1(C=O)cc(OC)c(O)cc1&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol1</span><span class="p">,</span><span class="n">mol2</span><span class="p">,</span><span class="n">mol3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span>
<span class="go">&lt;rdkit.Chem.rdFMCS.MCSResult object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">numAtoms</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">numBonds</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6]1(-[#6]):[#6]:[#6](-[#8]-[#6]):[#6](:[#6]:[#6]:1)-[#8]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">canceled</span>
<span class="go">False</span>
</pre></div>
</div>
<p>FindMCS変数は、MCS中の原子と結合の番号の情報をもつMCSReultインスタンスと、見つかったMCSに一致するSMARTS文字列、
そしてアルゴリズムがタイムアウトした場合に教えてくれるフラグを返します。MCSが見つからなかった場合は、原子と結合の番号は0、SMARTSは<code class="docutils literal"><span class="pre">''</span></code>となります。</p>
<p>デフォルトでは、２つの原子は同じ元素の時に、２つの結合は同じ結合のタイプの時に一致となります。
異なる比較関数をつかうには<code class="docutils literal"><span class="pre">atomCompare</span></code>や<code class="docutils literal"><span class="pre">bondCompare</span></code>を明示してください。例えば以下の様に：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NCC&#39;</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OC=C&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">atomCompare</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">AtomCompare</span><span class="o">.</span><span class="n">CompareAny</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#7,#8]-[#6]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">bondCompare</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">BondCompare</span><span class="o">.</span><span class="n">CompareAny</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6]-,=[#6]&#39;</span>
</pre></div>
</div>
<p>atomCompare引数のオプションは次のようになっています。CompareAnyはいずれの原子も他のいかなる原子にもマッチする、
CompareElementsは元素のタイプによって比較する、CompareIsotopesは同位体ラベルに基づいてマッチする、です。
同位体ラベルはユーザー定義されたアトムタイプの実装にも使うことができます。
CompareAnyのbondCompareはいずれの結合も他のいかなる結合にもマッチし、CompareOrderExactは同じ結合タイプを有する時のみ等価であるとします。
そしてCompareOrderは単結合と芳香族結合が互いにマッチすることは許容しますが、それ以外については正確な結合次数の一致を要求します。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1&#39;</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1CCCC=C1&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span><span class="n">bondCompare</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">BondCompare</span><span class="o">.</span><span class="n">CompareAny</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6]1:,-[#6]:,-[#6]:,-[#6]:,-[#6]:,=[#6]:,-1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span><span class="n">bondCompare</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">BondCompare</span><span class="o">.</span><span class="n">CompareOrderExact</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span><span class="n">bondCompare</span><span class="o">=</span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">BondCompare</span><span class="o">.</span><span class="n">CompareOrder</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6](:,-[#6]:,-[#6]:,-[#6]):,-[#6]:,-[#6]&#39;</span>
</pre></div>
</div>
<p>部分構造は原子と結合の両方を保持します。デフォルトではアルゴリズムは見つかる結合の数を最大化しようとします。
この設定は<code class="docutils literal"><span class="pre">maximizeBonds</span></code>引数をFalseに設定することで変更できます。
２つの小さな環構造は一つの大きな環構造よりも結合の数が少なくなるかもしれませんが、結合の数を最大化しようとする設定では環構造の数を最大化しようとする傾向があります。</p>
<p>価数３の窒素原子を価数５の窒素原子とマッチさせたくない場合があるかもしれません。デフォルトでは<code class="docutils literal"><span class="pre">machValence</span></code>値がFlaseとなっており、
価数の情報を無視します。Trueとすると、atomCompareの設定が、２つの原子が同じ価数を有することも要求する様に変更されます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC1OC1&#39;</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1OC1[N+](=O)[O-]&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span><span class="o">.</span><span class="n">numAtoms</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">matchValences</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">numBonds</span>
<span class="go">3</span>
</pre></div>
</div>
<p>炭素原子からなる直鎖構造が環構造とマッチするのが奇妙に見えるかもしれませんが、<code class="docutils literal"><span class="pre">ringMatchesRingOnly</span></code>がデフォルトではFalseとなっているからです。
Trueに変更すると、環構造の結合は、環構造とだけマッチする様になります。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;C1CCC1CCC&quot;</span><span class="p">),</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;C1CCCCCC1&quot;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6](-[#6]-[#6])-[#6]-[#6]-[#6]-[#6]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">ringMatchesRingOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6](-[#6]-[#6])-[#6]&#39;</span>
</pre></div>
</div>
<p>さらに制限を加えることもでき、（この場合の様に）環構造のうち部分構造の場合は許容されないように設定することもできます。
つまり、ある原子がMCSの一部で、分子全体の環構造の中にあるなら、その原子はMCSの環構造に含まれます。
<code class="docutils literal"><span class="pre">completeRingsOnly</span></code>をTrueとすることで、この必要条件のオン・オフを切り替えることができます。<code class="docutils literal"><span class="pre">ringMatchesRingOnly</span></code>もTrueとして下さい。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;CCC1CC2C1CN2&quot;</span><span class="p">),</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;C1CC2C1CC2&quot;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6]1-[#6]-[#6](-[#6]-1-[#6])-[#6]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">ringMatchesRingOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6](-[#6]-[#6]-[#6]-[#6])-[#6]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">completeRingsOnly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">smartsString</span>
<span class="go">&#39;[#6]1-[#6]-[#6]-[#6]-1&#39;</span>
</pre></div>
</div>
<p>MCSアルゴリズムは最大共通部分構造を網羅的に探索します。
大抵の場合あっという間に終わりますが、数分あるいはもっと時間がかかる場合があります。
<code class="docutils literal"><span class="pre">timeout</span></code>パラメータを使えば、設定した秒数（実時間でCPU時間ではありません）で検索を打ち切り、
時間内で見つかった最も良い一致構造を返します。タイムアウトの時間に達するとMCSResultの<code class="docutils literal"><span class="pre">canceled</span></code>プロパティがFalseではなくTrueとなります。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;Nc1ccccc1&quot;</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s2">&quot;Nc1ccccccccc1&quot;</span><span class="o">*</span><span class="mi">10</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdFMCS</span><span class="o">.</span><span class="n">FindMCS</span><span class="p">(</span><span class="n">mols</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">canceled</span>
<span class="go">True</span>
</pre></div>
</div>
<p>（50秒後のMCSは511の原子を含みました。）</p>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-11"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="id29">
<h2>フィンガープリントの生成と分子の類似性<a class="headerlink" href="#id29" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#fingerprinting-and-molecular-similarity">Fingerprinting and Molecular Similarity</a>]</p>
<p>RDKitには分子の様々なフィンガープリントを生成する機能があらかじめ用意されており、これを使って分子の類似性を計算することができます。</p>
<div class="section" id="back-to-ref-12">
<span id="id30"></span><h3>トポロジカルフィンガープリント<a class="headerlink" href="#back-to-ref-12" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#topological-fingerprints">Topological Fingerprints</a>]</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">DataStructs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.Fingerprints</span> <span class="k">import</span> <span class="n">FingerprintMols</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCOC&#39;</span><span class="p">),</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCO&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;COC&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fps</span> <span class="o">=</span> <span class="p">[</span><span class="n">FingerprintMols</span><span class="o">.</span><span class="n">FingerprintMol</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">FingerprintSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">0.6...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">FingerprintSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.4...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">FingerprintSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.25</span>
</pre></div>
</div>
<p>このフィンガープリントのアルゴリズムはDaylightフィンガープリントの生成で使われているものと類似しています。
分子のトポロジカルパス（たとえば結合）を同定しハッシュを生成します。それを利用してユーザー指定の長さのフィンガープリントにビットを立てます。
全てのパスを同定した後で、フィンガープリントは一般的に、特定のビット密度になるまで畳み込まれます。</p>
<p>フィンガープリント生成器で使われているデフォルトのパラメーターセットは次の様になっています。
- 最小パス長:1結合
- 最大パス長:7結合
- フィンガープリントのサイズ:2048ビット
- ハッシュ毎のビット数:2
- 最小のフィンガープリントのサイズ:64ビット
- オンとなっているビット密度の目標値:0.3</p>
<p>これらのパラメーターは<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.RDKFingerprint">rdkit.Chem.rdmolops.RDKFingerprint()</a>を直接呼び出すことで制御できます
。分散したフィンガープリント（unfolded fingerprint）を返しますが、望みの密度に畳み込むことができます。
Pythonで書かれた<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Fingerprints.FingerprintMols.html#rdkit.Chem.Fingerprints.FingerprintMols.FingerprintMol">rdkit.Chem.Fingerprints.FingerprintMols.FingerprintMol()</a>関数を見ればどうやってこれを行うかがわかります。</p>
<p><a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.DataStructs.html#rdkit.DataStructs.FingerprintSimilarity">rdkit.DataStructs.FingerprintSimilarity()</a>で使われているデフォルトの類似性指標はTanimoto係数です。
他の類似性指標を使うこともできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">FingerprintSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">metric</span><span class="o">=</span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">)</span>
<span class="go">0.75</span>
</pre></div>
</div>
<p>利用可能な類似性指標は、Tanimoto、Dice、Cosine、Sokal、Russel、Kulczynski、McConnaughey、そしてTverskyです。</p>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-12"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="maccs">
<h3>MACCS キー<a class="headerlink" href="#maccs" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#maccs-keys">MACCS Keys</a>]</p>
<p>公開されている166種類のMACCSキーを使ったSMARTSベースの実装もあります。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">MACCSkeys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fps</span> <span class="o">=</span> <span class="p">[</span><span class="n">MACCSkeys</span><span class="o">.</span><span class="n">GenMACCSKeys</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">FingerprintSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">FingerprintSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.538...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">FingerprintSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.214...</span>
</pre></div>
</div>
<p>Q3 2008で、MACCS keyは厳密に評価され他のMACCSの実装と比較されました。公開されたキーを完全に定義した場合は非常にうまく機能しました。</p>
</div>
<div class="section" id="back-to-ref-13">
<span id="id31"></span><h3>アトムペアとトポロジカルトーション<a class="headerlink" href="#back-to-ref-13" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#atom-pairs-and-topological-torsions">Atom Pairs and Topological Torsions</a>]</p>
<p>アトムペア記述子 <a class="footnote-reference" href="#carhart" id="id32">[3]</a> はいくつかの異なる方法で利用可能です。
標準的な形式ではフィンガープリントを0か1で表すのではなく、それぞれのビットの数をカウントしてフィンガープリントに含めます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.AtomPairs</span> <span class="k">import</span> <span class="n">Pairs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C1CCC1OCC&#39;</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(C)OCC&#39;</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCOCC&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pairFps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pairs</span><span class="o">.</span><span class="n">GetAtomPairFingerprint</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">]</span>
</pre></div>
</div>
<p>アトムペアフィンガープリントに含められるビット空間は非常に巨大なので、スパースな形式で保存されます。
各フィンガープリントのビットのリストとそのカウント数を辞書型のデータとして得ることができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">pairFps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetNonzeroElements</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="mi">541732</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="mi">1606690</span><span class="p">]</span>
<span class="go">2</span>
</pre></div>
</div>
<p>ビットの説明も手に入ります：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Pairs</span><span class="o">.</span><span class="n">ExplainPairScore</span><span class="p">(</span><span class="mi">558115</span><span class="p">)</span>
<span class="go">((&#39;C&#39;, 1, 0), 3, (&#39;C&#39;, 2, 0))</span>
</pre></div>
</div>
<p>上記の意味は「隣接原子が１つあり、π電子が0個の炭素（C）で、隣接原子が2つあり、π電子が0個の炭素(C)から、結合３つ分離れている」です。</p>
<p>アトムペアフィンガープリント間の類似性評価に通常用いられる指標はDice類似度評価です。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">DataStructs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">0.333...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.258...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.56</span>
</pre></div>
</div>
<p>（カウント数の情報を無視した）標準的なビットベクトルのフィンガープリントとしてコード化されたアトムペアを得ることもできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">airFps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pairs</span><span class="o">.</span><span class="n">GetAtomPairFingerprintAsBitVect</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">]</span>
</pre></div>
</div>
<p>これらは標準的なビットベクトルなので、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.DataStructs.html#module-rdkit.DataStructs">rdkit.DataStructs</a>モジュールを
使って類似性評価を行うこともできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">DataStructs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">0.48</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.380...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pairFps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="go">0.625</span>
</pre></div>
</div>
<p>トポロジカルトーション記述子 <a class="footnote-reference" href="#nilakantan" id="id33">[4]</a> も基本的には同じ方法で計算されます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.AtomPairs</span> <span class="k">import</span> <span class="n">Torsions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tts</span> <span class="o">=</span> <span class="p">[</span>
<span class="go">.GetTopologicalTorsionFingerprintAsIntVect(x) for x in ms]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">tts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">0.166...</span>
</pre></div>
</div>
<p>このページを書いている段階では、トポロジカルトーションフィンガープリントには多すぎてBitVector機能を使ってコード化できないほどたくさんビットがあるので、
GetTopologicalTorsionFingerprintAsBitVect関数といった関数は存在しません。</p>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-13"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="morgan-circular">
<span id="back-to-ref-14"></span><h3>Morganフィンガープリント(Circularフィンガープリント)<a class="headerlink" href="#morgan-circular" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#morgan-fingerprints-circular-fingerprints">Morgan FIngerprints(Circular Fingerprints)</a>]</p>
<p>circularフィンガープリント <a class="footnote-reference" href="#rogers" id="id34">[5]</a> としてより知られているかもしれませんが、
Morganフィンガープリントと呼ばれる一連のフィンガープリントは、ユーザー定義のアトム不変量のセットに対してMorganアルゴリズムを適用することで生成されます。
Morganフィンガープリントを生成するときには、フィンガープリントの半径を定義しなければなりません：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span>
<span class="go">&lt;rdkit.DataStructs.cDataStructs.UIntSparseIntVect object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ncccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span><span class="n">fp2</span><span class="p">)</span>
<span class="go">0.55...</span>
</pre></div>
</div>
<p>アトムペアやトポロジカルトーションのようにMorganフィンガープリントは、デフォルトではビットのカウント数を使いますが、ビットベクトルとして計算することもできます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">nBits</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span>
<span class="go">&lt;rdkit.DataStructs.cDataStructs.ExplicitBitVect object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">nBits</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span><span class="n">fp2</span><span class="p">)</span>
<span class="go">0.51...</span>
</pre></div>
</div>
<p>デフォルトのアトム不変量は、よく知られたECFPフィンガープリントファミリーで使われているものと類似した、結合関係の情報を使います。
FCFPフィンガープリントで使われているものに類似した、特徴ベースの不変量を使うこともできます。
特徴量の定義は<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#feature-definitions-used-in-the-morgan-fingerprints">Feature Definitions Used in the Morgan Fingerprints</a>セクションに記載されています。
時折、とても異なる類似性スコアを出すことがあります。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccn1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccco1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffp1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">useFeatures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffp2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">useFeatures</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span><span class="n">fp2</span><span class="p">)</span>
<span class="go">0.36...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">ffp1</span><span class="p">,</span><span class="n">ffp2</span><span class="p">)</span>
<span class="go">0.90...</span>
</pre></div>
</div>
<p>RDKitで生成したECFP/FCFPフィンガープリントとMorganフィンガープリントを比較する際には、Morganフィンガープリントのパラメーターが半径であるのに対して、
ECFP4の4は考慮している原子の環境の直径に一致していることを思い出してください。したがって、上記の例では半径=2とすることで、ECFP4とFCFP4とおおよそ等価となります。</p>
<p><a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdMolDescriptors.html#rdkit.Chem.rdMolDescriptors.GetMorganFingerprint">rdkit.Chem.rdMolDescriptors.GetMorganFingerprint()</a>のオプションの不変量の引数を使うことで、
ユーザー自身でアトム不変量を設定することもできます。不変量に定数を使った簡単な例が以下になります。得られたフィンカープリントで分子のトポロジーを比較しています。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ncncn1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">invariants</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp2</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">invariants</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">m2</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span><span class="o">==</span><span class="n">fp2</span>
<span class="go">True</span>
</pre></div>
</div>
<p>デフォルトでは結合次数が考慮されていることに注意してください：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m3</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC1CCCCC1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp3</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">invariants</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span><span class="o">==</span><span class="n">fp3</span>
<span class="go">False</span>
</pre></div>
</div>
<p>この設定を外すこともできます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">invariants</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">m1</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">(),</span>
<span class="gp">... </span><span class="n">useBondTypes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp3</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">invariants</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">m3</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">(),</span>
<span class="gp">... </span><span class="n">useBondTypes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp1</span><span class="o">==</span><span class="n">fp3</span>
<span class="go">True</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-14"><span class="std std-ref">こちら</span></a>へ</p>
<div class="section" id="back-to-ref-15">
<span id="id35"></span><h4>モーガンフィンガープリントのビットの解釈<a class="headerlink" href="#back-to-ref-15" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#explaining-bits-from-morgan-fingerprints">Explaining bits from Morgan Fingerprints</a>]</p>
<p>bitinfo引数を介して、Morganフィンガープリントの特定のビットに寄与する原子についての情報を手に入れることができます。
この辞書型のデータには、フィンガープリントのビットセットごとに一つのエントリーが取り込まれており、
キー（key）はビットID、値（value）は（アトムインデックス、半径）のタプルのリストとなっています。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1cccnc1C&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span><span class="o">=</span><span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">bitInfo</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">GetNonzeroElements</span><span class="p">())</span>
<span class="go">16</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
<span class="go">16</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span><span class="p">[</span><span class="mi">98513984</span><span class="p">]</span>
<span class="go">((1, 1), (2, 1))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span><span class="p">[</span><span class="mi">4048591891</span><span class="p">]</span>
<span class="go">((5, 2),)</span>
</pre></div>
</div>
<p>上記を解釈すると、ビット98513984はatom 1とatom 2に一度ずつ、それぞれ半径１で計２回セットされています。
また、ビット4048591891はatom 5に半径２でセットされています。</p>
<p>ビット4048591891にフォーカスを当ててみましょう。分子全体から、atom 5の半径２の中にある全ての原子からなる部分(擬似分子: submolecule)を抜き出すことができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">FindAtomEnvironmentOfRadiusN</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amap</span><span class="o">=</span><span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">submol</span><span class="o">=</span><span class="n">Chem</span><span class="o">.</span><span class="n">PathToSubmol</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">env</span><span class="p">,</span><span class="n">atomMap</span><span class="o">=</span><span class="n">amap</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">submol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">amap</span>
<span class="go">{0: 3, 1: 5, 3: 4, 4: 0, 5: 1, 6: 2}</span>
</pre></div>
</div>
<p>この擬似分子のSMILESを生成することでビットを“解釈”しましょう：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">submol</span><span class="p">)</span>
<span class="go">&#39;ccc(C)nc&#39;</span>
</pre></div>
</div>
<p>中心の原子にSMILESの基点（根：root）を置くともっと役に立ちます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">submol</span><span class="p">,</span><span class="n">rootedAtAtom</span><span class="o">=</span><span class="n">amap</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">canonical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">&#39;c(nc)(C)cc&#39;</span>
</pre></div>
</div>
<p>上記の代わりとなる別の方法として、<a class="reference external" href="http://rdkit.org/docs/source/rdkit.Chem.rdmolfiles.html?highlight=rdkit%20chem%20molfragmenttosmiles#rdkit.Chem.rdmolfiles.MolFragmentToSmiles">rdkit.Chem.MolFragmentToSmiles()</a>関数をつかうと、
同じことを（特に多数の分子を扱う際に、より高速に）行うことができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">atoms</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">bidx</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">atoms</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="n">bidx</span><span class="p">)</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">())</span>
<span class="gp">... </span>    <span class="n">atoms</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetBondWithIdx</span><span class="p">(</span><span class="n">bidx</span><span class="p">)</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">())</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFragmentToSmiles</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">atomsToUse</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">atoms</span><span class="p">),</span><span class="n">bondsToUse</span><span class="o">=</span><span class="n">env</span><span class="p">,</span><span class="n">rootedAtAtom</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&#39;c(C)(cc)nc&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-15"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="back-to-ref-16">
<span id="id36"></span><h3>フィンガープリントのビットのイメージの生成<a class="headerlink" href="#back-to-ref-16" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#generating-images-of-fingerprint-bits">Generating images of fingerprint bits</a>]</p>
<p>MorganフィンガープリントとRDKitフィンガープリントに対しては、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Draw.html#rdkit.Chem.Draw.DrawMorganBit">rdkit.Chem.Draw.DrawMorganBit()</a>関数と
<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Draw.html#rdkit.Chem.Draw.DrawRDKitBit">rdkit.Chem.Draw.DrawRDKitBit()</a>関数を使うことで
ビットを定義する原子の環境のイメージを生成することができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">Draw</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1CC1CC1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">GetMorganFingerprintAsBitVect</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bitInfo</span><span class="o">=</span><span class="n">bi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bi</span><span class="p">[</span><span class="mi">872</span><span class="p">]</span>
<span class="go">((6, 2),)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mfp2_svg</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">DrawMorganBit</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="mi">872</span><span class="p">,</span> <span class="n">bi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdkbi</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdkfp</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">RDKFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">maxPath</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bitInfo</span><span class="o">=</span><span class="n">rdkbi</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdkbi</span><span class="p">[</span><span class="mi">1553</span><span class="p">]</span>
<span class="go">[[0, 1, 9, 5, 4], [2, 3, 4, 9, 5]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rdk_svg</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">DrawRDKitBit</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="mi">1553</span><span class="p">,</span> <span class="n">rdkbi</span><span class="p">)</span>
</pre></div>
</div>
<p>このようなイメージができます：</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="_images/mfp2_bit872.svg" class="first last" src="_images/mfp2_bit872.svg" /></td>
<td><img alt="_images/rdk_bit1553.svg" class="first last" src="_images/rdk_bit1553.svg" /></td>
</tr>
<tr class="row-even"><td>Morgan bit</td>
<td>RDKit bit</td>
</tr>
</tbody>
</table>
<p>Morganビットのデフォルトのハイライトの色は以下を示します：</p>
<blockquote>
<div><ul class="simple">
<li>blue: 環境の中心となるアトム</li>
<li>yellow: 芳香族のアトム</li>
<li>gray: 脂肪族環構造のアトム</li>
</ul>
</div></blockquote>
<p>RDKitビットのデフォルトのハイライトの色は以下を示します：</p>
<blockquote>
<div><ul class="simple">
<li>yellow: 芳香族のアトム</li>
</ul>
</div></blockquote>
<p>（上記のRDKitフィンガープリントのビット1553の例のように）分子の複数の原子に同じビットがセットされている場合には、
描画機能は一番最初の例を表示することに気をつけてください。どの例を表示するか明示することで変更することができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rdk_svg</span> <span class="o">=</span> <span class="n">Draw</span><span class="o">.</span><span class="n">DrawRDKitBit</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="mi">1553</span><span class="p">,</span> <span class="n">rdkbi</span><span class="p">,</span> <span class="n">whichExample</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>このようなイメージができます：</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="_images/rdk_bit1553_2.svg" class="first last" src="_images/rdk_bit1553_2.svg" /></td>
</tr>
<tr class="row-even"><td>RDKit bit</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="back-to-ref-17">
<span id="id37"></span><h3>フィンガープリントを使って多種多様な分子を選択する<a class="headerlink" href="#back-to-ref-17" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#picking-diverse-molecules-using-fingerprints">Picking Diverse Molecules Using Fingerprints</a>]</p>
<p>多数の分子を含む集合から、多種多様な分子を選択してより小さな部分集合をつくることはよく行われます。RDkitではこの作業のため、<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.SimDivFilters.html#module-rdkit.SimDivFilters">rdkit.SimDivFilters</a>モジュールに多数の方法を用意しています。
最も効率的な方法はMaxMinアルゴリズムを使うことです。 <a class="footnote-reference" href="#ashton" id="id38">[6]</a>
試しにやってみましょう。</p>
<p>まずは分子を１セット読み込んでMorganフィンガープリントを生成します:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.rdMolDescriptors</span> <span class="k">import</span> <span class="n">GetMorganFingerprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">DataStructs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.SimDivFilters.rdSimDivPickers</span> <span class="k">import</span> <span class="n">MaxMinPicker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/actives_5ht3.sdf&#39;</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">ms</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="n">ms</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fps</span> <span class="o">=</span> <span class="p">[</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nfps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span>
</pre></div>
</div>
<p>MaxMinアルゴリズムにはオブジェクト間の距離を計算する関数が必要です。ここではDiceSimilarityを使いましょう。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">distij</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="n">DataStructs</span><span class="o">.</span><span class="n">DiceSimilarity</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fps</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</pre></div>
</div>
<p>それではピッカーを生成し、10個の多様な分子のセットを取りだしましょう:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">picker</span> <span class="o">=</span> <span class="n">MaxMinPicker</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pickIndices</span> <span class="o">=</span> <span class="n">picker</span><span class="o">.</span><span class="n">LazyPick</span><span class="p">(</span><span class="n">distij</span><span class="p">,</span><span class="n">nfps</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">pickIndices</span><span class="p">)</span>
<span class="go">[93, 109, 154, 6, 95, 135, 151, 61, 137, 139]</span>
</pre></div>
</div>
<p>ピッカーはフィンガープリントのインデックスを返すだけ、ということに注意してください。分子そのものを取得するには次のようにします:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">picks</span> <span class="o">=</span> <span class="p">[</span><span class="n">ms</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pickIndices</span><span class="p">]</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-17"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="back-to-ref-18">
<span id="id39"></span><h3>フィンガープリントを使って類似度マップを生成する<a class="headerlink" href="#back-to-ref-18" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#generating-similarity-maps-using-fingerprints">Generating Similarity Maps Using Fingerprints</a>]</p>
<p>類似度マップはある分子と参照とする分子の間の類似度に対して、各原子の寄与を可視化する方法です。参考文献17 <a class="footnote-reference" href="#riniker" id="id40">[17]</a> に方法が記載されています。
<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Draw.SimilarityMaps.html#module-rdkit.Chem.Draw.SimilarityMaps">rdkit.Chem.Draw.SimilarityMaps</a>モジュールを使用してください:</p>
<p>まずは分子を2つ作るところから始めます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;COc1cccc2cc(C(=O)NCCCCN3CCN(c4cccc5nccnc54)CC3)oc21&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">refmol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCCN(CCCCN1CCN(c2ccccc2OC)CC1)Cc1ccc2ccccc2c1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>SimilarityMapsモジュールはatom pairs、topological torsions、Morganフィンガープリントの3種類のフィンガープリントをサポートしています：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">Draw</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.Draw</span> <span class="k">import</span> <span class="n">SimilarityMaps</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAPFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetTTFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="s1">&#39;bv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>atom pairsとtopological torsionsにはデフォルトのノーマル(normal)とハッシュ(hashed)、
そしてビットベクトル(bit vector, bv)の３つのタイプがあります。
Morganフィンガープリントにはデフォルトのビットベクトル(bit vector, bv)と、
カウントベクトル(count vector, count)の２つのタイプがあります。</p>
<p>２つのフィンガープリント間の類似度マップを生成する関数には、フィンガープリントの生成に用いた関数を特定する必要があり、
またオプションとして類似度の指標を指定できます。
デフォルトの指標はDice類似度です。Morganフィンガープリント関数をすべてデフォルト引数で使用した場合、類似度マップは次のように生成できます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span><span class="n">refmol</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">)</span>
</pre></div>
</div>
<p>このような図が生成されます:</p>
<img alt="_images/similarity_map_fp1.png" src="_images/similarity_map_fp1.png" />
<p>Morganフィンガープリントのタイプをデフォルトのビットベクトルからカウント(count)タイプに変更し、半径を2から1へ、
類似度指標をDiceからTanimoto類似度へと変更した場合、以下のようになります：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">DataStructs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span> <span class="n">maxweight</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapForFingerprint</span><span class="p">(</span><span class="n">refmol</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">,</span><span class="n">idx</span><span class="p">:</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">atomId</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fpType</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">),</span> <span class="n">metric</span><span class="o">=</span><span class="n">DataStructs</span><span class="o">.</span><span class="n">TanimotoSimilarity</span><span class="p">)</span>
</pre></div>
</div>
<p>このような図が生成されます:</p>
<img alt="_images/similarity_map_fp2.png" src="_images/similarity_map_fp2.png" />
<p>簡易関数のGetSimilarityMapForFingerprintには原子の重みの正規化が含まれており、重みの絶対値の最大が1となるよう正規化されます。
したがって、この関数はマップを作成するときにみつかった、最大の重みを出力します。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">maxweight</span><span class="p">)</span>
<span class="go">0.05747...</span>
</pre></div>
</div>
<p>正規化の処理を行って欲しくない時は、次のようにしてマップを作ることができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">weights</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetAtomicWeightsForFingerprint</span><span class="p">(</span><span class="n">refmol</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetMorganFingerprint</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">])</span>
<span class="go">[&#39;0.05 &#39;, ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>このような図が生成されます:</p>
<img alt="_images/similarity_map_fp3.png" src="_images/similarity_map_fp3.png" />
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-18"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="back-to-ref-19">
<span id="id41"></span><h2>記述子計算<a class="headerlink" href="#back-to-ref-19" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#descriptor-calculation">Descriptor Calculation</a>]</p>
<p>RDKitには様々な記述子が実装されています。記述子の完全なリストは
<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-descriptors">List of Available Descriptors</a>を参照してください。</p>
<p>記述子のほとんどはPythonから集中型の<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Descriptors.html#module-rdkit.Chem.Descriptors">rdkit.Chem.Descriptors</a>モジュールを介して直接使うことができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">Descriptors</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1C(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Descriptors</span><span class="o">.</span><span class="n">TPSA</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">37.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Descriptors</span><span class="o">.</span><span class="n">MolLogP</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">1.3848</span>
</pre></div>
</div>
<p>部分電荷の扱い方は少し異なります:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1C(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">ComputeGasteigerCharges</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s1">&#39;_GasteigerCharge&#39;</span><span class="p">))</span>
<span class="go">-0.047...</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-19"><span class="std std-ref">こちら</span></a>へ</p>
<div class="section" id="id42">
<h3>記述子の可視化<a class="headerlink" href="#id42" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#visualization-of-descriptors">Visualization of Descriptors</a>]</p>
<p>類似度マップは原子ごとの寄与に分割された記述子の可視化に使うことができます。</p>
<p>Gasteiger部分電荷は（異なるカラースキームを使って）次のように可視化できます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.Draw</span> <span class="k">import</span> <span class="n">SimilarityMaps</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;COc1cccc2cc(C(=O)NCCCCN3CCN(c4cccc5nccnc54)CC3)oc21&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">ComputeGasteigerCharges</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contribs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s1">&#39;_GasteigerCharge&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">())]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">colorMap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">contourLines</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>このような図が生成されます:</p>
<img alt="_images/similarity_map_charges.png" src="_images/similarity_map_charges.png" />
<p>logPへのCrippen寄与を可視化するには次のようにします:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">rdMolDescriptors</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contribs</span> <span class="o">=</span> <span class="n">rdMolDescriptors</span><span class="o">.</span><span class="n">_CalcCrippenContribs</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span> <span class="o">=</span> <span class="n">SimilarityMaps</span><span class="o">.</span><span class="n">GetSimilarityMapFromWeights</span><span class="p">(</span><span class="n">mol</span><span class="p">,[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">contribs</span><span class="p">],</span> <span class="n">colorMap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">contourLines</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>このような図が生成されます:</p>
<img alt="_images/similarity_map_crippen.png" src="_images/similarity_map_crippen.png" />
</div>
</div>
<div class="section" id="back-to-ref-20">
<span id="id43"></span><h2>化学反応<a class="headerlink" href="#back-to-ref-20" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chemical-reactions">Chemical Reactions</a>]</p>
<p>RDKitは分子の集合に対して化学反応を適用することもサポートしています。
化学反応を構築する一つの方法は、Daylight社のReaction SMILES <a class="footnote-reference" href="#rxnsmarts" id="id44">[11]</a> に似たSMARTSベースの記法を使うことです。:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1](=[O:2])-[OD1].[N!H0:3]&gt;&gt;[C:1](=[O:2])[N:3]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span>
<span class="go">&lt;rdkit.Chem.rdChemReactions.ChemicalReaction object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span><span class="o">.</span><span class="n">GetNumProductTemplates</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)O&#39;</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="c1"># ありうる生成物の各セットに対し一つのエントリーとなる</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 各エントリーは各生成物の一つの分子を含む</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;CNC(C)=O&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C(COC(=O)O)C(=O)O&#39;</span><span class="p">),</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;CNC(=O)OCCC(=O)O&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;CNC(=O)CCOC(=O)O</span>
</pre></div>
</div>
<p>MDL rxnファイルから反応を構築することもできます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromRxnFile</span><span class="p">(</span><span class="s1">&#39;data/AmideBond.rxn&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span><span class="o">.</span><span class="n">GetNumReactantTemplates</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span><span class="o">.</span><span class="n">GetNumProductTemplates</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)O&#39;</span><span class="p">),</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;NC&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;CNC(C)=O&#39;</span>
</pre></div>
</div>
<p>もちろんアミド結合の形成よりももっと複雑な反応を行うこともできます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1]=[C:2].[C:3]=[*:4][*:5]=[C:6]&gt;&gt;[C:1]1[C:2][C:3][*:4]=[*:5][C:6]1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OC=C&#39;</span><span class="p">),</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C=CC(N)=C&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;NC1=CCCC(O)C1&#39;</span>
</pre></div>
</div>
<p>この場合、テンプレートへの反応物質のマッピングが1通りではないので、得られるものが複数の生成物を含むセットであることに注意してください:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="go">4</span>
</pre></div>
</div>
<p>カノニカルSMILESとpythonの辞書型を使うことで、それぞれのユニークな生成物を得ることができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">uniqps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
<span class="gp">... </span>  <span class="n">smi</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">... </span>  <span class="n">uniqps</span><span class="p">[</span><span class="n">smi</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">uniqps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;NC1=CCC(O)CC1&#39;, &#39;NC1=CCCC(O)C1&#39;]</span>
</pre></div>
</div>
<p>化学反応を処理するコードから生成される分子はサニタイズされていないことに注意して下さい。あえて不自然な反応例をつかって示します:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromSmarts</span><span class="p">(</span><span class="s1">&#39;[C:1]=[C:2][C:3]=[C:4].[C:5]=[C:6]&gt;&gt;[C:1]1=[C:2][C:3]=[C:4][C:5]=[C:6]1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C=CC=C&#39;</span><span class="p">),</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;C=C&#39;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;C1=CC=CC=C1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p0</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
<span class="go">rdkit.Chem.rdmolops.SanitizeFlags.SANITIZE_NONE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
<span class="go">&#39;c1ccccc1&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-20"><span class="std std-ref">こちら</span></a>へ</p>
<div class="section" id="back-to-ref-21">
<span id="id45"></span><h3>より高度な反応機能<a class="headerlink" href="#back-to-ref-21" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#advanced-reaction-functionality">Advanced Reaction Functionality</a>]</p>
<div class="section" id="id46">
<h4>原子の保護<a class="headerlink" href="#id46" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#protecting-atoms">Protecting Atoms</a>]</p>
<p>ありえない生成物を生み出してしまわないように十分に正確に反応を表現することは、時折難しく、特にrxnファイルを扱っているときにこのような問題が生じます。
RDKitでは原子を“保護する”方法を提供しており、その原子が反応に参加しないようにすることができます。</p>
<p>上のセクションで用いたアミド結合形成の反応を再度用いてデモンストレーションしてみましょう。
アミンのクエリが十分に明確ではなく、少なくとも一つの水素原子の結合した窒素原子はどれでもマッチしてしまいます。
したがって、この反応をすでにアミド結合を有する分子に適用した場合、アミドのNも反応点として扱われてしまいます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rxn</span> <span class="o">=</span> <span class="n">AllChem</span><span class="o">.</span><span class="n">ReactionFromRxnFile</span><span class="p">(</span><span class="s1">&#39;data/AmideBond.rxn&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acid</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)NCCN&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">acid</span><span class="p">,</span><span class="n">base</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;CC(=O)N(CCN)C(C)=O&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;CC(=O)NCCNC(C)=O&#39;</span>
</pre></div>
</div>
<p>最初の生成物がアミドのNで反応が起きたものに相当します。</p>
<p>全てのアミドのNを保護することで、このような事態が生じるのを防ぐことができます。
ここでは、アミドとチオアミドにマッチする部分構造クエリをつかって保護を行い、マッチする原子に<code class="docutils literal"><span class="pre">_protected</span></code>プロパティをセットしましょう:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">amidep</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[N;$(NC=[O,S])]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">amidep</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">base</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="s1">&#39;_protected&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>これで、たった一つだけ生成物を生じるようになります:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">RunReactants</span><span class="p">((</span><span class="n">acid</span><span class="p">,</span><span class="n">base</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="go">&#39;CC(=O)NCCNC(C)=O&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-21"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="recap">
<span id="back-to-ref-22"></span><h3>Recapの実装<a class="headerlink" href="#recap" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#recap-implementation">Recap Implementation</a>]</p>
<p>化学反応機能と関連して、Recapアルゴリズムの実装を取り上げます。 <a class="footnote-reference" href="#lewell" id="id47">[8]</a>
Recapは、実験室でよく使われる反応を模倣した化学変換のセットを使って、分子を一連の合理的なフラグメントに分解します。</p>
<p>RDKitの<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Recap.html#module-rdkit.Chem.Recap">rdkit.Chem.Recap</a>の実装は、適用される変換の階層構造の流れを保存します。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">Recap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1OCCOC(=O)CC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hierarch</span> <span class="o">=</span> <span class="n">Recap</span><span class="o">.</span><span class="n">RecapDecompose</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">hierarch</span><span class="p">)</span>
<span class="go">&lt;class &#39;rdkit.Chem.Recap.RecapHierarchyNode&#39;&gt;</span>
</pre></div>
</div>
<p>階層構造の基点（根：root）は元々の分子です：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">hierarch</span><span class="o">.</span><span class="n">smiles</span>
<span class="go">&#39;CCC(=O)OCCOc1ccccc1&#39;</span>
</pre></div>
</div>
<p>それぞれのノードはSMILESをキーとする辞書型を使って、子ノードの情報を保持します。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">=</span><span class="n">hierarch</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
<span class="go">[&#39;*C(=O)CC&#39;, &#39;*CCOC(=O)CC&#39;, &#39;*CCOc1ccccc1&#39;, &#39;*OCCOc1ccccc1&#39;, &#39;*c1ccccc1&#39;]</span>
</pre></div>
</div>
<p>階層構造の末端のノード（葉ノード）は簡単にアクセスすることができ、これもSMILESをキーとする辞書型となっています。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">=</span><span class="n">hierarch</span><span class="o">.</span><span class="n">GetLeaves</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span>
<span class="go">[&#39;*C(=O)CC&#39;, &#39;*CCO*&#39;, &#39;*CCOc1ccccc1&#39;, &#39;*c1ccccc1&#39;]</span>
</pre></div>
</div>
<p>分子がフラグメント化された場所では、ダミーアトムをつかって印がつけられていることに注意して下さい。</p>
<p>ノード自体には関連づけられた分子が入っています:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">leaf</span> <span class="o">=</span> <span class="n">hierarch</span><span class="o">.</span><span class="n">GetLeaves</span><span class="p">()[</span><span class="n">ks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">leaf</span><span class="o">.</span><span class="n">mol</span><span class="p">)</span>
<span class="go">&#39;*C(=O)CC&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-22"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="brics">
<span id="back-to-ref-23"></span><h3>BRICSの実装<a class="headerlink" href="#brics" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#brics-implementation">BRICS Implemetation</a>]</p>
<p>RDKitはBRICSアルゴリズムの実装も提供しています。<a class="footnote-reference" href="#degen" id="id48">[9]</a> BRICSは合成的に利用可能な結合に沿って分子をフラグメント化するもう一つの方法です:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">BRICS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cdk2mols</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/cdk2.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">cdk2mols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">BRICS</span><span class="o">.</span><span class="n">BRICSDecompose</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span>
<span class="go">[&#39;[14*]c1nc(N)nc2[nH]cnc12&#39;, &#39;[3*]O[3*]&#39;, &#39;[4*]CC(=O)C(C)C&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">cdk2mols</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">BRICS</span><span class="o">.</span><span class="n">BRICSDecompose</span><span class="p">(</span><span class="n">m2</span><span class="p">))</span>
<span class="go">[&#39;[1*]C(=O)NN(C)C&#39;, &#39;[14*]c1[nH]nc2c1C(=O)c1c([16*])cccc1-2&#39;, &#39;[16*]c1ccc([16*])cc1&#39;, &#39;[3*]OC&#39;, &#39;[5*]N[5*]&#39;]</span>
</pre></div>
</div>
<p>RDKitのBRICSの実装では、分子から作られたそれぞれのユニークなフラグメントを返します。また、ダミーアトムに、どのタイプの反応が適用されたかを示すタグがつけられたうえで返されます。</p>
<p>分子の集合に対して全てのフラグメントのリストを生成することがとても簡単にできます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">allfrags</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">cdk2mols</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">pieces</span> <span class="o">=</span> <span class="n">BRICS</span><span class="o">.</span><span class="n">BRICSDecompose</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">... </span>   <span class="n">allfrags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">allfrags</span><span class="p">)</span>
<span class="go">90</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">allfrags</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
<span class="go">[&#39;NS(=O)(=O)c1ccc(N/N=C2\\C(=O)Nc3ccc(Br)cc32)cc1&#39;, &#39;[1*]C(=O)C(C)C&#39;, &#39;[1*]C(=O)NN(C)C&#39;, &#39;[1*]C(=O)NN1CC[NH+](C)CC1&#39;, &#39;[1*]C(C)=O&#39;]</span>
</pre></div>
</div>
<p>BRICSモジュールは、フラグメントの集合にBRICSのルールを適用して新しい分子を生成するオプションも提供しています:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fragms</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">allfrags</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span> <span class="o">=</span> <span class="n">BRICS</span><span class="o">.</span><span class="n">BRICSBuild</span><span class="p">(</span><span class="n">fragms</span><span class="p">)</span>
</pre></div>
</div>
<p>結果はジェネレーターオブジェクトです:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span>
<span class="go">&lt;generator object BRICSBuild at 0x...&gt;</span>
</pre></div>
</div>
<p>リクエストに応じて分子を返します:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prods</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&lt;rdkit.Chem.rdchem.Mol object at 0x...&gt;</span>
</pre></div>
</div>
<p>返された分子はサニタイズされていないので、処理を続ける前に少なくとも原子価を更新した方が良いでしょう：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">prods</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">prod</span><span class="o">.</span><span class="n">UpdatePropertyCache</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">prods</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;COCCO&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">prods</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;O=C1Nc2ccc3ncsc3c2/C1=C/NCCO&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">prods</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;O=C1Nc2ccccc2/C1=C/NCCO&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-23"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="back-to-ref-24">
<span id="id49"></span><h3>他のフラグメント化手法<a class="headerlink" href="#back-to-ref-24" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#other-fragmentation-approaches">Other fragmentation approaches</a>]</p>
<p>上述の方法に加えて、RDKitはユーザーが指定した結合に沿って分子をフラグメント化する非常に柔軟なジェネリック関数を提供しています。</p>
<p>ここでは、簡単なデモンストレーションとして、環構造の中に含まれる原子と含まれない原子との間の結合を全て切断するという場合を試してみましょう。
まずはペアとなる原子の組み合わせをすべて見つけることから始めます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC1CC(O)C1CCC1CC1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bis</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[!R][R]&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bis</span>
<span class="go">((0, 1), (4, 3), (6, 5), (7, 8))</span>
</pre></div>
</div>
<p>次に、原子のペアに一致する結合のインデックスを取得します:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bs</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">GetBondBetweenAtoms</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">bis</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bs</span>
<span class="go">[0, 3, 5, 7]</span>
</pre></div>
</div>
<p>そして、これらの結合のインデックスをフラグメント化関数のインプットとして使います:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nm</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">FragmentOnBonds</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span>
</pre></div>
</div>
<p>アウトプットは、結合が切断された場所を示すダミーアトムを有する分子です:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;*C1CC([4*])C1[6*].[1*]C.[3*]O.[5*]CC[8*].[7*]C1CC1&#39;</span>
</pre></div>
</div>
<p>デフォルトでは、接着点は取り除かれた原子のインデックスとともに、（同位体(isotope)を使って）ラベルされています。
独自の原子のラベルのセットを、符号なし整数のペアという形で設定することもできます。
それぞれのペアの最初の値は、結合の出発点となる原子を置き換えるダミーのためのラベルとして使われ、ペアの２番目の値は、結合の終点となる原子を置き換えるダミーのためのラベルとして使われます。
以下の例を見てみましょう。上述の解析を再度行い、接着点に関して、環構造に含まれない原子の場所は10とラベルをつけ、環構造の中の原子には1とラベルをつけています:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bis</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">GetSubstructMatches</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmarts</span><span class="p">(</span><span class="s1">&#39;[!R][R]&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">bis</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">b</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">GetBondBetweenAtoms</span><span class="p">(</span><span class="n">bi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">... </span>   <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">()</span><span class="o">==</span><span class="n">bi</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<span class="gp">... </span>       <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span>   <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>       <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">... </span>   <span class="n">bs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nm</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">FragmentOnBonds</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">bs</span><span class="p">,</span><span class="n">dummyLabels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;[1*]C.[1*]CC[1*].[1*]O.[10*]C1CC([10*])C1[10*].[10*]C1CC1&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-24"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="id50">
<h2>化学的特徴とファーマコフォア<a class="headerlink" href="#id50" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chemical-features-and-pharmacophores">Chemical Features and Pharmacophores</a>]</p>
<div class="section" id="back-to-ref-25">
<span id="id51"></span><h3>化学的特徴<a class="headerlink" href="#back-to-ref-25" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chemical-features">Chemical Features</a>]</p>
<p>RDKitにおいて化学的特徴（フィーチャー）は、SMARTSに基づくフィーチャー定義言語を使って定義されています（言語の詳細はthe RDKit bookに記載されています）。
分子の化学的特徴を見つけ出すためには、まず初めにフィーチャーファクトリー（feature factory）を作らなければなりません:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">ChemicalFeatures</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">RDConfig</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fdefName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDDataDir</span><span class="p">,</span><span class="s1">&#39;BaseFeatures.fdef&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">factory</span> <span class="o">=</span> <span class="n">ChemicalFeatures</span><span class="o">.</span><span class="n">BuildFeatureFactory</span><span class="p">(</span><span class="n">fdefName</span><span class="p">)</span>
</pre></div>
</div>
<p>次に、作成したファクトリーをつかってフィーチャーを検索します:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCc1ccccc1CN&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feats</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">GetFeaturesForMol</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">feats</span><span class="p">)</span>
<span class="go">8</span>
</pre></div>
</div>
<p>個々のフィーチャーには、それが属するファミリー（たとえばドナーやアクセプターなど）やタイプ（より詳細な説明）、フィーチャーと結びつけられた原子（原子団）についての情報が紐付けられています：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span>
<span class="go">&#39;Donor&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span>
<span class="go">&#39;SingleAtomDonor&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetAtomIds</span><span class="p">()</span>
<span class="go">(0,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feats</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">GetFamily</span><span class="p">()</span>
<span class="go">&#39;Aromatic&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feats</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">GetAtomIds</span><span class="p">()</span>
<span class="go">(2, 3, 4, 5, 6, 7)</span>
</pre></div>
</div>
<p>もし分子に座標の情報が含まれているなら、座標の中でフィーチャーが占める合理的な位置についての情報も紐付けられます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetPos</span><span class="p">()</span>
<span class="go">&lt;rdkit.Geometry.rdGeometry.Point3D object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">feats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetPos</span><span class="p">())</span>
<span class="go">[2.07..., -2.335..., 0.0]</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-25"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="back-to-ref-26">
<span id="id52"></span><h3>2Dファーマコフォアフィンガープリント<a class="headerlink" href="#back-to-ref-26" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#d-pharmacophore-fingerprints">2D Pharmacophore Fingerprints</a>]</p>
<p>複数の化学的特徴と、フィーチャー間の2Dの(幾何学的、トポロジカル)距離とを合わせることで2Dファーマコフォアを作成することができます。
距離がビン分割されると、それぞれのファーマコフォアに一意の整数値のIDを割り当てることができ、フィンガープリントにその情報を格納することができます。
エンコーディングの詳細は<a class="reference external" href="https://www.rdkit.org/docs/RDKit_Book.html">The RDKit book</a>を参照してください。</p>
<p>ファーマコフォアフィンガープリントを生成するには、通常のRDKitのフィーチャータイプ化機能で作成した化学的特徴が必要です:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">ChemicalFeatures</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fdefName</span> <span class="o">=</span> <span class="s1">&#39;data/MinimalFeatures.fdef&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">featFactory</span> <span class="o">=</span> <span class="n">ChemicalFeatures</span><span class="o">.</span><span class="n">BuildFeatureFactory</span><span class="p">(</span><span class="n">fdefName</span><span class="p">)</span>
</pre></div>
</div>
<p>フィンガープリント自体は、ファーマコフォアを生成する際に必要だったすべてのパラメーターを保持しているシグネチャー（フィンガープリント）ファクトリーを使って計算されます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.Pharm2D.SigFactory</span> <span class="k">import</span> <span class="n">SigFactory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span> <span class="o">=</span> <span class="n">SigFactory</span><span class="p">(</span><span class="n">featFactory</span><span class="p">,</span><span class="n">minPointCount</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">maxPointCount</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">SetBins</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">GetSigSize</span><span class="p">()</span>
<span class="go">885</span>
</pre></div>
</div>
<p>これでフィンガープリントを生成するシグネチャーファクトリーの準備が整いました。<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Pharm2D.Generate.html#module-rdkit.Chem.Pharm2D.Generate">rdkit.Chem.Pharm2D.Generate</a>モジュールを使って行います。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.Pharm2D</span> <span class="k">import</span> <span class="n">Generate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCC(=O)CCCN&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">Generate</span><span class="o">.</span><span class="n">Gen2DFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="n">sigFactory</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span>
<span class="go">&lt;rdkit.DataStructs.cDataStructs.SparseBitVect object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="go">885</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span><span class="o">.</span><span class="n">GetNumOnBits</span><span class="p">()</span>
<span class="go">57</span>
</pre></div>
</div>
<p>含まれるフィーチャーやビン分割されたフィーチャー間の距離行列といった情報も含めて、ビット自体の詳細についてはシグネチャーファクトリーから得ることができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">GetOnBits</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
<span class="go">[1, 2, 6, 7, 8]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;Acceptor Acceptor |0 1|1 0|&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&#39;Acceptor Acceptor |0 2|2 0|&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="go">&#39;Acceptor Donor |0 2|2 0|&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">GetOnBits</span><span class="p">())[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
<span class="go">[704, 706, 707, 708, 714]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="mi">707</span><span class="p">)</span>
<span class="go">&#39;Donor Donor PosIonizable |0 1 2|1 0 1|2 1 0|&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="mi">714</span><span class="p">)</span>
<span class="go">&#39;Donor Donor PosIonizable |0 2 2|2 0 0|2 0 0|&#39;</span>
</pre></div>
</div>
<p>作業を簡便にするため（毎回FDefファイルを編集する必要をなくすため）に、SigFactoryの特定のフィーチャータイプを無効化することもできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">skipFeats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PosIonizable&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigFactory</span><span class="o">.</span><span class="n">GetSigSize</span><span class="p">()</span>
<span class="go">510</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp2</span> <span class="o">=</span> <span class="n">Generate</span><span class="o">.</span><span class="n">Gen2DFingerprint</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="n">sigFactory</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp2</span><span class="o">.</span><span class="n">GetNumOnBits</span><span class="p">()</span>
<span class="go">36</span>
</pre></div>
</div>
<p>RDKitで使用可能な、2Dファーマコフォアフィンガープリントのためのフィーチャー定義のセットにはもう一つあり、GobbiとPoppingerによって提案されたものです 。<a class="footnote-reference" href="#gobbi" id="id53">[10]</a>
<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.Pharm2D.Gobbi_Pharm2D.html#module-rdkit.Chem.Pharm2D.Gobbi_Pharm2D">rdkit.Chem.Pharm2D.Gobbi_Pharm2D</a>モジュールにこれらのフィンガープリントタイプのために予め設定されたシグネチャーファクトリーがあります。使い方の例をお示しします:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem.Pharm2D</span> <span class="k">import</span> <span class="n">Gobbi_Pharm2D</span><span class="p">,</span><span class="n">Generate</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCC=CC(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">Generate</span><span class="o">.</span><span class="n">Gen2DFingerprint</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">Gobbi_Pharm2D</span><span class="o">.</span><span class="n">factory</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span>
<span class="go">&lt;rdkit.DataStructs.cDataStructs.SparseBitVect object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span><span class="o">.</span><span class="n">GetNumOnBits</span><span class="p">()</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">GetOnBits</span><span class="p">())</span>
<span class="go">[23, 30, 150, 154, 157, 185, 28878, 30184]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Gobbi_Pharm2D</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="mi">157</span><span class="p">)</span>
<span class="go">&#39;HA HD |0 3|3 0|&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Gobbi_Pharm2D</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">GetBitDescription</span><span class="p">(</span><span class="mi">30184</span><span class="p">)</span>
<span class="go">&#39;HA HD HD |0 3 0|3 0 3|0 3 0|&#39;</span>
</pre></div>
</div>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-26"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="back-to-ref-27">
<span id="id54"></span><h2>分子フラグメント<a class="headerlink" href="#back-to-ref-27" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#molecular-fragments">Molecular Fragments</a>]</p>
<p>RDKitには分子のフラグメント化を行うツールと、生成したフラグメントを扱うためのツールが揃っています。
フラグメントは互いに結合した原子団から成るものと定義されていて、原子団が付随する官能基を持つ場合もあります。説明するよりもやってみせたほうがわかりやすいでしょう：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fName</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RDConfig</span><span class="o">.</span><span class="n">RDDataDir</span><span class="p">,</span><span class="s1">&#39;FunctionalGroups.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">FragmentCatalog</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fparams</span> <span class="o">=</span> <span class="n">FragmentCatalog</span><span class="o">.</span><span class="n">FragCatParams</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">fName</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fparams</span><span class="o">.</span><span class="n">GetNumFuncGroups</span><span class="p">()</span>
<span class="go">39</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">=</span><span class="n">FragmentCatalog</span><span class="o">.</span><span class="n">FragCatalog</span><span class="p">(</span><span class="n">fparams</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcgen</span><span class="o">=</span><span class="n">FragmentCatalog</span><span class="o">.</span><span class="n">FragCatGenerator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCC=CC(=O)O&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcgen</span><span class="o">.</span><span class="n">AddFragsFromMol</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">fcat</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&#39;C&lt;-O&gt;C&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;C=C&lt;-C(=O)O&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">&#39;C&lt;-C(=O)O&gt;=CC&lt;-O&gt;&#39;</span>
</pre></div>
</div>
<p>フラグメントは<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdfragcatalog.html#rdkit.Chem.rdfragcatalog.FragCatalog">rdkit.Chem.rdfragcatalog.FragCatalog</a>にエントリーとして格納されています。
エントリーの記述が山括弧で囲まれた部分（例えば’&lt;‘と’&gt;’の間）を含むことに注意してください。
この部分はフラグメントに結合する官能基を表します。
例えば、上記の例の場合、カタログエントリー０はアルコールが一方の炭素に結合したエチル基のフラグメントに相当し、エントリー１はカルボン酸が一方の炭素に結合したエチレンに相当します。
官能基についての詳細な情報は、官能基のIDをフラグメントに問い合わせ、
そのIDを<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdfragcatalog.html#rdkit.Chem.rdfragcatalog.FragCatParams">rdkit.Chem.rdfragcatalog.FragCatParams</a>オブジェクトの中から探し出すことで得られます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryFuncGroupIds</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="go">[34, 1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fparams</span><span class="o">.</span><span class="n">GetFuncGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;rdkit.Chem.rdchem.Mol object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmarts</span><span class="p">(</span><span class="n">fparams</span><span class="o">.</span><span class="n">GetFuncGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="go">&#39;*-C(=O)[O&amp;D1]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmarts</span><span class="p">(</span><span class="n">fparams</span><span class="o">.</span><span class="n">GetFuncGroup</span><span class="p">(</span><span class="mi">34</span><span class="p">))</span>
<span class="go">&#39;*-[O&amp;D1]&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fparams</span><span class="o">.</span><span class="n">GetFuncGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s1">&#39;_Name&#39;</span><span class="p">)</span>
<span class="go">&#39;-C(=O)O&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fparams</span><span class="o">.</span><span class="n">GetFuncGroup</span><span class="p">(</span><span class="mi">34</span><span class="p">)</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s1">&#39;_Name&#39;</span><span class="p">)</span>
<span class="go">&#39;-O&#39;</span>
</pre></div>
</div>
<p>カタログは階層構造になっており、小さなフラグメントが合わさってより大きなフラグメントを構成します。
<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdfragcatalog.html#rdkit.Chem.rdfragcatalog.FragCatalog.GetEntryDownIds">rdkit.Chem.rdfragcatalog.FragCatalog.GetEntryDownIds()</a>メソッドを使って、小さなフラグメントから、そのフラグメントが寄与するより大きなフラグメントを見つけることができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">=</span><span class="n">FragmentCatalog</span><span class="o">.</span><span class="n">FragCatalog</span><span class="p">(</span><span class="n">fparams</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;OCC(NC1CC1)CCC&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcgen</span><span class="o">.</span><span class="n">AddFragsFromMol</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">fcat</span><span class="p">)</span>
<span class="go">15</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&#39;C&lt;-O&gt;C&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&#39;CN&lt;-cPropyl&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDownIds</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="go">[3, 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">&#39;C&lt;-O&gt;CC&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="go">&#39;C&lt;-O&gt;CN&lt;-cPropyl&gt;&#39;</span>
</pre></div>
</div>
<p>多数の分子からつくったフラグメントをカタログに加えることもできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">suppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SmilesMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/bzr.smi&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suppl</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">=</span><span class="n">FragmentCatalog</span><span class="o">.</span><span class="n">FragCatalog</span><span class="p">(</span><span class="n">fparams</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">:</span> <span class="n">nAdded</span><span class="o">=</span><span class="n">fcgen</span><span class="o">.</span><span class="n">AddFragsFromMol</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">fcat</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetNumEntries</span><span class="p">()</span>
<span class="go">1169</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&#39;Cc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="go">&#39;cc-nc(C)n</span>
</pre></div>
</div>
<p>カタログ内のフラグメントは一意に定められたユニークなもので、分子をもう一度追加しても新しいエントリーは増えません:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fcgen</span><span class="o">.</span><span class="n">AddFragsFromMol</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fcat</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetNumEntries</span><span class="p">()</span>
<span class="go">1169</span>
</pre></div>
</div>
<p>一旦<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdfragcatalog.html#rdkit.Chem.rdfragcatalog.FragCatalog">rdkit.Chem.rdfragcatalog.FragCatalog</a>を生成すれば、それを用いて分子のフィンガープリント化を行うこともできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fpgen</span> <span class="o">=</span> <span class="n">FragmentCatalog</span><span class="o">.</span><span class="n">FragFPGenerator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span> <span class="o">=</span> <span class="n">fpgen</span><span class="o">.</span><span class="n">GetFPForMol</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">fcat</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span>
<span class="go">&lt;rdkit.DataStructs.cDataStructs.ExplicitBitVect object at 0x...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fp</span><span class="o">.</span><span class="n">GetNumOnBits</span><span class="p">()</span>
<span class="go">189</span>
</pre></div>
</div>
<p>これで、フィンガープリントに関連づけられた残りの機能をフラグメントフィンガープリントに適用することができるようになりました。
例えば、二つの分子について、それぞれのフィンガープリントの積集合をとることで、共通して存在するフラグメントを簡単に見つけることができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fp2</span> <span class="o">=</span> <span class="n">fpgen</span><span class="o">.</span><span class="n">GetFPForMol</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">fcat</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">andfp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">&amp;</span><span class="n">fp2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">andfp</span><span class="o">.</span><span class="n">GetOnBits</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="n">obl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="go">&#39;ccc(cc)NC&lt;=O&gt;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="n">obl</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
<span class="go">&#39;c&lt;-X&gt;ccc(N)cc&#39;</span>
</pre></div>
</div>
<p>また、ある分子を別の分子と区別するフラグメントを見つけることもできます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">combinedFp</span><span class="o">=</span><span class="n">fp</span><span class="o">&amp;</span><span class="p">(</span><span class="n">fp</span><span class="o">^</span><span class="n">fp2</span><span class="p">)</span> <span class="c1"># fp&amp;(!fp2)をつかうよりももっと効率的な可能性があります。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinedFp</span><span class="o">.</span><span class="n">GetOnBits</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fcat</span><span class="o">.</span><span class="n">GetEntryDescription</span><span class="p">(</span><span class="n">obl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="go">&#39;cccc(N)cc&#39;</span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.ML.InfoTheory.rdInfoTheory.html#rdkit.ML.InfoTheory.rdInfoTheory.InfoBitRanker">rdkit.ML.InfoTheory.rdInfoTheory.InfoBitRanker</a>クラスのビットランキング機能を使って活性化合物を不活性化合物と区別するフラグメントを見つけ出すこともできます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">suppl</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="s1">&#39;data/bzr.sdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sdms</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suppl</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fps</span> <span class="o">=</span> <span class="p">[</span><span class="n">fpgen</span><span class="o">.</span><span class="n">GetFPForMol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">fcat</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sdms</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.ML.InfoTheory</span> <span class="k">import</span> <span class="n">InfoBitRanker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ranker</span> <span class="o">=</span> <span class="n">InfoBitRanker</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fps</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">acts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s1">&#39;ACTIVITY&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sdms</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">fp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fps</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">act</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">acts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">... </span>  <span class="n">ranker</span><span class="o">.</span><span class="n">AccumulateVotes</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="n">act</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top5</span> <span class="o">=</span> <span class="n">ranker</span><span class="o">.</span><span class="n">GetTopN</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="nb">id</span><span class="p">,</span><span class="n">gain</span><span class="p">,</span><span class="n">n0</span><span class="p">,</span><span class="n">n1</span> <span class="ow">in</span> <span class="n">top5</span><span class="p">:</span>
<span class="gp">... </span>  <span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">gain</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">n0</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">n1</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">702 0.081 20 17</span>
<span class="go">328 0.073 23 25</span>
<span class="go">341 0.073 30 43</span>
<span class="go">173 0.073 30 43</span>
<span class="go">1034 0.069 5 53</span>
</pre></div>
</div>
<p>上記の例で、各列はbitId、infoGain、nInactive、nActiveを表します。上記モデルケースではこの手法がさほどうまくいっていないことに注意してください。</p>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-27"><span class="std std-ref">こちら</span></a>へ</p>
</div>
<div class="section" id="id55">
<h2>化学以外の機能<a class="headerlink" href="#id55" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#non-chemical-functionality">Non-Chemical Functionality</a>]</p>
<div class="section" id="id56">
<h3>ビットベクトル<a class="headerlink" href="#id56" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#bit-vectors">Bit vetors</a>]</p>
<p>ビットベクトルは多数のバイナリ値（例えばフィンガープリントを表すバイナリ値）を効率的に格納するための入れ物です。
RDKitには２つのタイプのフィンガープリントがあり、値を内部に格納する方法に違いがあります。２つのタイプは簡単に互いに変換することができますが、それぞれ最適な使用目的は異なっています:</p>
<ul class="simple">
<li>SparseBitVectsはベクトルに含まれるビットセットのリストだけを保存します。ファーマコフォアフィンガープリントのように非常に大きく、低密度のベクトルを保存するのにとても適しています。立っているビットのリストを取得するといった操作は非常に速いです。一方でベクトルの符号を反転するといった操作はとても、とても遅いです。</li>
<li>ExplicitBitVectsは立っているビットも立っていないビットも両方の情報を記録します。一般にSparseBitVectsよりも速いですが、保存するのに必要なメモリーが大きくなります。</li>
</ul>
</div>
<div class="section" id="discrete-value-vectors">
<h3>Discrete value vectors<a class="headerlink" href="#discrete-value-vectors" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#discrete-value-vectors">Discrete value vectors</a>]</p>
</div>
<div class="section" id="d-grids">
<h3>3D grids<a class="headerlink" href="#d-grids" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#d-grids">3D grids</a>]</p>
</div>
<div class="section" id="points">
<h3>Points<a class="headerlink" href="#points" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#points">Points</a>]</p>
</div>
</div>
<div class="section" id="id57">
<h2>ヘルプの使い方<a class="headerlink" href="#id57" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#getting-help">Getting Help</a>]</p>
<p>RDKitのdocistringにはたくさんのドキュメントが含まれており、利用することができます。Pythonのヘルプコマンドを使って参照することができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;Cc1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">)</span>
<span class="go">Help on method GetNumAtoms:</span>

<span class="go">GetNumAtoms(...) method of rdkit.Chem.rdchem.Mol instance</span>
<span class="go">    GetNumAtoms( (Mol)arg1 [, (int)onlyHeavy=-1 [, (bool)onlyExplicit=True]]) -&gt; int :</span>
<span class="go">        Returns the number of atoms in the molecule.</span>

<span class="go">          ARGUMENTS:</span>
<span class="go">            - onlyExplicit: (optional) include only explicit atoms (atoms in the molecular graph)</span>
<span class="go">                            defaults to 1.</span>
<span class="go">          NOTE: the onlyHeavy argument is deprecated</span>


<span class="go">        C++ signature :</span>
<span class="go">            int GetNumAtoms(RDKit::ROMol [,int=-1 [,bool=True]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">(</span><span class="n">onlyExplicit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">15</span>
</pre></div>
</div>
<p>コマンドの補完やツールチップを使うことができる環境で作業する場合、利用可能なメソッドをとても簡単に確認することができます。
Jupyter notebookをつかった使用例のスクリーンショットはこのようになります:</p>
<img alt="_images/picture_6.png" src="_images/picture_6.png" />
</div>
<div class="section" id="id58">
<h2>発展的なトピック/警告<a class="headerlink" href="#id58" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#advanced-topics-warnings">Advanced Topics/Warnings</a>]</p>
<div class="section" id="back-to-ref-28">
<span id="id59"></span><h3>分子の編集<a class="headerlink" href="#back-to-ref-28" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#editing-molecules">Editing Molecules</a>]</p>
<p>RDKitで提供されているいくつかの機能では、“その場で”分子を編集することができます。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">SetAtomicNum</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">rdkit.Chem.rdmolops.SanitizeFlags.SANITIZE_NONE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">&#39;c1ccncc1&#39;</span>
</pre></div>
</div>
<p>サニタイゼーションを行うのを忘れないようにしてください。忘れると、（深く考えない限り）一見うまくいったかのような結果を返しますが、</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;c1ccccc1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">SetAtomicNum</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="go">&#39;c1ccocc1&#39;</span>
</pre></div>
</div>
<p>この結果はもちろん完全にナンセンスで、サニタイゼーションをしようとすれば分かります:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/usr/lib/python2.6/doctest.py&quot;</span>, line <span class="m">1253</span>, in <span class="n">__run</span>
    <span class="n">compileflags</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">globs</span>
  File <span class="nb">&quot;&lt;doctest default[0]&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
    <span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gr">ValueError</span>: <span class="n">Sanitization error: Can&#39;t kekulize mol</span>
</pre></div>
</div>
<p>より複雑な変換は<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdchem.html#rdkit.Chem.rdchem.RWMol">rdkit.Chem.rdchem.RWMol</a>クラスを使うことで実行できます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CC(=O)C=CC=C&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">RWMol</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">ReplaceAtom</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">Chem</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">AddAtom</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">AddAtom</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">AddBond</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="n">Chem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">)</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">AddBond</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="n">Chem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>
<span class="go">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">AddBond</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">Chem</span><span class="o">.</span><span class="n">BondType</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">)</span>
<span class="go">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">RemoveAtom</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mw</span><span class="o">.</span><span class="n">GetNumAtoms</span><span class="p">()</span>
<span class="go">8</span>
</pre></div>
</div>
<p>RWMolはROMolと同じように使うことができます:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">mw</span><span class="p">)</span>
<span class="go">&#39;O=CC1=NC=CC=C1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">SanitizeMol</span><span class="p">(</span><span class="n">mw</span><span class="p">)</span>
<span class="go">rdkit.Chem.rdmolops.SanitizeFlags.SANITIZE_NONE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">mw</span><span class="p">)</span>
<span class="go">&#39;O=Cc1ccccn1&#39;</span>
</pre></div>
</div>
<p>標準的な分子を扱うよりも、RWMolを使った方がナンセンスな結果を出しやすいです。化学的に妥当な結果が必要ならば、必ず結果にサニタイゼーションを行うようにしてください。</p>
<p>訳注) 上記セクションの構造式が気になったら<a class="reference internal" href="Supplementary_Text_JP.html#jp-notes-28"><span class="std std-ref">こちら</span></a>へ</p>
</div>
</div>
<div class="section" id="id60">
<h2>雑多なテクニックとヒント<a class="headerlink" href="#id60" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#miscellaneous-tips-and-hints">Miscellaneous Tips and Hints</a>]</p>
<div class="section" id="chemallchem">
<h3>ChemかAllChemか<a class="headerlink" href="#chemallchem" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#chem-vs-allchem">Chem vs AllChem</a>]</p>
<p>“基本的な”化学に関する機能の大部分(例:
分子の読み込み・書き出し、部分構造検索、分子を綺麗に整える、など)は<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.html#module-rdkit.Chem">rdkit.Chem</a>モジュールに入っています。
より発展的で、使用頻度が低い機能は<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.AllChem.html#module-rdkit.Chem.AllChem">rdkit.Chem.AllChem</a>に入っています。
両者の違いは、操作を開始するまでのスピードを速くするか、それともインポートの回数を少なくするかにあります。
2、3の分子を読み込んだり、書き出したりすることに興味があるだけなら、2Dの分子を3Dにするライブラリーや力場の実装を読み込むのは無駄です。
もしChem/AllChemの選択が煩わしいなら、pythonの“import… as …”構文を使ってストレスをなくすことができます：</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="k">import</span> <span class="n">AllChem</span> <span class="k">as</span> <span class="n">Chem</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">&#39;CCC&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="sssr">
<h3>SSSR問題<a class="headerlink" href="#sssr" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#the-sssr-problem">The SSSR Problem</a>]</p>
<p>他の人たちが、私が意図していたよりも大きなエネルギーと雄弁さでわめき出したように、
分子の「最小の環構造の最小のセット(smallest set of smallest rings:SSSR)」の定義は一つではありません。
対称性の高い分子では“本当の”SSSRで得られる結果は魅力的ではありません。
例えばキュバンのSSSRは環構造を5つとしますが、“明らかに”6つあります。
この問題は、対称的な結果を返す、「最小の環構造の（<em>最小</em> ではなく）*小さい* セット」のアルゴリズムを実装することで修正することができます。これがRDKitで用いている手法です。</p>
<p>分子に含まれるSSSR環構造の数を数えることができると役に立つこともあるので、
<a class="reference external" href="https://www.rdkit.org/docs/source/rdkit.Chem.rdmolops.html#rdkit.Chem.rdmolops.GetSSSR">rdkit.Chem.rdmolops.GetSSSR()</a>関数が提供されていますが、
これはSSSRの数を返すだけで、潜在的に一意ではない環構造のセットを返すわけではありません。</p>
</div>
</div>
<div class="section" id="id61">
<h2>利用可能な記述子のリスト<a class="headerlink" href="#id61" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-descriptors">List of Available Descriptors</a>]</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="53%" />
<col width="6%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">記述子/記述子のファミリー</th>
<th class="head">注釈</th>
<th class="head">言語</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Gasteiger/Marsili Partial Charges</td>
<td><em>Tetrahedron</em> <strong>36</strong>:3219-28 (1980)</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>BalabanJ</td>
<td><em>Chem. Phys. Lett.</em> <strong>89</strong>:399-404 (1982)</td>
<td>Python</td>
</tr>
<tr class="row-even"><td>BertzCT</td>
<td><em>J. Am. Chem. Soc.</em> <strong>103</strong>:3599-601 (1981)</td>
<td>Python</td>
</tr>
<tr class="row-odd"><td>Ipc</td>
<td><em>J. Chem. Phys.</em> <strong>67</strong>:4517-33 (1977)</td>
<td>Python</td>
</tr>
<tr class="row-even"><td>HallKierAlpha</td>
<td><em>Rev. Comput. Chem.</em> <strong>2</strong>:367-422 (1991)</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Kappa1 - Kappa3</td>
<td><em>Rev. Comput. Chem.</em> <strong>2</strong>:367-422 (1991)</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Chi0, Chi1</td>
<td><em>Rev. Comput. Chem.</em> <strong>2</strong>:367-422 (1991)</td>
<td>Python</td>
</tr>
<tr class="row-odd"><td>Chi0n - Chi4n</td>
<td><em>Rev. Comput. Chem.</em> <strong>2</strong>:367-422 (1991)</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Chi0v - Chi4v</td>
<td><em>Rev. Comput. Chem.</em> <strong>2</strong>:367-422 (1991)</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>MolLogP</td>
<td>Wildman and Crippen <em>JCICS</em> <strong>39</strong>:868-73 (1999)</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>MolMR</td>
<td>Wildman and Crippen <em>JCICS</em> <strong>39</strong>:868-73 (1999)</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>MolWt</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>ExactMolWt</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>HeavyAtomCount</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>HeavyAtomMolWt</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>NHOHCount</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>NOCount</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>NumHAcceptors</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>NumHDonors</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>NumHeteroatoms</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>NumRotatableBonds</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>NumValenceElectrons</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>NumAmideBonds</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Num{Aromatic,Saturated,Aliphatic}Rings</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Num{Aromatic,Saturated,Aliphatic}{Hetero,Carbo}cycles</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>RingCount</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>FractionCSP3</td>
<td>&#160;</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>NumSpiroAtoms</td>
<td><div class="first last line-block">
<div class="line">スピロ原子の数</div>
<div class="line">(正確に一つの原子を共有する環構造の間で共有されている原子)</div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>NumBridgeheadAtoms</td>
<td><div class="first last line-block">
<div class="line">橋頭位原子の数</div>
<div class="line">（少なくとも二つの結合を共有する環構造の間で共有されている原子）</div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>TPSA</td>
<td><div class="first last line-block">
<div class="line"><em>J Med. Chem.</em> <strong>43</strong>:3714-7, (2000)</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line">原文献との違いはthe RDKi bookのセクションを参照</div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>LabuteASA</td>
<td><em>J. Mol. Graph. Mod.</em> <strong>18</strong>:464-77 (2000)</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>PEOE_VSA1 - PEOE_VSA14</td>
<td><div class="first last line-block">
<div class="line">部分電荷と表面積の寄与を使ったMOEタイプの記述子</div>
<div class="line"><a class="reference external" href="http://www.chemcomp.com/journal/vsadesc.htm">http://www.chemcomp.com/journal/vsadesc.htm</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>SMR_VSA1 - SMR_VSA10</td>
<td><div class="first last line-block">
<div class="line">MRの寄与と表面積の寄与を使ったMOEタイプの記述子</div>
<div class="line"><a class="reference external" href="http://www.chemcomp.com/journal/vsadesc.htm">http://www.chemcomp.com/journal/vsadesc.htm</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>SlogP_VSA1 - SlogP_VSA12</td>
<td><div class="first last line-block">
<div class="line">LogPの寄与と表面積の寄与を使ったMOEタイプの記述子</div>
<div class="line"><a class="reference external" href="http://www.chemcomp.com/journal/vsadesc.htm">http://www.chemcomp.com/journal/vsadesc.htm</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>EState_VSA1 - EState_VSA11</td>
<td><div class="first last line-block">
<div class="line">EStateインデックスと表面積の寄与を使ったMOEタイプの記述子</div>
<div class="line">(RDで開発され、CCGペーパーには記述されていない)</div>
</div>
</td>
<td>Python</td>
</tr>
<tr class="row-odd"><td>VSA_EState1 - VSA_EState10</td>
<td><div class="first last line-block">
<div class="line">EStateインデックスと表面積の寄与を使ったMOEタイプの記述子</div>
<div class="line">(RDで開発され、CCGペーパーには記述されていない)</div>
</div>
</td>
<td>Python</td>
</tr>
<tr class="row-even"><td>MQNs</td>
<td>Nguyen et al. <em>ChemMedChem</em> <strong>4</strong>:1803-5 (2009)</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Topliss fragments</td>
<td><div class="first last line-block">
<div class="line">$(RDBASE)/Data/FragmentDescriptors.csv の</div>
<div class="line">SMARTS定義のセットを使った実装</div>
</div>
</td>
<td>Python</td>
</tr>
<tr class="row-even"><td>Autocorr2D</td>
<td><div class="first last line-block">
<div class="line">2017.09リリースで新しく導入</div>
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry” Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
</div>
</td>
<td>C++</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id62">
<h2>利用可能な3D記述子のリスト<a class="headerlink" href="#id62" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-3d-descriptors">List of Available 3D Descriptors</a>]</p>
<p>これらは全て分子が３次元のコンフォマーをもつことを必要とします。</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="76%" />
<col width="4%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">記述子/記述子のファミリー</th>
<th class="head">注釈</th>
<th class="head">言語</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Plane of best fit</div>
<div class="line">(PBF)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Nicholas C. Firth, Nathan Brown, and Julian Blagg,</div>
<div class="line"><em>JCIM</em> <strong>52</strong>:2516-25</div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>PMI1, PMI2, PMI3</td>
<td>主慣性モーメント</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>NPR1, NPR2</td>
<td><div class="first last line-block">
<div class="line">標準化された主モーメントの比</div>
<div class="line">Sauer and Schwarz <em>JCIM</em> <strong>43</strong>:987-1003 (2003)</div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Radius of gyration</td>
<td><div class="first last line-block">
<div class="line">G. A. Arteca “Molecular Shape Descriptors”</div>
<div class="line">Reviews in Computational Chemistry vol 9</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9780470125861.ch5">http://dx.doi.org/10.1002/9780470125861.ch5</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Inertial shape factor</td>
<td><div class="first last line-block">
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry” Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Eccentricity</td>
<td><div class="first last line-block">
<div class="line">G. A. Arteca “Molecular Shape Descriptors”</div>
<div class="line">Reviews in Computational Chemistry vol 9</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9780470125861.ch5">http://dx.doi.org/10.1002/9780470125861.ch5</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Asphericity</td>
<td><div class="first last line-block">
<div class="line">A. Baumgaertner, “Shapes of flexible vesicles”</div>
<div class="line"><em>J. Chem. Phys.</em> <strong>98</strong>:7496 (1993)</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1063/1.464689">http://dx.doi.org/10.1063/1.464689</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Spherocity Index</td>
<td><div class="first last line-block">
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry”</div>
<div class="line">Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Autocorr3D</td>
<td><div class="first last line-block">
<div class="line">2017.09リリースで新しく導入。</div>
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry” Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>RDF</td>
<td><div class="first last line-block">
<div class="line">2017.09リリースで新しく導入。</div>
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry” Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>MORSE</td>
<td><div class="first last line-block">
<div class="line">2017.09リリースで新しく導入。</div>
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry” Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>WHIM</td>
<td><div class="first last line-block">
<div class="line">2017.09リリースで新しく導入。</div>
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry” Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
<div class="line"><br /></div>
<div class="line"><strong>注意</strong> DRAGONを使って求めたこれらの記述子の値を正確に再現するには十分な情報が手にはいりません。　</div>
<div class="line">我々はこれが近い実装と信じています。</div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>GETAWAY</td>
<td><div class="first last line-block">
<div class="line">2017.09リリースで新しく導入。</div>
<div class="line">Todeschini and Consoni</div>
<div class="line">“Descriptors from Molecular Geometry” Handbook of Chemoinformatics</div>
<div class="line"><a class="reference external" href="http://dx.doi.org/10.1002/9783527618279.ch37">http://dx.doi.org/10.1002/9783527618279.ch37</a></div>
<div class="line"><br /></div>
<div class="line"><strong>注意</strong> DRAGONを使って求めたこれらの記述子の値を正確に再現するには十分な情報が手にはいりません。</div>
<div class="line">我々はこれが近い実装と信じています。</div>
</div>
</td>
<td>C++</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id63">
<h2>利用可能なフィンガープリントのリスト<a class="headerlink" href="#id63" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#list-of-available-fingerprints">List of Available Fingerprints</a>]</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="72%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">フィンガープリントのタイプ</th>
<th class="head">注釈</th>
<th class="head">言語</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>RDKit</td>
<td>分子サブグラフのハッシュ化に基づくDaylight類似のフィンガープリント</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Atom Pairs</td>
<td><em>JCICS</em> <strong>25</strong>:64-73 (1985)</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Topological Torsions</td>
<td><em>JCICS</em> <strong>27</strong>:82-5 (1987)</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>MACCS keys</td>
<td>166の公開キーを使いSMARTSで実装</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Morgan/Circular</td>
<td><div class="first last line-block">
<div class="line">ECFP/FCFPフィンガープリントに類似した、</div>
<div class="line">Morganアルゴリズムに基づくフィンガープリント</div>
<div class="line"><em>JCIM</em> <strong>50</strong>:742-54 (2010).</div>
</div>
</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>2D Pharmacophore</td>
<td>ファーマコフォアポイント間のトポロジカルな距離を使用</td>
<td>C++</td>
</tr>
<tr class="row-even"><td>Pattern</td>
<td>部分構造探索に最適化されたトポロジカルなフィンガープリント</td>
<td>C++</td>
</tr>
<tr class="row-odd"><td>Extended Reduced Graphs</td>
<td><div class="first last line-block">
<div class="line"><em>JCIM</em> <strong>46</strong>:208-20(2006)で提案されたStieflらによるErGフィンガープリントから派生</div>
<div class="line"><br /></div>
<div class="line"><strong>注意</strong>: これらの関数は通常のフィンガープリントタイプではなくfloat型のアレイを返す</div>
</div>
</td>
<td>C++</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="morgan">
<h2>Morganフィンガープリントで使われているフィーチャーの定義<a class="headerlink" href="#morgan" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/GettingStartedInPython.html#feature-definitions-used-in-the-morgan-fingerprints">Feature Definitions Used in the Morgan Fingerprints</a>]</p>
<p>これらはGobbi, A. &amp; Poppinger, D. “Genetic optimization of combinatorial
libraries.” Biotechnology and Bioengineering 61, 47-54
(1998)に記載されている定義を用いて作られています。</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">フィーチャー</th>
<th class="head">SMARTS</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Donor</td>
<td><code class="docutils literal"><span class="pre">[$([N;!H0;v3,v4&amp;+1]),$([O,S;H1;+0]),n&amp;H1&amp;+0]</span></code></td>
</tr>
<tr class="row-odd"><td>Acceptor</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">[$([O,S;H1;v2;!$(*-*=[O,N,P,S])]),$([O,S;H0;v2]),$([O,S;-]),$([N;v3;!$(N-*=[O,N,P,S])]),</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">n&amp;H0&amp;+0,$([o,s;+0;!$([o,s]:n);!$([o,s]:c:n)])]</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Aromatic</td>
<td><code class="docutils literal"><span class="pre">[a]</span></code></td>
</tr>
<tr class="row-odd"><td>Halogen</td>
<td><code class="docutils literal"><span class="pre">[F,Cl,Br,I]</span></code></td>
</tr>
<tr class="row-even"><td>Basic</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">[#7;+,$([N;H2&amp;+0][$([C,a]);!$([C,a](=O))]),$([N;H1&amp;+0]([$([C,a]);!$([C,a](=O))])</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">[$([C,a]);!$([C,a](=O))]),$([N;H0&amp;+0]([C;!$(C(=O))])([C;!$(C(=O))])[C;!$(C(=O))])]</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Acidic</td>
<td><code class="docutils literal"><span class="pre">[$([C,S](=[O,S,P])-[O;H1,-1])]</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id64">
<h2>脚注<a class="headerlink" href="#id64" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="blaney" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[1]</a></td><td>Blaney, J. M.; Dixon, J. S. &#8220;Distance Geometry in Molecular Modeling&#8221;.  <em>Reviews in Computational Chemistry</em>; VCH: New York, 1994.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="rappe" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[2]</a></td><td>Rappé, A. K.; Casewit, C. J.; Colwell, K. S.; Goddard III, W. A.; Skiff, W. M. &#8220;UFF, a full periodic table force field for molecular mechanics and molecular dynamics simulations&#8221;. <em>J. Am. Chem. Soc.</em> <strong>114</strong>:10024-35 (1992) .</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="carhart" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id32">[3]</a></td><td>Carhart, R.E.; Smith, D.H.; Venkataraghavan R. “Atom Pairs as Molecular Features in Structure-Activity Studies: Definition and Applications” <em>J. Chem. Inf. Comp. Sci.</em> <strong>25</strong>:64-73 (1985).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="nilakantan" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id33">[4]</a></td><td>Nilakantan, R.; Bauman N.; Dixon J.S.; Venkataraghavan R. “Topological Torsion: A New Molecular Descriptor for SAR Applications. Comparison with Other Desciptors.” <em>J. Chem.Inf. Comp. Sci.</em> <strong>27</strong>:82-5 (1987).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="rogers" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id34">[5]</a></td><td>Rogers, D.; Hahn, M. “Extended-Connectivity Fingerprints.” <em>J. Chem. Inf. and Model.</em> <strong>50</strong>:742-54 (2010).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="ashton" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id38">[6]</a></td><td>Ashton, M. et al. “Identification of Diverse Database Subsets using Property-Based and Fragment-Based Molecular Descriptions.” <em>Quantitative Structure-Activity Relationships</em> <strong>21</strong>:598-604 (2002).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="bemis1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id27">[7]</a></td><td>Bemis, G. W.; Murcko, M. A. &#8220;The Properties of Known Drugs. 1. Molecular Frameworks.&#8221; <em>J. Med. Chem.</em>  <strong>39</strong>:2887-93 (1996).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="lewell" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id47">[8]</a></td><td>Lewell, X.Q.; Judd, D.B.; Watson, S.P.; Hann, M.M. “RECAP-Retrosynthetic Combinatorial Analysis Procedure: A Powerful New Technique for Identifying Privileged Molecular Fragments with Useful Applications in Combinatorial Chemistry” <em>J. Chem. Inf. Comp. Sci.</em> <strong>38</strong>:511-22 (1998).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="degen" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id48">[9]</a></td><td>Degen, J.; Wegscheid-Gerlach, C.; Zaliani, A; Rarey, M. &#8220;On the Art of Compiling and Using ‘Drug-Like’ Chemical Fragment Spaces.&#8221; <em>ChemMedChem</em> <strong>3</strong>:1503–7 (2008).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="gobbi" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id53">[10]</a></td><td>Gobbi, A. &amp; Poppinger, D. &#8220;Genetic optimization of combinatorial libraries.&#8221; <em>Biotechnology and Bioengineering</em> <strong>61</strong>:47-54 (1998).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="rxnsmarts" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id44">[11]</a></td><td>A more detailed description of reaction smarts, as defined by the rdkit, is in the <a class="reference internal" href="The_RDKit_Book.html"><span class="doc">The RDKit Book</span></a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mmff1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id15">[12]</a></td><td>Halgren, T. A. &#8220;Merck molecular force field. I. Basis, form, scope, parameterization, and performance of MMFF94.&#8221; <em>J. Comp. Chem.</em> <strong>17</strong>:490–19 (1996).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mmff2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[13]</a></td><td>Halgren, T. A. &#8220;Merck molecular force field. II. MMFF94 van der Waals and electrostatic parameters for intermolecular interactions.&#8221; <em>J. Comp. Chem.</em> <strong>17</strong>:520–52 (1996).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mmff3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id17">[14]</a></td><td>Halgren, T. A. &#8220;Merck molecular force field. III. Molecular geometries and vibrational frequencies for MMFF94.&#8221; <em>J. Comp. Chem.</em> <strong>17</strong>:553–86 (1996).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mmff4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id18">[15]</a></td><td>Halgren, T. A. &amp; Nachbar, R. B. &#8220;Merck molecular force field. IV. conformational energies and geometries for MMFF94.&#8221; <em>J. Comp. Chem.</em> <strong>17</strong>:587-615 (1996).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mmffs" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id19">[16]</a></td><td>Halgren, T. A. &#8220;MMFF VI. MMFF94s option for energy minimization studies.&#8221; <em>J. Comp. Chem.</em> <strong>20</strong>:720–9 (1999).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="riniker" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id40">[17]</a></td><td>Riniker, S.; Landrum, G. A. &#8220;Similarity Maps - A Visualization Strategy for Molecular Fingerprints and Machine-Learning Methods&#8221; <em>J. Cheminf.</em> <strong>5</strong>:43 (2013).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="riniker2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[18]</td><td><em>(<a class="fn-backref" href="#id14">1</a>, <a class="fn-backref" href="#id20">2</a>)</em> Riniker, S.; Landrum, G. A. &#8220;Better Informed Distance Geometry: Using What We Know To Improve Conformation Generation&#8221; <em>J. Chem. Inf. Comp. Sci.</em> <strong>55</strong>:2562-74 (2015)</td></tr>
</tbody>
</table>
</div>
<div class="section" id="id65">
<h2>ライセンス<a class="headerlink" href="#id65" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>[<a class="reference external" href="https://www.rdkit.org/docs/Overview.html#license">License</a>]</p>
<img alt="_images/picture_5.png" src="_images/picture_5.png" />
<p>この文書の著作権は copyright (C) 2013-2018 by Greg Landrumに所属しています。</p>
<p>この文書はCreative Commons Attribution-ShareAlike 4.0 Licenseのもとでライセンスされています。
このライセンスを見るためには <a class="reference external" href="http://creativecommons.org/licenses/by-sa/4.0/">http://creativecommons.org/licenses/by-sa/4.0/</a> にアクセスするか、
Creative Commons, 543 Howard Street, 5th Floor, San Francisco, California, 94105, USA.　に手紙を送ってください。</p>
<p>このライセンスの意図はRDKitそのものの意図と似ています。
簡単に言えば“これを使ってなんでもやりたいことをやっていいですが、私たちの功績についても言及してください”</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">PythonでRDKitを始めよう</a><ul>
<li><a class="reference internal" href="#id1">このページについて</a></li>
<li><a class="reference internal" href="#id2">分子の読み込みと書き込み</a><ul>
<li><a class="reference internal" href="#back-to-ref-1">1分子の読み込み</a></li>
<li><a class="reference internal" href="#id4">まとまった数の分子を読み込む</a></li>
<li><a class="reference internal" href="#id5">分子の書き込み</a></li>
<li><a class="reference internal" href="#id6">分子の集合を書き出す方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">分子の取り扱い方</a><ul>
<li><a class="reference internal" href="#back-to-ref-2">原子、結合をループする</a></li>
<li><a class="reference internal" href="#back-to-ref-3">環の情報</a></li>
<li><a class="reference internal" href="#back-to-ref-4">分子の修正</a></li>
<li><a class="reference internal" href="#d">2Dの分子の取り扱い：描画の生成</a></li>
<li><a class="reference internal" href="#back-to-ref-5">3D分子の取り扱い</a></li>
<li><a class="reference internal" href="#id21">分子の保存</a></li>
<li><a class="reference internal" href="#id22">分子を描く</a></li>
</ul>
</li>
<li><a class="reference internal" href="#back-to-ref-6">部分構造探索</a><ul>
<li><a class="reference internal" href="#back-to-ref-7">部分構造一致検索における立体化学</a></li>
<li><a class="reference internal" href="#smarts">SMARTSのアトムマップインデックス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id25">化学変換</a><ul>
<li><a class="reference internal" href="#back-to-ref-9">部分構造ベースの変換</a></li>
<li><a class="reference internal" href="#murcko">Murcko型分解</a></li>
<li><a class="reference internal" href="#back-to-ref-11">最大共通部分構造</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id29">フィンガープリントの生成と分子の類似性</a><ul>
<li><a class="reference internal" href="#back-to-ref-12">トポロジカルフィンガープリント</a></li>
<li><a class="reference internal" href="#maccs">MACCS キー</a></li>
<li><a class="reference internal" href="#back-to-ref-13">アトムペアとトポロジカルトーション</a></li>
<li><a class="reference internal" href="#morgan-circular">Morganフィンガープリント(Circularフィンガープリント)</a><ul>
<li><a class="reference internal" href="#back-to-ref-15">モーガンフィンガープリントのビットの解釈</a></li>
</ul>
</li>
<li><a class="reference internal" href="#back-to-ref-16">フィンガープリントのビットのイメージの生成</a></li>
<li><a class="reference internal" href="#back-to-ref-17">フィンガープリントを使って多種多様な分子を選択する</a></li>
<li><a class="reference internal" href="#back-to-ref-18">フィンガープリントを使って類似度マップを生成する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#back-to-ref-19">記述子計算</a><ul>
<li><a class="reference internal" href="#id42">記述子の可視化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#back-to-ref-20">化学反応</a><ul>
<li><a class="reference internal" href="#back-to-ref-21">より高度な反応機能</a><ul>
<li><a class="reference internal" href="#id46">原子の保護</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recap">Recapの実装</a></li>
<li><a class="reference internal" href="#brics">BRICSの実装</a></li>
<li><a class="reference internal" href="#back-to-ref-24">他のフラグメント化手法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id50">化学的特徴とファーマコフォア</a><ul>
<li><a class="reference internal" href="#back-to-ref-25">化学的特徴</a></li>
<li><a class="reference internal" href="#back-to-ref-26">2Dファーマコフォアフィンガープリント</a></li>
</ul>
</li>
<li><a class="reference internal" href="#back-to-ref-27">分子フラグメント</a></li>
<li><a class="reference internal" href="#id55">化学以外の機能</a><ul>
<li><a class="reference internal" href="#id56">ビットベクトル</a></li>
<li><a class="reference internal" href="#discrete-value-vectors">Discrete value vectors</a></li>
<li><a class="reference internal" href="#d-grids">3D grids</a></li>
<li><a class="reference internal" href="#points">Points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id57">ヘルプの使い方</a></li>
<li><a class="reference internal" href="#id58">発展的なトピック/警告</a><ul>
<li><a class="reference internal" href="#back-to-ref-28">分子の編集</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id60">雑多なテクニックとヒント</a><ul>
<li><a class="reference internal" href="#chemallchem">ChemかAllChemか</a></li>
<li><a class="reference internal" href="#sssr">SSSR問題</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id61">利用可能な記述子のリスト</a></li>
<li><a class="reference internal" href="#id62">利用可能な3D記述子のリスト</a></li>
<li><a class="reference internal" href="#id63">利用可能なフィンガープリントのリスト</a></li>
<li><a class="reference internal" href="#morgan">Morganフィンガープリントで使われているフィーチャーの定義</a></li>
<li><a class="reference internal" href="#id64">脚注</a></li>
<li><a class="reference internal" href="#id65">ライセンス</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Getting_Started_with_RDKit_in_Python.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="検索" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, anonymous.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/Getting_Started_with_RDKit_in_Python.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>